<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>顾大仙MQ | 博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.gulj.cn/"/>
  <updated>2018-05-23T02:16:25.391Z</updated>
  <id>http://www.gulj.cn/</id>
  
  <author>
    <name>顾立剑</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>IntelliJ IDEA 必备插件</title>
    <link href="http://www.gulj.cn/2018/05/22/intellij-idea-%E5%BF%85%E5%A4%87%E6%8F%92%E4%BB%B6/"/>
    <id>http://www.gulj.cn/2018/05/22/intellij-idea-必备插件/</id>
    <published>2018-05-22T08:49:44.000Z</published>
    <updated>2018-05-23T02:16:25.391Z</updated>
    
    <content type="html"><![CDATA[<h4 id="插件安装方式"><a href="#插件安装方式" class="headerlink" title="插件安装方式"></a>插件安装方式</h4><ul><li><h5 id="下载插件到本地，从本地安装"><a href="#下载插件到本地，从本地安装" class="headerlink" title="下载插件到本地，从本地安装"></a>下载插件到本地，从本地安装</h5></li></ul><ul><li><h5 id="直接在线安装"><a href="#直接在线安装" class="headerlink" title="直接在线安装"></a>直接在线安装</h5></li></ul><a id="more"></a><h4 id="插件列表"><a href="#插件列表" class="headerlink" title="插件列表"></a>插件列表</h4><ul><li><h5 id="lombok"><a href="#lombok" class="headerlink" title="lombok"></a>lombok</h5><p>地址：<a href="https://plugins.jetbrains.com/plugin/6317-lombok-plugin" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/6317-lombok-plugin</a></p><p>作用：</p><p>​    免去IDE去生成其属性的构造器、getter、setter、equals、hashcode、toString等方法</p><p>截图：</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-22_17-42-54-1.gif"></p></li></ul><ul><li><h5 id="ignore"><a href="#ignore" class="headerlink" title=".ignore"></a>.ignore</h5><p><strong>地址</strong>：<a href="https://plugins.jetbrains.com/plugin/7495--ignore" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/7495--ignore</a></p><p><strong>作用</strong>：</p><p>​    生成各种ignore文件，一键创建git ignore文件模板，通过编辑器直接将文件加入到ignore文件中，免去手动添加操作</p><p><strong>截图</strong>：</p><p> <img src="http://p6nkwri76.bkt.clouddn.com/2018-05-22_18-33-19.gif"></p></li><li><h5 id="FindBugs-IDEA"><a href="#FindBugs-IDEA" class="headerlink" title="FindBugs-IDEA"></a>FindBugs-IDEA</h5><p><strong>地址</strong>：<a href="https://plugins.jetbrains.com/plugin/3847-findbugs-idea" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/3847-findbugs-idea</a></p><p><strong>作用</strong>：</p><p>​    检测代码中可能隐藏的bug以及不规范位置</p><p><strong>截图</strong>：</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_09-12-33.gif"></p></li></ul><ul><li><h5 id="GsonFormat"><a href="#GsonFormat" class="headerlink" title="GsonFormat"></a>GsonFormat</h5><p>地址：<a href="https://plugins.jetbrains.com/plugin/7654-gsonformat" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/7654-gsonformat</a></p><p>作用：</p><p>​    根据json文本，生成对应的java类</p><p>截图：</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_09-30-33.gif"></p></li></ul><ul><li><h5 id="VisualVM-Launcher"><a href="#VisualVM-Launcher" class="headerlink" title="VisualVM Launcher"></a>VisualVM Launcher</h5><p>地址：<a href="https://plugins.jetbrains.com/plugin/7115-visualvm-launcher" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/7115-visualvm-launcher</a></p><p>作用：</p><p>​    查看jvm运行状况，例如内存分析，cpu分析，对象占用内存大小</p><p>截图：</p></li></ul><ul><li><h5 id="GenerateAllSetter"><a href="#GenerateAllSetter" class="headerlink" title="GenerateAllSetter"></a>GenerateAllSetter</h5><p>地址：<a href="https://plugins.jetbrains.com/plugin/9360-generateallsetter" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/9360-generateallsetter</a></p><p>作用：</p><p>​    一键生成对象的所有set方法</p><p>截图：</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_09-41-10.gif"></p></li></ul><ul><li><h5 id="Free-Mybatis-Plugin"><a href="#Free-Mybatis-Plugin" class="headerlink" title="Free Mybatis Plugin"></a>Free Mybatis Plugin</h5><p>地址：<a href="https://plugins.jetbrains.com/plugin/8321-free-mybatis-plugin" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/8321-free-mybatis-plugin</a></p><p>作用：</p><p> 根据定义mapper接口方法，生成对应的mapper.xml文件中的方法，快速在mapper.java文件和mapper.xml文件之间来回切换</p><p>截图：</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_10-09-14.gif"></p></li></ul><ul><li><h5 id="Background-Image-Plus"><a href="#Background-Image-Plus" class="headerlink" title="Background Image Plus"></a>Background Image Plus</h5><p>地址：<a href="https://plugins.jetbrains.com/plugin/8502-background-image-plus" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/8502-background-image-plus</a></p><p>作用：</p><p>​    为idea编辑器设置图片背景</p><p>截图：  </p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_09-54-17.gif"></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;插件安装方式&quot;&gt;&lt;a href=&quot;#插件安装方式&quot; class=&quot;headerlink&quot; title=&quot;插件安装方式&quot;&gt;&lt;/a&gt;插件安装方式&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;h5 id=&quot;下载插件到本地，从本地安装&quot;&gt;&lt;a href=&quot;#下载插件到本地，从本地安装&quot; class=&quot;headerlink&quot; title=&quot;下载插件到本地，从本地安装&quot;&gt;&lt;/a&gt;下载插件到本地，从本地安装&lt;/h5&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;h5 id=&quot;直接在线安装&quot;&gt;&lt;a href=&quot;#直接在线安装&quot; class=&quot;headerlink&quot; title=&quot;直接在线安装&quot;&gt;&lt;/a&gt;直接在线安装&lt;/h5&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="idea" scheme="http://www.gulj.cn/tags/idea/"/>
    
  </entry>
  
  <entry>
    <title>Webpack 学习示例</title>
    <link href="http://www.gulj.cn/2018/04/09/webpack-%E6%95%99%E7%A8%8B/"/>
    <id>http://www.gulj.cn/2018/04/09/webpack-教程/</id>
    <published>2018-04-09T08:13:54.000Z</published>
    <updated>2018-05-02T08:45:56.357Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p><a href="https://doc.webpack-china.org/concepts" target="_blank" rel="noopener">Webpack</a> 是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)。当 Webpack 处理应用程序时，它会递归地构建一个依赖关系图(dependency graph)，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 bundle </p><p>本章节主要介绍Webpack的核心概念的Demo使用示例，建议读者查看之前请阅读Webpack的<a href="https://webpack.js.org/concepts/" target="_blank" rel="noopener">官方文档</a>也可以查看<a href="https://doc.webpack-china.org/concepts" target="_blank" rel="noopener">中文</a>地址文档</p><p><strong>Webpack版本</strong>： 3.9.0</p><p><strong>代码GitHub地址</strong>： <a href="https://github.com/gulijian/webpack-learning-example" target="_blank" rel="noopener">https://github.com/gulijian/webpack-learning-example</a></p><a id="more"></a><h4 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h4><p>Install webpack</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i -g webpack</span><br></pre></td></tr></table></figure><p>Clone the repo.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/gulijian/webpack-learning-example.git</span><br></pre></td></tr></table></figure><p>Install the dependencies</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入每个章节根目录，执行 npm install </span></span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure><p>Open the each chapter  index.html</p><h4 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h4><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter4-1-source" target="_blank" rel="noopener">Style-loader</a></p><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter4-2-source" target="_blank" rel="noopener">Style-loader/url</a></p><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter4-3-source" target="_blank" rel="noopener">Css-loader And Css-Module</a></p><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter5-1-source" target="_blank" rel="noopener">Js Tree-shaking</a></p><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter6-1-source" target="_blank" rel="noopener">Url-loader</a></p><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter7-1-source" target="_blank" rel="noopener">ProvidePlugin</a></p><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter8-1-source" target="_blank" rel="noopener">Clean-webpack-plugin</a></p><h3 id="chapter4-1-source"><a href="#chapter4-1-source" class="headerlink" title="chapter4-1 (source)"></a>chapter4-1 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter4-1" target="_blank" rel="noopener">source</a>)</h3><p>style-loader use</p><blockquote><p>处理css，以 style 标签形式引入css</p></blockquote><h5 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./css/app.css'</span></span><br></pre></td></tr></table></figure><h5 id="app-css"><a href="#app-css" class="headerlink" title="app.css"></a>app.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#00bcd4b5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'style-loader'</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="chapter4-2-source"><a href="#chapter4-2-source" class="headerlink" title="chapter4-2 (source)"></a>chapter4-2 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter4-2" target="_blank" rel="noopener">source</a>)</h3><p>style-loader/url use</p><blockquote><p>处理css，以<link>标签形式引入css</p></blockquote><h5 id="app-js-1"><a href="#app-js-1" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./css/app.css'</span></span><br></pre></td></tr></table></figure><h5 id="app-css-1"><a href="#app-css-1" class="headerlink" title="app.css"></a>app.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#00bcd4b5</span>;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#styleLoaderUrl</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="index-html-1"><a href="#index-html-1" class="headerlink" title="index.html"></a>index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"styleLoaderUrl"</span>&gt;</span> hello style-loader/url<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpak-config-js"><a href="#webpak-config-js" class="headerlink" title="webpak.config.js"></a>webpak.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        publicPath: <span class="string">'./dist/'</span>,</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'style-loader/url'</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'file-loader'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="chapter4-3-source"><a href="#chapter4-3-source" class="headerlink" title="chapter4-3 (source)"></a>chapter4-3 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter4-3" target="_blank" rel="noopener">source</a>)</h3><p>css-loader and css-module use</p><blockquote><p>处理css，支持 css-module 形式</p></blockquote><h5 id="app-js-2"><a href="#app-js-2" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> app1 <span class="keyword">from</span> <span class="string">'./css/app1.css'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> app2 <span class="keyword">from</span>  <span class="string">'./css/app2.css'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用样式</span></span><br><span class="line">app.innerHTML = <span class="string">'&lt;div class = "'</span>+app1.box+<span class="string">'"&gt;&lt;/div&gt;'</span></span><br></pre></td></tr></table></figure><h5 id="app1-css"><a href="#app1-css" class="headerlink" title="app1.css"></a>app1.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">composes</span>: borderBox from <span class="string">'./app2.css'</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#76d4e0ab</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="app2-css"><a href="#app2-css" class="headerlink" title="app2.css"></a>app2.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.borderBox</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">4px</span> solid <span class="number">#e87ff5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="index-html-2"><a href="#index-html-2" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js-1"><a href="#webpack-config-js-1" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'style-loader'</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            minimize: <span class="literal">true</span>,  <span class="comment">// 启用压缩</span></span><br><span class="line">                            modules: <span class="literal">true</span>    <span class="comment">// 启用 css module</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="chapter5-1-source"><a href="#chapter5-1-source" class="headerlink" title="chapter5-1 (source)"></a>chapter5-1 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter5-1" target="_blank" rel="noopener">source</a>)</h3><p>UglifyJsPlugin  use</p><blockquote><p>使用 <strong>UglifyJsPlugin</strong> 插件； 不打包没有使用的 js</p></blockquote><h5 id="util-js"><a href="#util-js" class="headerlink" title="util.js"></a>util.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">a</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'this is a'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">b</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'this is b'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">c</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'this is c'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="app-js-3"><a href="#app-js-3" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; a &#125; <span class="keyword">from</span> <span class="string">'./common/util.js'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a())</span><br></pre></td></tr></table></figure><h5 id="index-html-3"><a href="#index-html-3" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js-2"><a href="#webpack-config-js-2" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span>,</span><br><span class="line">        </span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>app.js 中只使用了 util.js 中的 a 函数 打包的时候只会打包 a 函数；因为 b 和  c 函数没有使用到，则不会被打包</p></blockquote><h3 id="chapter6-1-source"><a href="#chapter6-1-source" class="headerlink" title="chapter6-1 (source)"></a>chapter6-1 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter6-1" target="_blank" rel="noopener">source</a>)</h3><p>url-loader use</p><blockquote><p>图片文件处理</p></blockquote><h5 id="app-js-4"><a href="#app-js-4" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img1 = <span class="built_in">document</span>.getElementById(<span class="string">'img1'</span>)</span><br><span class="line"><span class="keyword">var</span> img2 = <span class="built_in">document</span>.getElementById(<span class="string">'img2'</span>)</span><br><span class="line"></span><br><span class="line">img1.src = <span class="built_in">require</span>(<span class="string">'./assets/img1.jpg'</span>)</span><br><span class="line">img2.src = <span class="built_in">require</span>(<span class="string">'./assets/img2.png'</span>)</span><br></pre></td></tr></table></figure><h5 id="index-html-4"><a href="#index-html-4" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- size &lt; 30kb --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"img1"</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- size &gt; 30kb --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"img2"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js-3"><a href="#webpack-config-js-3" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line"></span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(png|jpg|jpeg|gif)$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader:<span class="string">'url-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            limit: <span class="number">30000</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>图片 小于 30kb 会变成base64编码，大于 30kb 会生成图片地址</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"img1"</span> <span class="attr">src</span>=<span class="string">"6443347e97d394b23b05746b2fe41cd1.jpg"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"img2"</span> <span class="attr">src</span>=<span class="string">"data:image/png;base64,iVBORw0KGgoAXBIWXMAAC4jAAAuIwF4pT92AAAKTWlD"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="chapter7-1-source"><a href="#chapter7-1-source" class="headerlink" title="chapter7-1 (source)"></a>chapter7-1 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter7-1" target="_blank" rel="noopener">source</a>)</h3><p>ProvidePlugin use</p><blockquote><p>处理第三方 JS 库，方式一：（ jquery 作为npm的一个module）</p></blockquote><h5 id="app-js-5"><a href="#app-js-5" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#app'</span>).append(<span class="string">'hello jquery'</span>)</span><br></pre></td></tr></table></figure><h5 id="index-html-5"><a href="#index-html-5" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js-4"><a href="#webpack-config-js-4" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">            $: <span class="string">'jquery'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="chapter7-2-source"><a href="#chapter7-2-source" class="headerlink" title="chapter7-2 (source)"></a>chapter7-2 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter7-2" target="_blank" rel="noopener">source</a>)</h3><blockquote><p>处理第三方 JS 库，方式二：（引入本地的 jquery 库）</p></blockquote><h5 id="app-js-6"><a href="#app-js-6" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#app'</span>).append(<span class="string">'hello jquery'</span>)</span><br></pre></td></tr></table></figure><h5 id="index-html-6"><a href="#index-html-6" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js-5"><a href="#webpack-config-js-5" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注意 jquery$ 的名字 要和 ProvidePlugin 插件中配置的名称（jquery）保持一致</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            jquery$: path.resolve(__dirname,<span class="string">'src/libs/jquery.min.js'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">            $: <span class="string">'jquery'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>如果 jquery 在CDN上，直接引入即可</p></blockquote><h3 id="chapter8-1-source"><a href="#chapter8-1-source" class="headerlink" title="chapter8-1 (source)"></a>chapter8-1 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter8-1" target="_blank" rel="noopener">source</a>)</h3><p>clean-webpack-plugin use</p><blockquote><p>每次打包清除原先的打包目录</p></blockquote><h5 id="app-js-7"><a href="#app-js-7" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>)</span><br><span class="line"></span><br><span class="line">app.innerHTML = <span class="string">'&lt;h1&gt;使用 clean-webpack-plugin 插件，可以每次打包清除原先的打包目录&lt;/h1&gt;'</span></span><br></pre></td></tr></table></figure><h5 id="index-html-7"><a href="#index-html-7" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js-6"><a href="#webpack-config-js-6" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    plugins: [</span><br><span class="line">       <span class="keyword">new</span> CleanWebpackPlugin([</span><br><span class="line">           <span class="string">'dist'</span></span><br><span class="line">       ])</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;&lt;a href=&quot;https://doc.webpack-china.org/concepts&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Webpack&lt;/a&gt; 是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)。当 Webpack 处理应用程序时，它会递归地构建一个依赖关系图(dependency graph)，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 bundle &lt;/p&gt;
&lt;p&gt;本章节主要介绍Webpack的核心概念的Demo使用示例，建议读者查看之前请阅读Webpack的&lt;a href=&quot;https://webpack.js.org/concepts/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;官方文档&lt;/a&gt;也可以查看&lt;a href=&quot;https://doc.webpack-china.org/concepts&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;中文&lt;/a&gt;地址文档&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Webpack版本&lt;/strong&gt;： 3.9.0&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;代码GitHub地址&lt;/strong&gt;： &lt;a href=&quot;https://github.com/gulijian/webpack-learning-example&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/gulijian/webpack-learning-example&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="webpack" scheme="http://www.gulj.cn/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker Linux网络命名空间</title>
    <link href="http://www.gulj.cn/2018/03/31/docker-linux%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/"/>
    <id>http://www.gulj.cn/2018/03/31/docker-linux命名空间/</id>
    <published>2018-03-31T02:44:25.000Z</published>
    <updated>2018-05-02T08:45:56.367Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>到现在我们已经了解到Docker的镜像、容器等概念，我们可以在一台宿主机上运行一个或者多个容器，也可以将不同的容器运行在不同的宿主机上，那么这些容器是怎样进行互相通信呢？本文将介绍Linux网络命名空间概念，来帮助读者更好地了解到Docker容器之间的通信。</p><h4 id="容器之间的通信-同一台宿主机上"><a href="#容器之间的通信-同一台宿主机上" class="headerlink" title="容器之间的通信(同一台宿主机上)"></a>容器之间的通信(同一台宿主机上)</h4><p>默认情况下，在同一台宿主机上的多个容器是可以互相访问的，容器的网络命名空间和宿主机的网络命名空间是相互独立隔离的</p><p>查看宿主机的网络命名空间</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 52:54:00:ad:3b:43 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 85639sec preferred_lft 85639sec</span><br><span class="line">    inet6 fe80::5054:ff:fead:3b43/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 08:00:27:7e:86:8c brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.215.20/24 brd 192.168.215.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::a00:27ff:fe7e:868c/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN</span><br><span class="line">    link/ether 02:42:79:71:de:73 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><p>新建两个容器放入后台运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name demo1 busybox /bin/sh -c <span class="string">"while true;do sleep 3600;done"</span></span><br><span class="line"></span><br><span class="line">$ docker run -d --name demo2 busybox /bin/sh -c <span class="string">"while true;do sleep 3600;done"</span></span><br></pre></td></tr></table></figure><p>查看两个容器的网络命名空间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> demo1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">5: eth0@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue</span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">$ docker <span class="built_in">exec</span> demo2 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: eth0@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue</span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><p>这里可以看到宿主机、demo1和demo2的网络命名空间都是独立的，测试容器demo1和容器demo2是否可以互通</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 demo1 内 ping demo2容器的ip地址</span></span><br><span class="line">$ docker <span class="built_in">exec</span> test1 ping 172.17.0.3</span><br><span class="line">PING 172.17.0.3 (172.17.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.3: seq=0 ttl=64 time=0.086 ms</span><br><span class="line">64 bytes from 172.17.0.3: seq=1 ttl=64 time=0.104 ms</span><br><span class="line">64 bytes from 172.17.0.3: seq=2 ttl=64 time=0.081 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 demo2 内 ping demo1容器的ip地址</span></span><br><span class="line">$ docker <span class="built_in">exec</span> test2  ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.2: seq=0 ttl=64 time=0.079 ms</span><br><span class="line">64 bytes from 172.17.0.2: seq=1 ttl=64 time=0.102 ms</span><br><span class="line">64 bytes from 172.17.0.2: seq=2 ttl=64 time=0.101 ms</span><br></pre></td></tr></table></figure><p>从上面看出容器demo1和容器demok2可以互相访问</p><p>为了更好地了解到在同一宿主机上容器间的通信，下面我们从Linux网络命名空间来为大家解释</p><p>在这之前我们先把我们刚才运行的demo1和demo2两个容器停止掉</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker stop demo1 demo2</span><br></pre></td></tr></table></figure><h5 id="Linux-的网络命名空间-namespace"><a href="#Linux-的网络命名空间-namespace" class="headerlink" title="Linux 的网络命名空间(namespace)"></a>Linux 的网络命名空间(namespace)</h5><p>下面我们将在宿主机上创建两个网络命名空间分别为test1和test2，然后再创建一对<br><strong>Veth 接口</strong>，分别分配给test1和test2，这样test1和test2就能够连接起来，能够互相访问</p><p><img src="http://p6nkwri76.bkt.clouddn.com/15224774725025.jpg" alt=""></p><h5 id="创建网络命名空间"><a href="#创建网络命名空间" class="headerlink" title="创建网络命名空间"></a>创建网络命名空间</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip netns add test1</span><br><span class="line"></span><br><span class="line">$ sudo ip netns add test2</span><br></pre></td></tr></table></figure><h5 id="查看网络命名空间"><a href="#查看网络命名空间" class="headerlink" title="查看网络命名空间"></a>查看网络命名空间</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip netns list</span><br><span class="line">test2</span><br><span class="line">test1</span><br></pre></td></tr></table></figure><p>在docker容器中，我们可以查看容器的网络命名空间，同理我们也可以查看我们创建的网络命名空间详细信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip netns <span class="built_in">exec</span> test1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    </span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test2 ip a </span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br></pre></td></tr></table></figure><p>现在可以看到我们创建的两个命名空间test1和tes2只有本地的回环端口，也没有本地 ip 127.0.0.1 之类并且状态是DOWN的状态</p><p>查看本地的 ip link</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip link </span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:00:ad:3b:43 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 08:00:27:7e:86:8c brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT</span><br><span class="line">    link/ether 02:42:79:71:de:73 brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure><p>现在本地只有四个 <strong>ip link</strong> 下面在宿主机上添加一对 <strong>link</strong> (<strong>vethl-test1 和 veth-test2</strong>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip link add veth-test1 <span class="built_in">type</span> veth peer name veth-test2</span><br></pre></td></tr></table></figure><p>接下来我们再次查看本地的 <strong>ip link</strong> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip link </span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:00:ad:3b:43 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 08:00:27:7e:86:8c brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT</span><br><span class="line">    link/ether 02:42:79:71:de:73 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">9: veth-test2@veth-test1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 9e:44:34:0b:41:39 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">10: veth-test1@veth-test2: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 5a:ed:e6:53:00:fb brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure><p>序号：9.（veth-test2@veth-test1），10.（veth-test1@veth-test2）就是我们刚添加的一对 link</p><p>将 veth-test1 这个接口添加到网络命名空间test1上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip link <span class="built_in">set</span> veth-test1 netns test1</span><br></pre></td></tr></table></figure><p>这时候我们会发现本地的 ip link 序号：10 消失了，而我们创建的test1网络命名空间多了 veth-test1,我们来查看test1的 ip link</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip netns <span class="built_in">exec</span> test1 ip link </span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">10: veth-test1@if9: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 5a:ed:e6:53:00:fb brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br></pre></td></tr></table></figure><p>同理将 veth-test2 这个接口添加到网络命名空间test2上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip link <span class="built_in">set</span> veth-test2 netns test2</span><br></pre></td></tr></table></figure><p>现在我们把创建的veth-test1和veth-test2分别添加到了网络命名空间test1和test2上(<strong>此时他们都没有ip地址，状态也是DOWN的状态</strong>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test1</span></span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test1 ip link </span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">10: veth-test1@if9: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 5a:ed:e6:53:00:fb brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># test2</span></span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">9: veth-test2@if10: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 9e:44:34:0b:41:39 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br></pre></td></tr></table></figure><p>分别为两个接口 <strong>veth-test1</strong> 和 <strong>veth-test2</strong> 分配ip地址,然后让其状态由<strong>DOWN</strong>变为<strong>UP</strong> (同时也可以把各自的回环端口 lo 状态也设置为 UP，不然到时候ping自己的时候ping不通)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为veth-test1和veth-test2分配IP地址</span></span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test1 ip addr add 192.168.1.1/24 dev veth-test1</span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test2 ip addr add 192.168.1.2/24 dev veth-test2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置veth-test1和veth-test2的状态由DOWN变为UP</span></span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test1 ip link <span class="built_in">set</span> dev veth-test1 up</span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test2 ip link <span class="built_in">set</span> dev veth-test2 up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置test1和test2的本地回环端口状态由DOWN变为UP</span></span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test1 ip link <span class="built_in">set</span> dev lo  up</span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test2 ip link <span class="built_in">set</span> dev lo  up</span><br></pre></td></tr></table></figure><p>现在我们可以看到我们创建的test1和test2这两个网络命名空间上的veth-test1和veth-test2接口分配的IP地址，并且状态为UP </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># test1</span><br><span class="line">$ sudo ip netns exec test1 ip  a</span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">10: veth-test1@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP qlen 1000</span><br><span class="line">    link/ether 5a:ed:e6:53:00:fb brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet 192.168.1.1/24 scope global veth-test1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::58ed:e6ff:fe53:fb/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">  </span><br><span class="line"># test2     </span><br><span class="line">$ sudo ip netns exec test2  ip  a</span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">9: veth-test2@if10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP qlen 1000</span><br><span class="line">    link/ether 9e:44:34:0b:41:39 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 192.168.1.2/24 scope global veth-test2</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::9c44:34ff:fe0b:4139/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><p>到此我们已经成功地完成了通过我们自己创建的test1和test2这两个网络命名空间，他们之间可以通过veth-test1和veth-test2互相访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test1 上 ping test2的ip</span></span><br><span class="line">sudo ip netns <span class="built_in">exec</span> test1  ping 192.168.1.2</span><br><span class="line">PING 192.168.1.2 (192.168.1.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.2: icmp_seq=1 ttl=64 time=0.048 ms</span><br><span class="line">64 bytes from 192.168.1.2: icmp_seq=2 ttl=64 time=0.059 ms</span><br><span class="line">64 bytes from 192.168.1.2: icmp_seq=3 ttl=64 time=0.067 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># test2 上 ping test1的ip</span></span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test2  ping 192.168.1.1</span><br><span class="line">PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=1 ttl=64 time=0.048 ms</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=2 ttl=64 time=0.052 ms</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=3 ttl=64 time=0.079 ms</span><br></pre></td></tr></table></figure><blockquote><p>在同一台宿主机上的docker多容器他们分别有各自的网络命名空间，他们之间的通信原理，和我们自己创建的test1和test2这两个网络命名空间他们之间的通信原理类似</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;到现在我们已经了解到Docker的镜像、容器等概念，我们可以在一台宿主机上运行一个或者多个容器，也可以将不同的容器运行在不同的宿主机上，那么这些容器是怎样进行互相通信呢？本文将介绍Linux网络命名空间概念，来帮助读者更好地了解到Docker容器之间的通信。&lt;/p&gt;
&lt;h4 id=&quot;容器之间的通信-同一台宿主机上&quot;&gt;&lt;a href=&quot;#容器之间的通信-同一台宿主机上&quot; class=&quot;headerlink&quot; title=&quot;容器之间的通信(同一台宿主机上)&quot;&gt;&lt;/a&gt;容器之间的通信(同一台宿主机上)&lt;/h4&gt;&lt;p&gt;默认情况下，在同一台宿主机上的多个容器是可以互相访问的，容器的网络命名空间和宿主机的网络命名空间是相互独立隔离的&lt;/p&gt;
&lt;p&gt;查看宿主机的网络命名空间&lt;/p&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 数据持久化</title>
    <link href="http://www.gulj.cn/2018/03/30/docker-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    <id>http://www.gulj.cn/2018/03/30/docker-数据持久化/</id>
    <published>2018-03-30T03:47:38.000Z</published>
    <updated>2018-05-02T08:45:56.357Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>Docker 容器一旦删除，那么我们在容器内的一切操作将不复存在，比如我们在容器内存储的数据等；为了解决这个问题，Docker 提出了数据卷概念，就像我们运行一个mysql容器，我们需要存储我们的数据，日志之类，想要他们不会随着容器的删除而销毁，或者我们需要在各个容器间共享数据，那么这些<strong>数据卷</strong>或者<strong>数据卷容器</strong>都能做到。</p><p>数据卷是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多有用的特性：</p><ul><li>数据卷可以在容器之间共享和重用</li><li>对数据卷的修改会立马生效</li><li>对数据卷的更新，不会影响镜像</li><li>数据卷默认会一直存在，即使容器被删除</li><li>数据卷的生命周期一直持续到没有容器使用它为止</li></ul><blockquote><p>数据卷的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定为挂载点的目录中的文件会隐藏掉，能显示看的是挂载的数据卷</p></blockquote><a id="more"></a><p><strong>Docker提供了两种方式管理数据</strong></p><ul><li>数据卷</li><li>数据卷容器</li></ul><h4 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h4><h5 id="添加数据卷"><a href="#添加数据卷" class="headerlink" title="添加数据卷"></a>添加数据卷</h5><p>在 <strong>docker run</strong> 命令中 使用 <strong>-v</strong> 标识给容器内添加一个或者多个数据卷</p><p>在容器内创建一个新的数据卷 /data/shop</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name my-shop-web -v /data/shop sqgulj/shop-web</span><br></pre></td></tr></table></figure><p>这种方式我们也可以在Dockerfile中使用<strong>VOLUME</strong>指令来给创建的容器添加一个或者多个数据卷，比如官方的 mysql 的 <a href="https://github.com/docker-library/mysql/blob/ad625c64a06e16683e997e5a0147508d115f4989/5.7/Dockerfile" target="_blank" rel="noopener">Dockerfile</a> 中用 <strong>VOLUME</strong> 指定了数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.........</span><br><span class="line"></span><br><span class="line">RUN &#123;</span><br><span class="line">    apt-get update &amp;&amp; apt-get install -y mysql-server=<span class="string">"<span class="variable">$&#123;MYSQL_VERSION&#125;</span>"</span> &amp;&amp; rm -rf /var/lib/apt/lists/* \</span><br><span class="line">&amp;&amp; rm -rf /var/lib/mysql &amp;&amp; mkdir -p /var/lib/mysql /var/run/mysqld \</span><br><span class="line">&amp;&amp; chown -R mysql:mysql /var/lib/mysql /var/run/mysqld \</span><br><span class="line"><span class="comment"># ensure that /var/run/mysqld (used for socket and lock files) is writable regardless of the UID our mysqld instance ends up having at runtime</span></span><br><span class="line">&amp;&amp; chmod 777 /var/run/mysqld \</span><br><span class="line"><span class="comment"># comment out a few problematic configuration values</span></span><br><span class="line">&amp;&amp; find /etc/mysql/ -name <span class="string">'*.cnf'</span> -print0 \</span><br><span class="line">| xargs -0 grep -lZE <span class="string">'^(bind-address|log)'</span> \</span><br><span class="line">| xargs -rt -0 sed -Ei <span class="string">'s/^(bind-address|log)/#&amp;/'</span> \</span><br><span class="line"><span class="comment"># don't reverse lookup hostnames, they are usually another container</span></span><br><span class="line">&amp;&amp; <span class="built_in">echo</span> <span class="string">'[mysqld]\nskip-host-cache\nskip-name-resolve'</span> &gt; /etc/mysql/conf.d/docker.cnf</span><br><span class="line"></span><br><span class="line">VOLUME /var/lib/mysql</span><br><span class="line"></span><br><span class="line">COPY docker-entrypoint.sh /usr/<span class="built_in">local</span>/bin/</span><br><span class="line">RUN ln -s usr/<span class="built_in">local</span>/bin/docker-entrypoint.sh /entrypoint.sh <span class="comment"># backwards compat</span></span><br><span class="line">ENTRYPOINT [<span class="string">"docker-entrypoint.sh"</span>]</span><br><span class="line">............</span><br></pre></td></tr></table></figure><p>其中 <strong>VOLUME /var/lib/mysql</strong>  指定了mysql的数据卷</p><h5 id="将宿主机的一个目录，挂在到容器里"><a href="#将宿主机的一个目录，挂在到容器里" class="headerlink" title="将宿主机的一个目录，挂在到容器里"></a>将宿主机的一个目录，挂在到容器里</h5><p>使用 <strong>-v</strong>，除了可以创建一个数据卷，还可以挂载本地主机目录到容器中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name my-shop-web -v /<span class="built_in">local</span>/data/shop:/data/shop sqgulj/shop-web</span><br></pre></td></tr></table></figure><p>这将会把本地目录/local/data/shop挂载到容器的/data/shop目录，宿主机上的目录必须是绝对路径，如果目录不存在docker会自动创建它。</p><blockquote><p>出于可移植和分享的考虑，在Dockerfile中这种方式不支持</p></blockquote><p>docker默认情况下是对数据卷有读写权限，但是我们通过这样的方式让数据卷只读：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name my-shop-web -v /<span class="built_in">local</span>/data/shop:/data/shop:ro sqgulj/shop-web</span><br></pre></td></tr></table></figure><p>这里我们同样挂载了/local/data/shop目录，只是添加了 <strong>ro</strong> 选项来限制它只读。</p><h5 id="将宿主机上单个文件挂载到容器中"><a href="#将宿主机上单个文件挂载到容器中" class="headerlink" title="将宿主机上单个文件挂载到容器中"></a>将宿主机上单个文件挂载到容器中</h5><p>除了能挂载目录外，<strong>-v</strong> 标识还可以将宿主机的一个特定文件挂载为数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run --rm -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash</span><br></pre></td></tr></table></figure><p>这样就可以记录在容器输入过的命令了</p><blockquote><p>如果直接挂载一个文件，很多文件编辑工具，包括 vi 或者 sed –in-place，可能会造成文件 inode 的改变，从 Docker 1.1.0起，这会导致报错误信息。所以最简单的办法就直接挂载文件的父目录。</p></blockquote><h5 id="查看数据卷"><a href="#查看数据卷" class="headerlink" title="查看数据卷"></a>查看数据卷</h5><ul><li>使用命令 <strong>docker volume</strong> 可以查看我们生成的数据卷</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume ls </span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>               b202765855d3b77e574284fde0079d31fb0258997a7b72eb6f7c8299053f216b</span><br></pre></td></tr></table></figure><p>我们可以看到我们添加的数据卷 /data/shop ，当我们查看的时候并不是我们提供的名称，而是生成一系列的随机串，当我们为多个容器添加数据卷的时候，它也会为其生成一系列的随机串，这样不利于我们辨识哪些数据卷挂在哪个容器中，为了解决这个问题，我们可以在添加数据数据卷的时候，为数据卷起个辨识的名称，比如</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name my-shop-web -v shopwebdata:/data/shop sqgulj/shop-web</span><br></pre></td></tr></table></figure><p>我们发现，这次我们为容器添加一个数据的时候我们在前面加了一个 <strong>shopwebdata</strong> ，注意<strong>shopwebdata</strong>前面没有<strong>斜杠( / )</strong>，如果有斜杠那是把本地的一个目录挂载到容器内的一个目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume ls </span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>               shopwebdata</span><br></pre></td></tr></table></figure><p>这次我们就能看到我们添加的数据卷就是我们起的名称，而不是一些列的随机串</p><ul><li>使用命令 <strong>docker inspect</strong> 查看数据卷</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># my-shop-web 为容器的名称</span></span><br><span class="line">$ docker inspect my-shop-web</span><br><span class="line">............</span><br><span class="line"></span><br><span class="line"><span class="string">"Mounts"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"volume"</span>,</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"b202765855d3b77e574284fde0079d31fb0258997a7b72eb6f7c8299053f216b"</span>,</span><br><span class="line">                <span class="string">"Source"</span>: <span class="string">"/var/lib/docker/volumes/b202765855d3b77e574284fde0079d31fb0258997a7b72eb6f7c8299053f216b/_data"</span>,</span><br><span class="line">                <span class="string">"Destination"</span>: <span class="string">"/data/shop"</span>,</span><br><span class="line">                <span class="string">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">                <span class="string">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">                <span class="string">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        </span><br><span class="line">.............</span><br></pre></td></tr></table></figure><p>这里只列出了其中的 Mounts 属性，从中可以看到Source字段显示了数据卷存放的位置</p><h5 id="删除数据卷"><a href="#删除数据卷" class="headerlink" title="删除数据卷"></a>删除数据卷</h5><p>数据卷是被设计来持久化数据的，因此，删除容器并不会删除数据卷。如果想要在删除容器时同时删除数据卷，可使用如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm -v 容器ID</span><br></pre></td></tr></table></figure><p>这样既可在<strong>删除容器</strong>的同时也将<strong>数据卷删除</strong>。</p><p>我们还可以使用 <strong>docker volume rm</strong> 命令删除数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看数据卷</span></span><br><span class="line">$ docker volume ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定数据卷名称删除</span></span><br><span class="line">$ docker volume rm volume_name volume_name</span><br></pre></td></tr></table></figure><p>删除所有的数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume rm $(docker volume ls -f dangling=<span class="literal">true</span> -q)</span><br></pre></td></tr></table></figure><h4 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h4><p>如果有些数据，需要在多个容器之间进行共享，这时候可以使用数据卷容器<br>创建数据卷容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql-volume -v /data mysql</span><br></pre></td></tr></table></figure><p>其它容器可以使用–volumes-from标识，来使用通过刚刚创建的数据卷容器，来挂载对应的数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --volumes-from mysql-volume --name db1 mysql</span><br><span class="line"></span><br><span class="line">$ docker run -d --volumes-from mysql-volume --name db2 mysql</span><br></pre></td></tr></table></figure><p>这样 db1 和 db2 两个容器都共享 mysql-volume 这个容器中的文件</p><p>挂载相同数据卷的容器，容器的停止和删除，不会对数据卷产生影响</p><p>我们也还可以对一个容器使用多个 –volumes-from 标识，来将多个数据卷桥接到这个容器中</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;Docker 容器一旦删除，那么我们在容器内的一切操作将不复存在，比如我们在容器内存储的数据等；为了解决这个问题，Docker 提出了数据卷概念，就像我们运行一个mysql容器，我们需要存储我们的数据，日志之类，想要他们不会随着容器的删除而销毁，或者我们需要在各个容器间共享数据，那么这些&lt;strong&gt;数据卷&lt;/strong&gt;或者&lt;strong&gt;数据卷容器&lt;/strong&gt;都能做到。&lt;/p&gt;
&lt;p&gt;数据卷是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多有用的特性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;数据卷可以在容器之间共享和重用&lt;/li&gt;
&lt;li&gt;对数据卷的修改会立马生效&lt;/li&gt;
&lt;li&gt;对数据卷的更新，不会影响镜像&lt;/li&gt;
&lt;li&gt;数据卷默认会一直存在，即使容器被删除&lt;/li&gt;
&lt;li&gt;数据卷的生命周期一直持续到没有容器使用它为止&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;数据卷的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定为挂载点的目录中的文件会隐藏掉，能显示看的是挂载的数据卷&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 容器</title>
    <link href="http://www.gulj.cn/2018/03/29/docker-%E5%AE%B9%E5%99%A8/"/>
    <id>http://www.gulj.cn/2018/03/29/docker-容器/</id>
    <published>2018-03-29T06:17:03.000Z</published>
    <updated>2018-05-02T08:45:56.359Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>Docker 容器是用于运行镜像的沙箱环境，它是 Docker 镜像的运行实例；容器都是相互隔离、互不可见的，我们可以理解为：镜像是Docker生命周期的打包和构建阶段，而容器是Docker的启动和执行阶段。</p><p>容器是从镜像创建的应用运行实例，可以将其启动、开始、停止、删除，而这些容器都是相互隔离、互不可见的。</p><p>镜像使用的是分层存储，容器也是如此。每一个容器运行时，是以镜像为基础层，在其上创建一个当前容器的存储层，容器存储层的生存周期和容器一样，容器消亡时，容器存储层也随之消亡。因此，任何保存于容器存储层的信息都会随容器删除而丢失。</p><p>数据卷的生存周期独立于容器，容器消亡，数据卷不会消亡。因此，使用数据卷后，容器删除或者重新运行之后，数据却不会丢失。</p><a id="more"></a><h4 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h4><p>使用 <strong>docker run</strong> 命令来运行一个容器<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run [OPTIONS] IMAGE [COMMAND] [ARG...] [flags]</span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><p>由于 <strong>docker run</strong> 命令 OPTIONS 比较多，这里只选择大家常用的几个选项来说明</p><pre><code>-i, --interactive=false       打开STDIN，用于控制台交互-t, --tty                     分配一个伪终端（pseudo-tty）并绑定到容器的标准输入上-d, --detach=false            指定容器运行于前台还是后台，默认为false-p, --publish list            指定主机的端口和容器端口的映射-P, --publish-all             使用容器内随机一个网络端口映射到我们使用的主机上-v, --volume list             给容器挂载存储卷，挂载到容器的某个目录-m, --memory                  指定容器的内存上限--link list                   指定容器间的关联，使用其他容器的IP、env等信息-e, --env list                设置环境变量--restart string              指定容器的重启策略  </code></pre><p>示例：</p><p>后台运行一个nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --name mynginx -p 8088:80 -v <span class="variable">$PWD</span>/nginx/www:/www -v <span class="variable">$PWD</span>/nginx/logs:/wwwlogs -d  nginx</span><br></pre></td></tr></table></figure><h4 id="查看运行的容器"><a href="#查看运行的容器" class="headerlink" title="查看运行的容器"></a>查看运行的容器</h4><ul><li>查看正在运行的容器</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED                  STATUS              PORTS                  NAMES</span><br><span class="line">76ea0a1383d4        nginx               &quot;nginx -g &apos;daemon of…&quot;   Less than a second ago   Up 3 seconds        0.0.0.0:8088-&gt;80/tcp   mynginx</span><br></pre></td></tr></table></figure><ul><li>查看所有容器（包含正在运行和退出的容器）</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">76ea0a1383d4        nginx               <span class="string">"nginx -g 'daemon of…"</span>   3 minutes ago       Exited (0) 2 seconds ago                       mynginx</span><br></pre></td></tr></table></figure><ul><li>查看容器的详细信息</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dokcer inspect mygnix</span><br></pre></td></tr></table></figure><h4 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h4><p>使用 <strong>docker exec</strong> 命令进入容器<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> [OPTIONS] CONTAINER COMMAND [ARG...]</span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><pre><code>-d, --detach          分离模式: 在后台运行-i, --interactive     即使没有附加也保持STDIN 打开-t, --tty             分配一个伪终端-e, --env list        设置环境变量</code></pre><p>示例：</p><p>以交互模式进入容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it mynginx /bin/bash</span><br><span class="line">root@76ea0a1383d4:/<span class="comment">#</span></span><br></pre></td></tr></table></figure><h4 id="停止和重启容器"><a href="#停止和重启容器" class="headerlink" title="停止和重启容器"></a>停止和重启容器</h4><p>如果是交互式运行的一个容器，可以通过exit命令和Ctrl+d来退出终端，这样容器会立刻终止</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exit 直接退出，容器终止；或者快捷键Ctrl+d </span></span><br><span class="line">$ docer run -it centos /bin/bash</span><br><span class="line">[root@f7b52eb5ab02 /]<span class="comment"># exit</span></span><br></pre></td></tr></table></figure><p>使用 <strong>docker stop</strong> 命令来停止正在运行的容器<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop [OPTIONS] CONTAINER [CONTAINER...]</span><br></pre></td></tr></table></figure><p>示例：</p><p>指定容器名称停止正在运行的多个容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop mynginx myredis</span><br></pre></td></tr></table></figure><p>重新启动容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动终止的容器</span></span><br><span class="line">$ docker start mynginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将一个运行态的容器终止，然后再重新启动它</span></span><br><span class="line">$ docker restart myredis</span><br></pre></td></tr></table></figure><h4 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h4><p>使用 <strong>docker rm</strong> 命令删除一个或多个容器<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm [OPTIONS] CONTAINER [CONTAINER...]</span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><pre><code>-f, --force     强制删除-l, --link      移除容器间的网络连接，而非容器本身-v, --volumes   删除与容器关联的卷</code></pre><p>示例：</p><p>强制删除容器mynginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm -f mynginx</span><br></pre></td></tr></table></figure><p>删除mygninx，并删除容器挂载的数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm -v  mynginx</span><br></pre></td></tr></table></figure><p>强制删除所有的容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm -f $(docker ps -aq)</span><br></pre></td></tr></table></figure><blockquote><p>删除容器使用 <strong>docker rm</strong> 命令 而 删除容器使用 <strong>docker rmi</strong> 命令，注意两者区别</p></blockquote><h4 id="导出容器"><a href="#导出容器" class="headerlink" title="导出容器"></a>导出容器</h4><p>使用命令 docker export 导出本地某个容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看容器列表</span></span><br><span class="line">$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                    PORTS                  NAMES</span><br><span class="line">f7b52eb5ab02        centos              <span class="string">"/bin/bash"</span>              18 hours ago        Exited (0) 18 hours ago                          heuristic_edison</span><br><span class="line">06a6eb00f8bc        centos              <span class="string">"/bin/bash"</span>              18 hours ago        Up 18 hours                                      stupefied_euler</span><br><span class="line">76ea0a1383d4        nginx               <span class="string">"nginx -g 'daemon of…"</span>   19 hours ago        Up 19 hours               0.0.0.0:8088-&gt;80/tcp   mynginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出容器快照,到本地文件</span></span><br><span class="line">$ docker  <span class="built_in">export</span> 76ea0a1383d4 &gt; mynginx.tar.gz</span><br></pre></td></tr></table></figure><h4 id="导入容器"><a href="#导入容器" class="headerlink" title="导入容器"></a>导入容器</h4><p>使用命令 docker import 从快照文件中导入为镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat mynginx.tar.gz | docker import - sqgulj/nginx:2.0</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;Docker 容器是用于运行镜像的沙箱环境，它是 Docker 镜像的运行实例；容器都是相互隔离、互不可见的，我们可以理解为：镜像是Docker生命周期的打包和构建阶段，而容器是Docker的启动和执行阶段。&lt;/p&gt;
&lt;p&gt;容器是从镜像创建的应用运行实例，可以将其启动、开始、停止、删除，而这些容器都是相互隔离、互不可见的。&lt;/p&gt;
&lt;p&gt;镜像使用的是分层存储，容器也是如此。每一个容器运行时，是以镜像为基础层，在其上创建一个当前容器的存储层，容器存储层的生存周期和容器一样，容器消亡时，容器存储层也随之消亡。因此，任何保存于容器存储层的信息都会随容器删除而丢失。&lt;/p&gt;
&lt;p&gt;数据卷的生存周期独立于容器，容器消亡，数据卷不会消亡。因此，使用数据卷后，容器删除或者重新运行之后，数据却不会丢失。&lt;/p&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 镜像发布</title>
    <link href="http://www.gulj.cn/2018/03/28/docker-%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83/"/>
    <id>http://www.gulj.cn/2018/03/28/docker-镜像发布/</id>
    <published>2018-03-28T05:37:58.000Z</published>
    <updated>2018-05-02T08:45:56.365Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>如果我们自己在本地制作一个镜像，想提供给他人使用或者作为自己的日常学习，那么我们可以把我们制作的镜像发布到<a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a>上，这样不管是其它人还是我们自己就可以直接使用 <strong>docker pull</strong> 命令获取到我们发布的镜像，这样我们再也不用担心一不小心把本地镜像删除了；<br>当然发布到<a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a>上的镜像是公开的，每个人都能获取，如果我们希望我们发布的镜像是私有的只有我们自己可以看见，我们可以利用官方提供的<a href="">registry</a>镜像来搭建自己私有的镜像仓库,当然我们也还可以使用<a href="https://github.com/vmware/harbor" target="_blank" rel="noopener">Harbor</a>来搭建企业级私有仓库服务器</p><a id="more"></a><h4 id="镜像发布到-DockerHub"><a href="#镜像发布到-DockerHub" class="headerlink" title="镜像发布到 DockerHub"></a>镜像发布到 <a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a></h4><p>镜像发布到 <a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a>，首先我们需要注册 <a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a> 账号，假设现在大家都有了<a href="https://hub.docker.com/" target="_blank" rel="noopener">DokcerHub</a>的账号，那么接下来我们在本地制作一个自己的镜像</p><p>创建一个getip目录，进入到getip目录，编写Dockerfile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir getip</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> getip </span><br><span class="line"></span><br><span class="line">$ vim Dockerfile</span><br></pre></td></tr></table></figure><p>Dokcerfile文件中内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:16.04</span><br><span class="line"></span><br><span class="line">RUN apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install -y curl \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [<span class="string">"curl"</span>,<span class="string">"-s"</span>,<span class="string">"http://ip.cn"</span>]</span><br></pre></td></tr></table></figure><p>在getip目录执行 <strong>docker build</strong> 命令构建镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建镜像(注意仓库名必须是你注册的 dockerhub 的用户名)</span></span><br><span class="line">docker build -t sqgulj/get-ip:1.0 .</span><br></pre></td></tr></table></figure><p>查看构建的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker images;</span><br><span class="line">REPOSITORY                                                        TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">sqgulj/get-ip                                                     1.0                 e381e0c1b380        3 hours ago         129MB</span><br></pre></td></tr></table></figure><p>在终端使用 <strong>docker login</strong> 命令，输入自己的<a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a>账号信息进行登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker login</span><br><span class="line">Login with your Docker ID to push and pull images from Docker Hub. If you don<span class="string">'t have a Docker ID, head over to https://hub.docker.com to create one.</span></span><br><span class="line"><span class="string">Username (sqgulj):</span></span><br></pre></td></tr></table></figure><p>使用 <strong>docker push</strong> 命令把我刚制作的镜像推送到<a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker push sqgulj/get-ip</span><br><span class="line">The push refers to repository [docker.io/sqgulj/get-ip]</span><br><span class="line">83dc3de4596c: Pushed</span><br><span class="line">db584c622b50: Mounted from library/ubuntu</span><br><span class="line">52a7ea2bb533: Mounted from library/ubuntu</span><br><span class="line">52f389ea437e: Mounted from library/ubuntu</span><br><span class="line">88888b9b1b5b: Mounted from library/ubuntu</span><br><span class="line">a94e0d5a7c40: Mounted from library/ubuntu</span><br><span class="line">1.0: digest: sha256:1a3fa4e93464054c2f8050d6f846cccbe943c5e9f6d67f98f2013a32652f3f0b size: 1568</span><br></pre></td></tr></table></figure><p>浏览器登录到<a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a>查看我们推送的镜像</p><p><img src="http://p6nkwri76.bkt.clouddn.com/15222955810093.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;如果我们自己在本地制作一个镜像，想提供给他人使用或者作为自己的日常学习，那么我们可以把我们制作的镜像发布到&lt;a href=&quot;https://hub.docker.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DockerHub&lt;/a&gt;上，这样不管是其它人还是我们自己就可以直接使用 &lt;strong&gt;docker pull&lt;/strong&gt; 命令获取到我们发布的镜像，这样我们再也不用担心一不小心把本地镜像删除了；&lt;br&gt;当然发布到&lt;a href=&quot;https://hub.docker.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DockerHub&lt;/a&gt;上的镜像是公开的，每个人都能获取，如果我们希望我们发布的镜像是私有的只有我们自己可以看见，我们可以利用官方提供的&lt;a href=&quot;&quot;&gt;registry&lt;/a&gt;镜像来搭建自己私有的镜像仓库,当然我们也还可以使用&lt;a href=&quot;https://github.com/vmware/harbor&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Harbor&lt;/a&gt;来搭建企业级私有仓库服务器&lt;/p&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 镜像加速器</title>
    <link href="http://www.gulj.cn/2018/03/27/docker-%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%99%A8/"/>
    <id>http://www.gulj.cn/2018/03/27/docker-镜像加速器/</id>
    <published>2018-03-27T14:29:18.000Z</published>
    <updated>2018-05-02T08:45:56.365Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>由于国内访问官方（<strong>DockerHub</strong>）的镜像比较慢，可以使用阿里云和DaoCloud为我们提供的镜像</p><ul><li><p><a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="noopener">阿里云镜像加速器地址</a></p></li><li><p><a href="https://www.daocloud.io/mirror#accelerator-doc" target="_blank" rel="noopener">DaoCloud 镜像加速器地址</a></p></li></ul><p>本文笔者会分别介绍MacOs平台和Centos7平台下配置这两种的镜像加速器地址</p><a id="more"></a><h4 id="MacOS-平台"><a href="#MacOS-平台" class="headerlink" title="MacOS 平台"></a>MacOS 平台</h4><h5 id="配置阿里云Docker加速器"><a href="#配置阿里云Docker加速器" class="headerlink" title="配置阿里云Docker加速器"></a>配置阿里云Docker加速器</h5><ul><li>登录阿里云控制台（<a href="https://dev.aliyun.com/search.html" target="_blank" rel="noopener">需要注册阿里云开发者平台账号</a>），访问地址：<a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="noopener">https://cr.console.aliyun.com/#/accelerator</a>  可查看自己专有的镜像库加速器地址</li></ul><p>下图展示的是笔者的阿里云镜像加速器界面</p><p><img src="/images/15221416939253.jpg" alt=""></p><ul><li>右键点击桌面顶栏的 <strong>docker</strong> 图标 Perferences… -&gt; <strong>Daemon</strong> -&gt; <strong>Registry mirrors</strong>，添加代理地址，记得点击 Apply &amp; Restart 按钮使设置生效。</li></ul><p><img src="/images/15221424183672.jpg" alt=""></p><blockquote><p>出现的 “registry-mirrors” : No certs for 6wnqhom.mirror.aliyuncs.com… 警告可以忽略。</p></blockquote><h5 id="配置DaoCloud的Docker加速器"><a href="#配置DaoCloud的Docker加速器" class="headerlink" title="配置DaoCloud的Docker加速器"></a>配置DaoCloud的Docker加速器</h5><ul><li>打开地址：<a href="https://www.daocloud.io/mirror#accelerator-doc" target="_blank" rel="noopener">https://www.daocloud.io/mirror#accelerator-doc</a> 可以使用github账号登录或者微信</li></ul><p><img src="/images/15221435301606.jpg" alt=""></p><ul><li>添加DaoCloud的dokcer镜像代理地址和添加阿里云Docker代理地址方法一样，读者可以参考上面添加的阿里云docker加速器代理地址</li></ul><h4 id="Centos7-平台"><a href="#Centos7-平台" class="headerlink" title="Centos7 平台"></a>Centos7 平台</h4><h5 id="配置阿里云Docker加速器-1"><a href="#配置阿里云Docker加速器-1" class="headerlink" title="配置阿里云Docker加速器"></a>配置阿里云Docker加速器</h5><p>通过上面我们已经知道了如何获取自己的的阿里云docker镜像代理地址</p><ul><li>修改daemon配置文件/etc/docker/daemon.json来使用加速器：</li></ul><p>分别执行以下命令，记得把加速器的地址，改成自己的加速器地址。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://XXXXX.mirror.aliyuncs.com"</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><blockquote><p>针对Docker客户端版本大于1.10.0的用户</p></blockquote><h4 id="检查加速器是否生效"><a href="#检查加速器是否生效" class="headerlink" title="检查加速器是否生效"></a>检查加速器是否生效</h4><ul><li><p>Linux系统下配置完加速器需要检查是否生效，在命令行执行 <strong>ps -ef | grep dockerd</strong>，如果从结果中看到了配置的 –registry-mirror 参数说明配置成功</p></li><li><p>如果Docker版本大于1.13或17.05.0-ce</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker info|grep <span class="string">"Registry Mirrors"</span> -A 1</span><br><span class="line">Registry Mirrors:</span><br><span class="line"> https://16wnqhom.mirror.aliyuncs.com/</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;由于国内访问官方（&lt;strong&gt;DockerHub&lt;/strong&gt;）的镜像比较慢，可以使用阿里云和DaoCloud为我们提供的镜像&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://cr.console.aliyun.com/#/accelerator&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;阿里云镜像加速器地址&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://www.daocloud.io/mirror#accelerator-doc&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DaoCloud 镜像加速器地址&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;本文笔者会分别介绍MacOs平台和Centos7平台下配置这两种的镜像加速器地址&lt;/p&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 镜像</title>
    <link href="http://www.gulj.cn/2018/03/27/docker-%E9%95%9C%E5%83%8F/"/>
    <id>http://www.gulj.cn/2018/03/27/docker-镜像/</id>
    <published>2018-03-27T11:03:41.000Z</published>
    <updated>2018-05-02T08:45:56.360Z</updated>
    
    <content type="html"><![CDATA[<h4 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h4><p>官方的 <a href="https://hub.docker.com/explore/" target="_blank" rel="noopener">DockerHub</a> 上有很多开源的高质量镜像，可以直接供我们使用</p><ul><li>使用docker pull 命令直接从 <a href="https://hub.docker.com/explore/" target="_blank" rel="noopener">DockerHub</a> 上获取</li></ul><p>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull [选项] [docker registry 地址]:&lt;仓库名&gt;:&lt;标签&gt;</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取nginx镜像</span></span><br><span class="line">$ docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">2a72cbf407d6: Pull complete</span><br><span class="line">fefa2faca81f: Pull complete</span><br><span class="line">080aeede8114: Pull complete</span><br><span class="line">Digest: sha256:c4ee0ecb376636258447e1d8effb56c09c75fe7acf756bf7c13efadf38aa0aca</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:latest</span><br></pre></td></tr></table></figure><a id="more"></a><ul><li>使用Dockerfile构建Docker镜像 （<strong>建议使用Dockerfile构建自己的Docker镜像</strong>）</li></ul><p>格式： docker image build [OPTIONS] PATH | URL | - [flags]</p><p>简写： docker build [OPTIONS] PATH | URL | - [flags]</p><p>创建一个nginx目录，编写dockerfile文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个nginx目录</span></span><br><span class="line">$ mkdir nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编写Dockerfile文件 (注意名称必须为:Dockerfile)</span></span><br><span class="line">$ vim Dockerfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dockerfile 文件中内容</span></span><br><span class="line">FROM nginx</span><br><span class="line">RUN  <span class="built_in">echo</span> <span class="string">'&lt;h1&gt;Hello, nginx!&lt;/h1&gt;'</span> &gt; /usr/share/nginx/html/index.html</span><br></pre></td></tr></table></figure><p>在 Dockerfile 文件所在目录执行下面命令，构建名为 gulj/nginx:v1 的docker镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建名为 mynginx:v1 的镜像</span></span><br><span class="line">$ docker build -t gulj/nginx:v1  .</span><br></pre></td></tr></table></figure><ul><li>使用docker commit 命令通过已有的 <strong>容器</strong> 创建镜像（<strong>不建议使用</strong>）</li></ul><p>格式：docker container commit [选项] &lt;容器ID或容器名&gt; [&lt;仓库名&gt;[:&lt;标签&gt;]]</p><p>简写：docker commit [选项] &lt;容器ID或容器名&gt; [&lt;仓库名&gt;[:&lt;标签&gt;]]</p><p>既然通过容器创建镜像，那么首先需要运行一个容器，而运行一个容器需要一个基础镜像，下面将使用官方的centos镜像，通过加工来构建自己的镜像</p><p>大致流程如下：</p><pre><code>① 获取官方的centos镜像② 对获取的centos镜像执行docker run 命令获取一个容器③ 对获取的容器进行安装vim操作，安装结束，退出容器（默认官方的centos镜像没有vim命令）④ 通过docker commit 命令构建镜像，这样我们就能得到了一个带有vim命令的centos镜像</code></pre><p>按照流程操作演示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取centos镜像</span></span><br><span class="line">$ docker pull centos</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">5e35d10a3eba: Pull complete</span><br><span class="line">Digest: sha256:dcbc4e5e7052ea2306eed59563da1fec09196f2ecacbe042acbdcd2b44b05270</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> centos:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以交互式方式获取一个容器,这样我们就会进入容器内，安装vim，安装完之后退出容器</span></span><br><span class="line">$ docker run -it  centos</span><br><span class="line"><span class="comment"># 在容器内安装vim</span></span><br><span class="line">[root@34046cf71732 /] yum install vim -y </span><br><span class="line"><span class="comment"># 退出容器</span></span><br><span class="line">[root@34046cf71732 /] <span class="built_in">exit</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 查看我们刚才运行的容器</span></span><br><span class="line">$ dokcer ps -a </span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS                    NAMES</span><br><span class="line">34046cf71732        centos              <span class="string">"/bin/bash"</span>              10 minutes ago      Exited (0) 15 seconds ago                            cocky_euler</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建安装vim的centos镜像, --author 是指定修改的作者，而 --message 则是记录本次修改的内容，可省略</span></span><br><span class="line">$ docker commit  --author <span class="string">"gulj &lt;sqgulj@gmail.com&gt;"</span> --message <span class="string">"安装了vim"</span>  cocky_euler  gulj/centos-vim:1.0</span><br><span class="line">sha256:1109b8f3ea7826225d1dc1ee2693507fe8402eaeeafc57d24b907018a5cc0951</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看我们构建的镜像</span></span><br><span class="line">$ docker images</span><br><span class="line">REPOSITORY                                                        TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">gulj/centos-vim                                                   1.0                 1109b8f3ea78        15 seconds ago      354MB</span><br><span class="line">centos                                                            latest              2d194b392dd1        3 weeks ago         195MB</span><br></pre></td></tr></table></figure><p>下面我们通过docker history 命令查看镜像内的历史记录，与 centos:latest 的镜像历史记录比较，我们会很明显地发现，gulj/centos-vim:1.0 的镜像历史记录比 centos:latest 的镜像历史记录多了一层，也就是我们提交的一层（sha256:1109b8f3ea7826225d1…）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos:latest 镜像</span></span><br><span class="line">$ docker <span class="built_in">history</span> centos</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">2d194b392dd1        3 weeks ago         /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/bash"]            0B</span></span><br><span class="line">&lt;missing&gt;           3 weeks ago         /bin/sh -c <span class="comment">#(nop)  LABEL name=CentOS Base Im…   0B</span></span><br><span class="line">&lt;missing&gt;           3 weeks ago         /bin/sh -c <span class="comment">#(nop) ADD file:8d83f3e2c14f39e7f…   195MB</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们自己构建的gulj/centos-vim:1.0镜像</span></span><br><span class="line">$ docker <span class="built_in">history</span> gulj/centos-vim:1.0</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">1109b8f3ea78        9 minutes ago       /bin/bash                                       158MB</span><br><span class="line">2d194b392dd1        3 weeks ago         /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/bash"]            0B</span></span><br><span class="line">&lt;missing&gt;           3 weeks ago         /bin/sh -c <span class="comment">#(nop)  LABEL name=CentOS Base Im…   0B</span></span><br><span class="line">&lt;missing&gt;           3 weeks ago         /bin/sh -c <span class="comment">#(nop) ADD file:8d83f3e2c14f39e7f…   195MB</span></span><br></pre></td></tr></table></figure><blockquote><p>docker commit 操作只专注于可读可写层（Read-Write Layer），数据卷 VOLUME 挂载的目录内容，还有类似于 hosts、hostsname 和resolv.conf 等挂载文件，当然还有一些如 /proc 和 /sys 等虚拟文件系统的内容都将不会出现在打包后的镜像中</p></blockquote><h4 id="镜像常用命令"><a href="#镜像常用命令" class="headerlink" title="镜像常用命令"></a>镜像常用命令</h4><h5 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h5><p>使用 <strong>docker search</strong> 命令从<a href="https://hub.docker.com/explore/" target="_blank" rel="noopener">DockerHub</a>中搜索<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search [OPTIONS] TERM</span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><pre><code>-f, --filter filter  根据指定条件过滤结果--format string      通过Go语言模板文件展示镜像--limit int          限制显示的个数--no-trunc           显示完整的镜像描述</code></pre><p>示例：</p><p>从Docker Hub查找所有镜像名包含nginx，并且收藏数大于500的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker search -f=stars=500  nginx</span><br><span class="line">NAME                      DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">nginx                     Official build of Nginx.                        8227                [OK]</span><br><span class="line">jwilder/nginx-proxy       Automated Nginx reverse proxy <span class="keyword">for</span> docker con…   1300                                    [OK]</span><br><span class="line">richarvey/nginx-php-fpm   Container running Nginx + PHP-FPM capable of…   538                                     [OK]</span><br></pre></td></tr></table></figure><h5 id="列出镜像"><a href="#列出镜像" class="headerlink" title="列出镜像"></a>列出镜像</h5><p>使用 <strong>docker images</strong> 命令列出本地镜像<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images [OPTIONS] [REPOSITORY[:TAG]]</span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><pre><code>-a, --all             显示所有的镜像 (默认隐藏中间层镜像)--digests             显示摘要-f, --filter filter   显示满足条件的镜像--format string       通过Go语言模板文件展示镜像--no-trunc            显示完整的镜像信息-q, --quiet           只显示镜像ID</code></pre><p>示例：</p><p>查看本地镜像列表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker images 或者 docker images ls</span><br><span class="line">gulj/centos-vim                                                   1.0                 1109b8f3ea78        4 hours ago         354MB</span><br><span class="line">nginx                                                             latest              7f70b30f2cc6        6 days ago          109MB</span><br><span class="line">centos                                                            latest              2d194b392dd1        3 weeks ago         195MB</span><br><span class="line">postgres                                                          latest              6152297591eb        3 weeks ago         289MB</span><br><span class="line">busybox                                                           latest              f6e427c148a7        3 weeks ago         1.15MB</span><br></pre></td></tr></table></figure><p>其它使用方式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker image ls</span><br><span class="line"></span><br><span class="line">docker images -q                                   <span class="comment"># 只展示镜像的ID</span></span><br><span class="line"></span><br><span class="line">docker images mysql</span><br><span class="line"></span><br><span class="line">docker images mysql:5.7</span><br><span class="line"></span><br><span class="line">docker images --digests mysql:5.7                 </span><br><span class="line"></span><br><span class="line">docker images -f since=mysql:5.7                   <span class="comment"># 展示 mysql:5.7 之后建立的镜像</span></span><br><span class="line"></span><br><span class="line">docker images --format <span class="string">"&#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Repository&#125;&#125;"</span>  <span class="comment"># 只展示镜像ID和仓库</span></span><br><span class="line"></span><br><span class="line">docker images -f <span class="string">"dangling=true"</span>                   <span class="comment"># 展示虚悬镜像</span></span><br></pre></td></tr></table></figure><h5 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h5><p>使用 <strong>docker rmi</strong> 命令删除本地一个或多个镜像<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi [OPTIONS] IMAGE [IMAGE...] [flags]</span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><pre><code>-f, --force     强制删除--no-prune      不移除该镜像的过程镜像，默认移除</code></pre><p>示例：</p><p>强制删除本地指定名称的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images rmi -f gitlab/gitlab-ce</span><br></pre></td></tr></table></figure><p>其它使用方式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f 2aa1fe2f052b                       <span class="comment"># 根据镜像ID删除指定镜像</span></span><br><span class="line"></span><br><span class="line">docker rmi gulj/centos-vim nginx busybox         <span class="comment"># 删除多个镜像</span></span><br><span class="line"></span><br><span class="line">docker rmi $(docker images -q redis)             <span class="comment"># 删除所有仓库名为reids的镜像</span></span><br><span class="line"></span><br><span class="line">docker rmi $(docker images -q -f dangling=<span class="literal">true</span>)  <span class="comment"># 删除所有的虚悬镜像</span></span><br><span class="line"></span><br><span class="line">docker rmi $(docker images -aq)                  <span class="comment"># 删除所有的镜像</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;获取镜像&quot;&gt;&lt;a href=&quot;#获取镜像&quot; class=&quot;headerlink&quot; title=&quot;获取镜像&quot;&gt;&lt;/a&gt;获取镜像&lt;/h4&gt;&lt;p&gt;官方的 &lt;a href=&quot;https://hub.docker.com/explore/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DockerHub&lt;/a&gt; 上有很多开源的高质量镜像，可以直接供我们使用&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用docker pull 命令直接从 &lt;a href=&quot;https://hub.docker.com/explore/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DockerHub&lt;/a&gt; 上获取&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;格式：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker pull [选项] [docker registry 地址]:&amp;lt;仓库名&amp;gt;:&amp;lt;标签&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;示例：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 获取nginx镜像&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ docker pull nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Using default tag: latest&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;latest: Pulling from library/nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2a72cbf407d6: Pull complete&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fefa2faca81f: Pull complete&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;080aeede8114: Pull complete&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Digest: sha256:c4ee0ecb376636258447e1d8effb56c09c75fe7acf756bf7c13efadf38aa0aca&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Status: Downloaded newer image &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; nginx:latest&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 初识</title>
    <link href="http://www.gulj.cn/2018/03/27/docker-%E5%88%9D%E8%AF%86/"/>
    <id>http://www.gulj.cn/2018/03/27/docker-初识/</id>
    <published>2018-03-27T01:44:09.000Z</published>
    <updated>2018-05-02T08:45:56.356Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>Docker 采用的是 Client/Server 架构。客户端向服务器发送请求，服务器负责构建、运行和分发容器。客户端和服务器可以运行在同一个 Host 上，客户端也可以通过 socket 或 REST API 与远程的服务器通信。</p><h4 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h4><p><img src="http://p6nkwri76.bkt.clouddn.com/15221198968275.jpg" alt=""></p><a id="more"></a><h4 id="核心技术"><a href="#核心技术" class="headerlink" title="核心技术"></a>核心技术</h4><ul><li><p>Namespaces <strong>(namespace)</strong></p><p>  Namespace是Linux提供的一种内核级别环境隔离的方法,提供了对UTS、IPC、mount、PID、network、User等的隔离机制。</p></li><li><p>Control groups <strong>(CGroup)</strong></p><p>  用来限制，控制与分离一个进程组群的资源（如CPU、内存、磁盘输入输出等）<br>  可​​以让​​​您​​​为​​​系​​​统​​​中​​​所​​​运​​​行​​​任​​​务​​​（进​​​程​​​）的​​​用​​​户​​​定​​​义​​​组​​​群​​​分​​​配​​​资​​​源​​​ — 比​​​如​​​ CPU 时​​​间​​​、​​​系​​​统​​​内​​​存​​​、​​​网​​​络​​​带​​​宽​​​或​​​者​​​这​​​些​​​资​​​源​​​的​​​组​​​合。<br>  主要提供了一下功能</p><ul><li>Resource limitation: 限制资源使用，比如内存使用上限以及文件系统的缓存限制。</li><li>Prioritization: 优先级控制，比如：CPU利用和磁盘IO吞吐。</li><li>Accounting: 一些审计或一些统计，主要目的是为了计费。</li><li>Control: 挂起进程，恢复执行进程</li></ul></li><li><p>Union file systems <strong>(AUFS)</strong></p><p>  AUFS是一个能透明覆盖一或多个现有文件系统的层状文件系统。 支持将不同目录挂载到同一个虚拟文件系统下，可以把不同的目录联合在一起，组成一个单一的目录。这种是一种虚拟的文件系统，文件系统不用格式化，直接挂载即可</p><p>  当一个进程需要修改一个文件时，AuFS创建该文件的一个副本。AuFS可以把多层合并成文件系统的单层表示。这个过程称为写入复制copy on write</p></li><li><p>….等</p></li></ul><h4 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h4><ul><li><p>客户端  <strong>Client</strong></p><p>  Docker client 是给用户和 Docker daemon 建立通信的客户端，安装了 docker 之后，二进制文件 docker 就是 Docker client，与 Docker daemon 交互， 通过客户端 docker 命令，我们可以方便地实现对 Docker image 和 container 的管理请求。</p><p>  Docker client 与 docker daemon 建立请求的方式有三种，分别是：</p><ul><li><p>tcp://host:port</p></li><li><p>unix://path/to/socket</p></li><li><p>fd://socketfd</p></li></ul></li><li><p>常驻后台的系统进程  <strong>Docker daemon</strong></p><p>  Docker daemon 是一个常驻后台的系统进程，所谓“运行 docker”，指的就是运行 Docker daemon，其作用主要有以下两点：</p><ul><li><p>接受并处理 Docker Client 发送的请求</p></li><li><p>管理所有的 Docker containers 和 Docker images</p><p>Docker daemon 的架构大致可以分为三部分：Docker Server、Engine 和 Job。</p><p>docker daemon 监听来自 remote api 的请求的方式有三种：unix、tcp 和 fd</p><p>默认配置下，Docker daemon 只能响应来自本地 Host 的客户端请求。如果要允许远程客户端请求，可以使用dockerd命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dockerd -H 0.0.0.0</span><br></pre></td></tr></table></figure></li></ul></li><li><p>镜像    &nbsp;<strong>Image</strong></p><p>  镜像是一个<strong>只读</strong>的层（layer），由文件系统叠加构成，就相当于是一个 root 文件系统，通过它可以创建 Docker 容器（Container）。</p><p>  <strong>分层存储</strong>，每一层都可以添加改变和删除文件，形成一个新的镜像</p><p>  镜像构建时，会一层层构建，前一层是后一层的基础。每一层构建完就不会再发生改变，后一层上的任何改变只发生在自己这一层</p><p>  不同的镜像可以共享相同的层</p><p>  <img src="http://p6nkwri76.bkt.clouddn.com/15221323476589.jpg" alt=""></p></li></ul><ul><li>容器   &nbsp;<strong>Container</strong></li></ul><p>Docker 容器是用于运行镜像的沙箱环境，它是 Docker 镜像的运行实例；容器都是相互隔离、互不可见的，我们可以理解为：镜像是Docker生命周期的打包和构建阶段，而容器是Docker的启动和执行阶段。</p><p>镜像使用的是分层存储，容器也是如此。每一个容器运行时，是以镜像为基础层，在其上创建一个当前容器的存储层，我们可以称这个为容器运行时读写而准备的存储层为容器存储层。</p><p><strong>容器存储层的生存周期和容器一样，容器消亡时，容器存储层也随之消亡。因此，任何保存于容器存储层的信息都会随容器删除而丢失</strong></p><p>数据卷的生存周期独立于容器，容器消亡，数据卷不会消亡。因此，使用数据卷后，容器删除或者重新运行之后，数据却不会丢失。</p><p>在Image Layer之上建立一个 Container Layer（<strong>读写层</strong>），镜像（image）负责app的存储和分发，容器（Container）负责运行app</p><p><img src="http://p6nkwri76.bkt.clouddn.com/15221344845542.jpg" alt=""></p><ul><li>仓库   &nbsp;<strong>Registry</strong></li></ul><p>Registry 是集中的存储、分发镜像的文件仓库</p><p>仓库分为公有仓库和私有仓库，常用的公有仓库是官方的 <a href="https://hub.docker.com/" target="_blank" rel="noopener">Docker Hub</a>，默认的 docker pull 命令就是从官方的公有仓库中拉取镜像；个人可以根据Docker 官方提供了<a href="https://hub.docker.com/_/registry/" target="_blank" rel="noopener"> Docker Registry</a> 镜像，可以直接使用做为私有 Registry 服务</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;Docker 采用的是 Client/Server 架构。客户端向服务器发送请求，服务器负责构建、运行和分发容器。客户端和服务器可以运行在同一个 Host 上，客户端也可以通过 socket 或 REST API 与远程的服务器通信。&lt;/p&gt;
&lt;h4 id=&quot;系统架构&quot;&gt;&lt;a href=&quot;#系统架构&quot; class=&quot;headerlink&quot; title=&quot;系统架构&quot;&gt;&lt;/a&gt;系统架构&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;http://p6nkwri76.bkt.clouddn.com/15221198968275.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 安装</title>
    <link href="http://www.gulj.cn/2018/03/26/Docker-%E5%AE%89%E8%A3%85/"/>
    <id>http://www.gulj.cn/2018/03/26/Docker-安装/</id>
    <published>2018-03-26T09:23:17.000Z</published>
    <updated>2018-05-02T08:45:56.366Z</updated>
    
    <content type="html"><![CDATA[<h4 id="导读"><a href="#导读" class="headerlink" title="导读"></a>导读</h4><p>本系列的docker学习笔者均采用Vagrant和VirtualBox进行，下面我会给出这两款工具的简单介绍。</p><h4 id="Vagrant"><a href="#Vagrant" class="headerlink" title="Vagrant"></a>Vagrant</h4><h5 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a><strong>介绍</strong></h5><p>Vagrant是hashicorp这家公司的产品，是一个让你可以方便设置你想要的虚拟机的便携式工具，它底层支持VirtualBox、VMware甚至AWS作为虚拟机系统。</p><p>我们可以通过Vagrant提供的命令行工具vagrant，可以快速启动根据我们事先定义好的Vagrantfile文件，来创建一个或者多个虚拟机。</p><p>Vagrantfile是用来定义vagrant project的，使用ruby语法。</p><a id="more"></a><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a><strong>安装</strong></h5><p>Vagrant支持Mac、Window,Centos 等各种平台，下图展示支持的各种平台列表<br><img src="/images/docker-version-list.jpg" alt=""></p><p>下载地址：<a href="https://www.vagrantup.com/downloads.html" target="_blank" rel="noopener">https://www.vagrantup.com/downloads.html</a></p><ul><li>查看是否安装成功</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看vagrant版本信息</span></span><br><span class="line">$ vagrant version</span><br></pre></td></tr></table></figure><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a><strong>使用</strong></h5><ul><li><p><strong>添加一个box</strong></p><p><strong>格式</strong>：vagrant box add  远端的box地址或者本地的box文件名</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加 centos/7 的box</span></span><br><span class="line">$ vagrant box add centos/7</span><br></pre></td></tr></table></figure><blockquote><p>通过这个步骤，vagrant会去box列表中找centos/7这个镜像，如果没有就去官方下载</p><p>box的名称我们通过官方提供的地址:<a href="https://app.vagrantup.com/boxes/search?page=1" target="_blank" rel="noopener">https://app.vagrantup.com/boxes/search?page=1</a> 去search</p></blockquote><ul><li><p><strong>初始化</strong></p><p><strong>格式</strong>： vagrant init  box列表中box的名称</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建一个目录，为centos7</span></span><br><span class="line">$ mkdir centos7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入centos7目录，初始化box,这里的（centos/7）就是我们第一步添加的box名称</span></span><br><span class="line">$ vagrant init centos/7</span><br></pre></td></tr></table></figure><blockquote><p>这样就会在当前目录(centos7)生成一个Vagrantfile的文件,注意每个目录只能存放一个Vagrantfile文件，所以我们要事先定义好我们需要创建系统的目录</p></blockquote><ul><li><p><strong>启动虚拟机</strong></p><p>我们已经通过vagrant init centos/7 命令，得到了vagrantfile文件，下面我们可以通过vagrant up 命令来启动vagrantfile中定义的虚拟机</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant up</span><br></pre></td></tr></table></figure><blockquote><p>这样我们就在在Virtualbox中创建了一个虚拟机</p></blockquote><ul><li><strong>连接虚拟机</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant ssh</span><br></pre></td></tr></table></figure><h5 id="Vagrant-的其它基本命令"><a href="#Vagrant-的其它基本命令" class="headerlink" title="Vagrant 的其它基本命令"></a>Vagrant 的其它基本命令</h5><ul><li>查看命令帮助</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><ul><li>查看虚拟机的状态</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant status</span><br></pre></td></tr></table></figure><ul><li>查看box列表</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant box list</span><br></pre></td></tr></table></figure><ul><li>停止虚拟机</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant halt</span><br></pre></td></tr></table></figure><ul><li>销毁虚拟机</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant destory</span><br></pre></td></tr></table></figure><hr><h5 id="通过自定义Vagrantfile来创建虚拟机"><a href="#通过自定义Vagrantfile来创建虚拟机" class="headerlink" title="通过自定义Vagrantfile来创建虚拟机"></a>通过自定义Vagrantfile来创建虚拟机</h5><ul><li><strong>编写Vagrantfile,灵活的设置虚拟机的参数</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- mode: ruby -*-</span></span><br><span class="line"><span class="comment"># vi: set ft=ruby :</span></span><br><span class="line">    </span><br><span class="line">Vagrant.require_version <span class="string">"&gt;= 1.6.0"</span></span><br><span class="line">    </span><br><span class="line">boxes = [</span><br><span class="line">    &#123;</span><br><span class="line">        :name =&gt; <span class="string">"docker-node-test1"</span>,</span><br><span class="line">        :eth1 =&gt; <span class="string">"192.168.215.10"</span>,</span><br><span class="line">        :mem =&gt; <span class="string">"2048"</span>,</span><br><span class="line">        :cpu =&gt; <span class="string">"2"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">    </span><br><span class="line">Vagrant.configure(2) <span class="keyword">do</span> |config|</span><br><span class="line">    </span><br><span class="line">  config.vm.box = <span class="string">"centos/7"</span></span><br><span class="line">    </span><br><span class="line">  boxes.each <span class="keyword">do</span> |opts|</span><br><span class="line">      config.vm.define opts[:name] <span class="keyword">do</span> |config|</span><br><span class="line">        config.vm.hostname = opts[:name]</span><br><span class="line">        config.vm.provider <span class="string">"vmware_fusion"</span> <span class="keyword">do</span> |v|</span><br><span class="line">          v.vmx[<span class="string">"memsize"</span>] = opts[:mem]</span><br><span class="line">          v.vmx[<span class="string">"numvcpus"</span>] = opts[:cpu]</span><br><span class="line">        end</span><br><span class="line">    </span><br><span class="line">        config.vm.provider <span class="string">"virtualbox"</span> <span class="keyword">do</span> |v|</span><br><span class="line">          v.customize [<span class="string">"modifyvm"</span>, :id, <span class="string">"--memory"</span>, opts[:mem]]</span><br><span class="line">          v.customize [<span class="string">"modifyvm"</span>, :id, <span class="string">"--cpus"</span>, opts[:cpu]]</span><br><span class="line">        end</span><br><span class="line">    </span><br><span class="line">        config.vm.network :private_network, ip: opts[:eth1]</span><br><span class="line">      end</span><br><span class="line">  end</span><br><span class="line">    </span><br><span class="line">  <span class="comment">#config.vm.synced_folder "./labs", "/home/vagrant/labs"</span></span><br><span class="line">  <span class="comment">#config.vm.provision "bash", privileged: true, path: "./setup.sh"</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure><blockquote><p>Vagrantfile下载地址： xxxx</p></blockquote><ul><li><strong>创建虚拟机</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant up</span><br></pre></td></tr></table></figure><h5 id="Docker-安装"><a href="#Docker-安装" class="headerlink" title="Docker 安装"></a>Docker 安装</h5><p> 在 Mac 平台上安装</p><blockquote><p>下载地址：<a href="https://www.docker.com/community-edition" target="_blank" rel="noopener">https://www.docker.com/community-edition</a></p></blockquote><p> 在 <strong>centos7</strong> 平台上安装步骤</p><blockquote><p>官网地址：<a href="https://docs.docker.com/install/linux/docker-ce/centos/#install-from-a-package" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/centos/#install-from-a-package</a></p></blockquote><ul><li>卸载老的版本</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum remove docker \</span><br><span class="line">                    docker-client \</span><br><span class="line">                    docker-client-latest \</span><br><span class="line">                    docker-common \</span><br><span class="line">                    docker-latest \</span><br><span class="line">                    docker-latest-logrotate \</span><br><span class="line">                    docker-logrotate \</span><br><span class="line">                    docker-selinux \</span><br><span class="line">                    docker-engine-selinux \</span><br><span class="line">                    docker-engine</span><br></pre></td></tr></table></figure><ul><li><p>安装docker ce (注意docker 有docker ce 和 docker ee 两个版本，我们学习使用docker ce版本)</p><p>①、安装依赖包</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install -y yum-utils \</span><br><span class="line">    device-mapper-persistent-data \</span><br><span class="line">    lvm2</span><br></pre></td></tr></table></figure><p> ②、设置稳定仓库地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum-config-manager \</span><br><span class="line">--add-repo \</span><br><span class="line">https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><p> ③、【可选】启用 edge 和 test 仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用  --enable</span></span><br><span class="line">$ sudo yum-config-manager --<span class="built_in">enable</span> docker-ce-edge</span><br><span class="line"></span><br><span class="line">$ sudo yum-config-manager --<span class="built_in">enable</span> docker-ce-test</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用  --disable</span></span><br><span class="line">$ sudo yum-config-manager --<span class="built_in">disable</span> docker-ce-edge</span><br></pre></td></tr></table></figure><p>④、安装稳定版本的docker ce</p><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install docker-ce</span><br></pre></td></tr></table></figure></code></pre><p>⑤、【可选】查看具体的docker ce 版本，这样我们可以在生产环境安装具体的docker ce 版本</p><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看docker ce 版本列表</span></span><br><span class="line">$ yum list docker-ce --showduplicates | sort -r</span><br><span class="line"></span><br><span class="line">docker-ce.x86_64            18.03.ce-1.el7.centos             docker-ce-stable</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用命令安装具体的docker ce 版本</span></span><br><span class="line">$ sudo yum install &lt;FULLY-QUALIFIED-PACKAGE-NAME&gt;</span><br></pre></td></tr></table></figure></code></pre><p>⑥、启动docker</p><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure></code></pre><p>⑦、验证docker是否正确安装，可以通过运行 helloworld 镜像</p><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure></code></pre><h4 id="docker-machine-创建docker主机"><a href="#docker-machine-创建docker主机" class="headerlink" title="docker-machine 创建docker主机"></a>docker-machine 创建docker主机</h4><p>如果我们已经在mac平台安装过docker，默认会自带docker-machine；到现在我们已经知道了，可以通过virtualbox这个虚拟机软件直接创建虚拟机，安装docker，得到一台docker主机、也可以通过编写vagrantfile创建虚拟机，安装docker，也能得到一台docker主机、现在我们还可以通过docker-machine命令，来创建一台带有docker的主机</p><ul><li>查看版本信息</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine -v</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"> </span><br><span class="line">$ docker-machine create -d virtualbox demo</span><br></pre></td></tr></table></figure><ul><li>创建docker虚拟机 (使用 virtualbox 类型的驱动)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine create demo</span><br></pre></td></tr></table></figure><blockquote><p>你也可以在创建时加上如下参数，来配置主机或者主机上的 Docker。</p></blockquote><blockquote><p>–engine-opt dns=114.114.114.114 配置 Docker 的默认 DNS</p></blockquote><blockquote><p>–engine-registry-mirror <a href="https://registry.docker-cn.com" target="_blank" rel="noopener">https://registry.docker-cn.com</a> 配置 Docker 的仓库镜像</p></blockquote><blockquote><p>–virtualbox-memory 2048 配置主机内存</p></blockquote><blockquote><p>–virtualbox-cpu-count 2 配置主机 CPU</p></blockquote><ul><li>查看虚拟机列表</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine ls</span><br></pre></td></tr></table></figure><ul><li>进入虚拟机</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine ssh demo</span><br></pre></td></tr></table></figure><ul><li>停止虚拟机</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine stop demo</span><br></pre></td></tr></table></figure><p>现在我们已经在mac(宿主机)上安装了docker，又通过 docker-machine 方式创建，得到了一台docker主机；那么现在我们有这样一种需求，如何让宿主机上的docker client端连接，通过docker-machine创建的docker  server端。</p><p><strong>步骤</strong></p><ul><li>查看docker-machine创建虚拟机的环境变量</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 mac（宿主机上） 执行 查看docker-machine</span></span><br><span class="line">$ docker-machine env demo</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> DOCKER_TLS_VERIFY=<span class="string">"1"</span></span><br><span class="line"><span class="built_in">export</span> DOCKER_HOST=<span class="string">"tcp://192.168.99.100:2376"</span></span><br><span class="line"><span class="built_in">export</span> DOCKER_CERT_PATH=<span class="string">"/Users/gulj/.docker/machine/machines/demo"</span></span><br><span class="line"><span class="built_in">export</span> DOCKER_MACHINE_NAME=<span class="string">"demo"</span></span><br><span class="line"><span class="comment"># Run this command to configure your shell:</span></span><br><span class="line"><span class="comment"># eval $(docker-machine env demo)</span></span><br></pre></td></tr></table></figure><ul><li>设置宿主机的docker环境变量为docker-machine创建的docker主机环境变量</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ eval $(docker-machine env demo)</span><br></pre></td></tr></table></figure><ul><li>查看是否修改成功</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:17.12.0-ce</span><br><span class="line"> API version:1.35</span><br><span class="line"> Go version:go1.9.2</span><br><span class="line"> Git commit:c97c6d6</span><br><span class="line"> Built:Wed Dec 27 20:03:51 2017</span><br><span class="line"> OS/Arch:darwin/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:18.03.0-ce</span><br><span class="line">  API version:1.37 (minimum version 1.12)</span><br><span class="line">  Go version:go1.9.4</span><br><span class="line">  Git commit:0520e24</span><br><span class="line">  Built:Wed Mar 21 23:14:54 2018</span><br><span class="line">  OS/Arch:linux/amd64</span><br><span class="line">  Experimental:<span class="literal">false</span></span><br></pre></td></tr></table></figure><blockquote><p>这样宿主机的docker client端就已经连接到通过docker-machine创建的docker主机server端，那么我们在本地操作的docker任何命令，直接作用于 docker-machine 创建的docker主机</p></blockquote><h4 id="Docker-在线实验室-，无需安装，直接使用"><a href="#Docker-在线实验室-，无需安装，直接使用" class="headerlink" title="Docker 在线实验室 ，无需安装，直接使用"></a>Docker 在线实验室 ，无需安装，直接使用</h4><h5 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h5><p>  <a href="https://labs.play-with-docker.com/" target="_blank" rel="noopener">https://labs.play-with-docker.com/</a></p><h5 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h5><p>Play With Docker ( Docker 在线实验室) 是一个运行在浏览器中的 Docker Playground，无需安装任何环境，就可以在线体验 Docker</p><h5 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h5><p><img src="/images/docker-play-groud.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;导读&quot;&gt;&lt;a href=&quot;#导读&quot; class=&quot;headerlink&quot; title=&quot;导读&quot;&gt;&lt;/a&gt;导读&lt;/h4&gt;&lt;p&gt;本系列的docker学习笔者均采用Vagrant和VirtualBox进行，下面我会给出这两款工具的简单介绍。&lt;/p&gt;
&lt;h4 id=&quot;Vagrant&quot;&gt;&lt;a href=&quot;#Vagrant&quot; class=&quot;headerlink&quot; title=&quot;Vagrant&quot;&gt;&lt;/a&gt;Vagrant&lt;/h4&gt;&lt;h5 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;&lt;strong&gt;介绍&lt;/strong&gt;&lt;/h5&gt;&lt;p&gt;Vagrant是hashicorp这家公司的产品，是一个让你可以方便设置你想要的虚拟机的便携式工具，它底层支持VirtualBox、VMware甚至AWS作为虚拟机系统。&lt;/p&gt;
&lt;p&gt;我们可以通过Vagrant提供的命令行工具vagrant，可以快速启动根据我们事先定义好的Vagrantfile文件，来创建一个或者多个虚拟机。&lt;/p&gt;
&lt;p&gt;Vagrantfile是用来定义vagrant project的，使用ruby语法。&lt;/p&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Charles进行HTTPS抓包</title>
    <link href="http://www.gulj.cn/2017/12/27/Charles%E8%BF%9B%E8%A1%8CHTTPS%E6%8A%93%E5%8C%85/"/>
    <id>http://www.gulj.cn/2017/12/27/Charles进行HTTPS抓包/</id>
    <published>2017-12-27T07:28:29.000Z</published>
    <updated>2018-05-02T08:45:56.364Z</updated>
    
    <content type="html"><![CDATA[<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>Charles其实是一款代理服务器，通过成为电脑或者浏览器的代理，然后截取请求和请求结果达到分析抓包的目的。charles有Window版本和Mac OS版本，也同时支持ios和Android手机系统</p><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p><strong>百度云</strong>：<a href="">Charles 4.2.1 Mac破解版</a></p><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul><li>Charles 4.2.1</li><li>Iphone 7P ios 11.0.1</li></ul><a id="more"></a><h3 id="使用前提"><a href="#使用前提" class="headerlink" title="使用前提"></a>使用前提</h3><ul><li>保证iOS设备iphone或ipad与运行Charles的mac电脑处于同一个wifi环境下</li></ul><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><ul><li><strong>①、配置HTTP代理，这步与抓取HTTP请求是一样的</strong></li></ul><p>打开: <strong>charles</strong> 的 <strong>Proxy</strong> 选项选择 <strong>Proxy Settings</strong></p><p>按照下图配置:</p><p><img src="/images/15143553748838.jpg" alt="">x<br><strong>备注</strong>：选择在8888端口上监听，然后确定。够选了SOCKS proxy，还能截获到浏览器的http访问请求。</p><ul><li>②、<strong>配置SSL代理</strong></li></ul><p>打开： <strong>charles</strong> 的 <strong>Proxy</strong> 选项选择 <strong>SSL Proxy Settings</strong><br>在 SSL Proxying 的Tab项中 点击 Add 按钮，按下图填写</p><p><img src="/images/15143559937031.jpg" alt=""></p><p>添加好之后，如下图展示：</p><p><img src="/images/15143557791068.jpg" alt=""></p><h3 id="手机端设置代理和安装Charles根证书"><a href="#手机端设置代理和安装Charles根证书" class="headerlink" title="手机端设置代理和安装Charles根证书"></a>手机端设置代理和安装Charles根证书</h3><h5 id="1、手机端安装Charles根证书"><a href="#1、手机端安装Charles根证书" class="headerlink" title="1、手机端安装Charles根证书"></a>1、手机端安装Charles根证书</h5><p>在Safri上地址栏粘贴 <strong>chls.pro/ss</strong> 点击立即前往，自动下载根证书<br><img src="/images/15143566512500.jpg" alt=""></p><p>而在ios10.3之后，安装新的自定义证书默认是不受信任的，如果要信任已安装的自定义证书,需要手动打开开关以信任证书。</p><p><strong>开始信任证书步骤：</strong><br>设置-&gt;通用-&gt;关于本机-&gt;证书信任设置-&gt; 找到charles proxy custom root certificate然后信任该证书即可.</p><p><img src="/images/15143569471035.jpg" alt=""></p><h5 id="2、手机端手机设置代理"><a href="#2、手机端手机设置代理" class="headerlink" title="2、手机端手机设置代理"></a><strong>2、手机端手机设置代理</strong></h5><p>打开： <strong>charles</strong> 的 <strong>Help</strong> 选项选择 <strong> Install Charles Root Certificate On a Mobile Device Or a Remote Browser </strong></p><p><img src="/images/15143577308764.jpg" alt=""></p><p>点击 ok 按钮</p><p><img src="/images/15143578310275.jpg" alt=""></p><p>首先在Mac上，查看IP地址：<br>方法一：系统偏好设置-&gt;网络-&gt;wifi-&gt;高级-&gt;TCP/IP<br>方法二：ifcofnig 命令 （在终端或者Iterm上）<br>本机Ip：192.168.6.174<br><img src="/images/15143541586385.jpg" alt=""></p><p>打开手机：</p><p><strong>设置</strong>界面，选择无线局域网</p><p><img src="/images/15143587906158.jpg" alt=""></p><p>进入<strong>无线局域网</strong>界面，点击所连的无线网旁边的 i 图标</p><p><img src="/images/15143590599615.jpg" alt=""></p><p>进入<strong>配置代理</strong>界面，点击底部的配置代理，改为手动模式</p><p><img src="/images/15143591666648.jpg" alt=""></p><p>配置代理<br>服务器地址：填写本机Mac的Ip地址，<br>端口：填写 charles 的 代理端口，默认是：8888；也可以自定义修改</p><p><img src="/images/15143579689140.jpg" alt=""></p><p>配置好之后，Mac上会弹出以下提示框，表示Charles软件检测到可供检测的设备。两个按钮选项：Allow 允许 ， Deny拒绝。我们要选择允许</p><p><img src="/images/15143585596777.jpg" alt=""></p><h3 id="电脑端-Mac-安装Charles根证书"><a href="#电脑端-Mac-安装Charles根证书" class="headerlink" title="电脑端(Mac)安装Charles根证书"></a>电脑端(Mac)安装Charles根证书</h3><p>直接在Charles的Help菜单中安装；安装完成后去系统的钥匙串访问中信任它</p><p><img src="/images/15143609984817.jpg" alt=""></p><p>在本机的系统的钥匙串访问中，找到Charles证书，默认是不被信任的，双击，该证书，修改为始终信任</p><p><img src="/images/15143611054154.jpg" alt=""></p><h3 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h3><p><img src="/images/15143619290731.jpg" alt=""></p><p>__</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h3&gt;&lt;p&gt;Charles其实是一款代理服务器，通过成为电脑或者浏览器的代理，然后截取请求和请求结果达到分析抓包的目的。charles有Window版本和Mac OS版本，也同时支持ios和Android手机系统&lt;/p&gt;
&lt;h3 id=&quot;下载&quot;&gt;&lt;a href=&quot;#下载&quot; class=&quot;headerlink&quot; title=&quot;下载&quot;&gt;&lt;/a&gt;下载&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;百度云&lt;/strong&gt;：&lt;a href=&quot;&quot;&gt;Charles 4.2.1 Mac破解版&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Charles 4.2.1&lt;/li&gt;
&lt;li&gt;Iphone 7P ios 11.0.1&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="charles" scheme="http://www.gulj.cn/tags/charles/"/>
    
  </entry>
  
  <entry>
    <title>ELK(5.6.3)技术栈集群搭建</title>
    <link href="http://www.gulj.cn/2017/11/24/ELK5-X%E6%8A%80%E6%9C%AF%E6%A0%88%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"/>
    <id>http://www.gulj.cn/2017/11/24/ELK5-X技术栈集群搭建/</id>
    <published>2017-11-24T14:28:29.000Z</published>
    <updated>2018-05-02T08:45:56.366Z</updated>
    
    <content type="html"><![CDATA[<p><strong>1、ElasticSearch单节点和集群搭建</strong></p><p><strong>系统环境</strong></p><table><thead><tr><th>系统/软件</th><th>版本</th></tr></thead><tbody><tr><td>centos</td><td>7</td></tr><tr><td>jdk            # <strong>es 依赖jdk</strong></td><td>8</td></tr><tr><td>node        # <strong>es 安装head插件需要</strong></td><td>8.2.1</td></tr><tr><td>elasticsearch</td><td>5.6.3</td></tr><tr><td>logstash</td><td>5.6.3</td></tr><tr><td>kibana</td><td>5.6.3</td></tr></tbody></table><a id="more"></a><p><strong>机器规划及节点分布</strong></p><table><thead><tr><th>主机</th><th>节点</th><th>节点</th><th>节点</th></tr></thead><tbody><tr><td>192.168.1.110</td><td>elasticsearch-master</td><td>logstash</td><td>kibana</td></tr><tr><td>192.168.1.111</td><td>Elasticsearch-slave1</td><td>logstash</td><td></td></tr><tr><td>192.168.1.112</td><td>Elasticsearch-slave2</td><td>logstash</td></tr></tbody></table><p><strong>目录分配</strong></p><ul><li>下载软件源码包存放的位置:</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/src/</span><br></pre></td></tr></table></figure><ul><li>安装位置:</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/</span><br></pre></td></tr></table></figure><p><strong>相关软件包官方下载地址</strong></p><blockquote><p><a href="https://www.elastic.co/downloads" target="_blank" rel="noopener">https://www.elastic.co/downloads</a></p></blockquote><h5 id="①、elasticsearch-单节点安装（192-168-1-110）"><a href="#①、elasticsearch-单节点安装（192-168-1-110）" class="headerlink" title="①、elasticsearch 单节点安装（192.168.1.110）"></a>①、elasticsearch 单节点安装（192.168.1.110）</h5><p>下载：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.3.tar.gz</span><br></pre></td></tr></table></figure><p>解压缩</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf elasticsearch-5.6.3.tar.gz</span><br></pre></td></tr></table></figure><p>创建软链接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/elasticsearch-5.6.3/ /usr/local/elasticsearch-master</span><br></pre></td></tr></table></figure><p>创建elasticsearch用户，把elasticsearch-master的所有者和所有组设置为用户elasticsearch（ES不能以root用户启动）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 添加 elasticsearch 用户</span><br><span class="line">useradd elasticsearch</span><br><span class="line"><span class="meta">#</span> 为 elasticsearch 用户设置密码</span><br><span class="line">passwd elasticsearch</span><br><span class="line"><span class="meta">#</span> 将 elasticsearch-master 的目录的所有者和所属组设置为用户 elasticsearch</span><br><span class="line">chown -R elasticsearch:elasticsearch /usr/local/elasticsearch-master</span><br></pre></td></tr></table></figure><p>启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 进入es的根目录</span><br><span class="line">cd elasticsearch-master</span><br><span class="line"><span class="meta">#</span> 启动(放入后台启动，注意不能以root用户启动,以elasticsearch用户启动)</span><br><span class="line">./bin/elasticsearch -d</span><br><span class="line"><span class="meta">#</span> 访问es</span><br><span class="line">http://localhost:9200</span><br></pre></td></tr></table></figure><p><strong>elastisearch 安装常见错误日志和解决方案参考地址：</strong></p><ul><li>报错”max virtual memory areas vm.max<em>map</em>count [65530] is too low”，要运行下面的命令。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -w vm.max_map_count=262144</span><br></pre></td></tr></table></figure><ul><li>其它报错信息解决方案参考地址</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.jianshu.com/p/4c6f9361565b</span><br></pre></td></tr></table></figure><p>测试ES服务是否启动正常（默认监听9200端口）</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 访问地址</span><br><span class="line">http://192.168.1.110:9200</span><br><span class="line"># 返回数据</span><br><span class="line">&#123;</span><br><span class="line">name: "aRvmIj4",</span><br><span class="line">cluster_name: "elasticsearch",</span><br><span class="line">cluster_uuid: "tXoxyBvmSFGNkiJfAOJWXw",</span><br><span class="line">version: &#123;</span><br><span class="line">  number: "5.6.3",</span><br><span class="line">  build_hash: "1a2f265",</span><br><span class="line">  build_date: "2017-11-24T20:33:39.012Z",</span><br><span class="line">  build_snapshot: false,</span><br><span class="line">  lucene_version: "6.6.1"</span><br><span class="line">&#125;,</span><br><span class="line">tagline: "You Know, for Search"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ES的Head插件安装（提供友好的web界面，es一些基本信息的查询）</p><p>下载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget  https://github.com/mobz/elasticsearch-head/archive/master.zip</span><br></pre></td></tr></table></figure><p>解压缩</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip master.zip</span><br></pre></td></tr></table></figure><p>安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 进入 elasticsearch-head-master 目录</span><br><span class="line">cd elasticsearch-head-master</span><br><span class="line"><span class="meta">#</span> 执行 npm install </span><br><span class="line">npm install</span><br><span class="line"><span class="meta">#</span> 运行 npm run start</span><br><span class="line">npm run start</span><br></pre></td></tr></table></figure><p>访问ESHead插件（默认监听9100端口）</p><blockquote><p><a href="http://localhost:9100" target="_blank" rel="noopener">http://localhost:9100</a></p></blockquote><p>ES和Head插件关联配置(ES和Head插件属于两个不同的进程，解决跨域问题)</p><p>修改:<strong>elasticsearch-5.6.3/config/elasticsearch.yml</strong>配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 编辑ES配置文件</span><br><span class="line">vim elasticsearch.yml</span><br><span class="line"><span class="meta">#</span> 在配置文件最后添加两行配置</span><br><span class="line">http.cors.enabled: true   # 注意yml文件的格式，true 前面有空格</span><br><span class="line">http.cors.allow-origin: "*"</span><br></pre></td></tr></table></figure><p>最后重启ES服务和ES的Head插件，配置完成</p><h5 id="②、elasticsearch-集群（1-master，2个slave）-gt-192-168-1-110-master-192-168-1-111-192-168-1-112"><a href="#②、elasticsearch-集群（1-master，2个slave）-gt-192-168-1-110-master-192-168-1-111-192-168-1-112" class="headerlink" title="②、elasticsearch 集群（1 master，2个slave）-&gt; (192.168.1.110(master),192.168.1.111,192.168.1.112)"></a>②、elasticsearch 集群（1 master，2个slave）-&gt; (192.168.1.110(master),192.168.1.111,192.168.1.112)</h5><p>基于第一步单节点(192.168.1.110)安装集群（我们把它设置为Master节点）</p><p>修改:<strong>elasticsearch-master/config/elasticsearch.yml</strong>配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 解决跨域问题</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: "*"</span><br><span class="line"><span class="meta">#</span> 集群名称</span><br><span class="line">cluster.name: gulj-es</span><br><span class="line"><span class="meta">#</span> 节点名称</span><br><span class="line">node.name: es-master</span><br><span class="line"><span class="meta">#</span> 告知节点为master节点</span><br><span class="line">node.master: true</span><br><span class="line"><span class="meta">#</span> 设置是否为数据节点</span><br><span class="line">node.data: true</span><br><span class="line"><span class="meta">#</span> Ip地址</span><br><span class="line">network.host: 192.168.1.110</span><br><span class="line"><span class="meta">#</span> 端口</span><br><span class="line">http.port: 9200</span><br><span class="line"><span class="meta">#</span> 日志存放位置</span><br><span class="line">path.logs: /data/elasticsearch/logs</span><br><span class="line"><span class="meta">#</span> 数据存放位置</span><br><span class="line">path.data: /data/elasticsearch/data</span><br><span class="line"><span class="meta">#</span> 单播，配置集群中的所有节点</span><br><span class="line">discovery.zen.ping.unicast.hosts: ["192.168.1.110","192.168.1.111"]</span><br></pre></td></tr></table></figure><p>重新解压缩elasticsearch-5.6.3.tar.gz包复制两份，</p><p>分别命名为 elasticsearch_slave1（节点：192.168.1.111）和elasticsearch_slave2（节点：192.168.1.112）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 解压缩 es 包</span><br><span class="line">tar -zxvf elasticsearch-5.6.3.tar.gz</span><br><span class="line"><span class="meta">#</span> 复制两份 es 并重命名</span><br><span class="line">cp -r elasticsearch-5.6.3 elasticsearch_slave1</span><br><span class="line">cp -r elasticsearch-5.6.3 elasticsearch_slave2</span><br></pre></td></tr></table></figure><p>分别修改 elasticsearch_slave1、elasticsearch_slave2 的 <strong>elasticsearch.yml</strong> 配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 集群名称</span><br><span class="line">cluster.name: gulj-es</span><br><span class="line"><span class="meta">#</span> 节点名称,注意salve2节点,需要命名为对应的es-slave02</span><br><span class="line">node.name: es-slave01</span><br><span class="line"><span class="meta">#</span> 不是master</span><br><span class="line">node.master: false</span><br><span class="line"><span class="meta">#</span> 数据节点</span><br><span class="line">node.data: true</span><br><span class="line"><span class="meta">#</span> 绑定的Ip</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line"><span class="meta">#</span> 绑定端口</span><br><span class="line">http.port: 9200</span><br><span class="line"><span class="meta">#</span> 日志位置</span><br><span class="line">path.logs: /data/elasticsearch/logs</span><br><span class="line"><span class="meta">#</span> 数据位置</span><br><span class="line">path.data: /data/elasticsearch/data</span><br><span class="line"><span class="meta">#</span> 单播发现</span><br><span class="line">discovery.zen.ping.unicast.hosts: ["192.168.1.110"]</span><br><span class="line"><span class="meta">#</span> 解决跨域</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: "*"</span><br></pre></td></tr></table></figure><p>elasticsearch_slave2的配置文件和elasticsearch_slave1的配置文件大致相同，只需要修改node.name（节点名称）这里不再演示(<strong>注意防火墙的设置，建议关闭</strong>)</p><p>Elasticsearch Head 插件页面展示</p><p><img src="/images/es-cluster-head.jpeg" alt=""></p><h2 id="2、logStash安装"><a href="#2、logStash安装" class="headerlink" title="2、logStash安装"></a>2、logStash安装</h2><h5 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget  https://artifacts.elastic.co/downloads/logstash/logstash-5.6.3.tar.gz</span><br></pre></td></tr></table></figure><p>解压缩</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf logstash-5.6.3.tar.gz</span><br></pre></td></tr></table></figure><p>创建软链接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 创建软连接</span><br><span class="line">ln -s /usr/local/logstash-5.6.3  /usr/local/logstash</span><br></pre></td></tr></table></figure><p>创建logstash配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 创建logstash配置文件</span><br><span class="line">vim logstash.conf</span><br></pre></td></tr></table></figure><p><strong>logstash.conf</strong>  文件内容（根据各自的业务需求，收集相应的日志，具体语法，参考官方文档）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">     file &#123;</span><br><span class="line">        # 收集ES的Log日志</span><br><span class="line">        path =&gt; "/data/elasticsearch/logs/gulj-es.log"</span><br><span class="line">        # 自定义类型</span><br><span class="line">        type =&gt; "es-master"</span><br><span class="line">        # 从开始位置进行收集</span><br><span class="line">        start_position =&gt; "beginning"</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line">  elasticsearch&#123;</span><br><span class="line">       # ES节点主机地址</span><br><span class="line">       hosts =&gt; ["192.168.1.110:9200"]   </span><br><span class="line">       # 设置索引名称</span><br><span class="line">       index =&gt; "es-master-log"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 启动logstash</span><br><span class="line">./bin/logstash -f  logstash.conf</span><br></pre></td></tr></table></figure><h2 id="3、Kibana安装"><a href="#3、Kibana安装" class="headerlink" title="3、Kibana安装"></a>3、Kibana安装</h2><p>下载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/kibana/kibana-5.6.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><p>解压缩</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf kibana-5.6.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><p>创建软连接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/kibana-5.6.3-linux-x86_64 /usr/local/kibana</span><br></pre></td></tr></table></figure><p>修改配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 打开kibana配置文件</span><br><span class="line">vim kibana/conf/kibana.yml</span><br><span class="line"><span class="meta">#</span> 打开或修改以下配置参数</span><br><span class="line"><span class="meta">#</span> 监听端口</span><br><span class="line">server.port: 5601</span><br><span class="line"><span class="meta">#</span> 监听主机</span><br><span class="line">server.host: "192.168.1.110"</span><br><span class="line"><span class="meta">#</span> ES服务地址</span><br><span class="line">elasticsearch.url: "http://192.168.1.110:9200"</span><br><span class="line"><span class="meta">#</span> kibana的索引</span><br><span class="line">kibana.index: ".kibana"</span><br></pre></td></tr></table></figure><p>启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 启动kibana</span><br><span class="line">./bin/kibana</span><br></pre></td></tr></table></figure><p>Kibana页面展示</p><p><img src="/images/es-kibana.jpeg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;1、ElasticSearch单节点和集群搭建&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;系统环境&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;系统/软件&lt;/th&gt;
&lt;th&gt;版本&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;centos&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;jdk            # &lt;strong&gt;es 依赖jdk&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;node        # &lt;strong&gt;es 安装head插件需要&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;8.2.1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;elasticsearch&lt;/td&gt;
&lt;td&gt;5.6.3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;logstash&lt;/td&gt;
&lt;td&gt;5.6.3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kibana&lt;/td&gt;
&lt;td&gt;5.6.3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="elk" scheme="http://www.gulj.cn/tags/elk/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearch常用API使用教程</title>
    <link href="http://www.gulj.cn/2017/11/10/ElasticSearch%E5%B8%B8%E7%94%A8API%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"/>
    <id>http://www.gulj.cn/2017/11/10/ElasticSearch常用API使用教程/</id>
    <published>2017-11-10T02:44:00.000Z</published>
    <updated>2018-05-02T08:45:56.355Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ElasticSearch-常用API使用教程"><a href="#ElasticSearch-常用API使用教程" class="headerlink" title="ElasticSearch 常用API使用教程"></a>ElasticSearch 常用API使用教程</h3><h3 id="1、基本概念介绍"><a href="#1、基本概念介绍" class="headerlink" title="1、基本概念介绍"></a>1、基本概念介绍</h3><ul><li>索引：含有相同属性的集合</li><li>类型：索引可以定义一个或者多个类型，文档必须属于一个类型</li><li>文档：文档是可以被索引的基本数据单位</li><li>分片：每个索引都有多个分片，每个分片都是Lucene索引</li><li>备份：拷贝一份分片就完成了分片的备份</li></ul><a id="more"></a><h3 id="2、API使用"><a href="#2、API使用" class="headerlink" title="2、API使用"></a>2、API使用</h3><ul><li>API基本格式：http://<ip>:<port>/&lt;索引&gt;/&lt;类型&gt;/&lt;文档id&gt;</port></ip></li></ul><ul><li>常用的HTTP动词：GET/PUT/POST/DELETE</li></ul><h5 id="索引操作"><a href="#索引操作" class="headerlink" title="索引操作"></a>索引操作</h5><p>新建索引</p><ul><li>直接新建一个book索引</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X PUT 'localhost:9200/book'</span><br></pre></td></tr></table></figure><ul><li>通过新建类型为program_book来新建book索引</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X PUT 'localhost:9200/book' -d '</span><br><span class="line">&#123;</span><br><span class="line">   "mappings": &#123;</span><br><span class="line"><span class="code">       "program_book": &#123;</span></span><br><span class="line"><span class="code">           "properties": &#123;</span></span><br><span class="line"><span class="code">               "title": &#123;</span></span><br><span class="line"><span class="code">                   "type": "text",</span></span><br><span class="line"><span class="code">                   "analyzer": "ik_max_word",</span></span><br><span class="line"><span class="code">                   "search_analyzer": "ik_max_word"</span></span><br><span class="line"><span class="code">               &#125;,</span></span><br><span class="line"><span class="code">               "author": &#123;</span></span><br><span class="line"><span class="code">                   "type": "keyword"</span></span><br><span class="line"><span class="code">               &#125;,</span></span><br><span class="line"><span class="code">               "number": &#123;</span></span><br><span class="line"><span class="code">                   "type": "integer"</span></span><br><span class="line"><span class="code">               &#125;,</span></span><br><span class="line"><span class="code">               "create_time": &#123;</span></span><br><span class="line"><span class="code">                   "type": "date",</span></span><br><span class="line"><span class="code">                   "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"</span></span><br><span class="line"><span class="code">               &#125;</span></span><br><span class="line"><span class="code">           &#125;</span></span><br><span class="line"><span class="code">       &#125;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;'</span><br><span class="line"></span><br><span class="line"><span class="section"># 或者</span></span><br><span class="line">curl -X POST 'localhost:9200/book/program<span class="emphasis">_book/_</span>mapping?pretty' -d'&#123;</span><br><span class="line"><span class="code">    "program_book": &#123;</span></span><br><span class="line"><span class="code">        "properties": &#123;</span></span><br><span class="line"><span class="code">            "title": &#123;</span></span><br><span class="line"><span class="code">                "type": "text",</span></span><br><span class="line"><span class="code">                "analyzer": "ik_max_word",</span></span><br><span class="line"><span class="code">                "search_analyzer": "ik_max_word"</span></span><br><span class="line"><span class="code">            &#125;,</span></span><br><span class="line"><span class="code">            "author": &#123;</span></span><br><span class="line"><span class="code">                "type": "keyword"</span></span><br><span class="line"><span class="code">            &#125;,</span></span><br><span class="line"><span class="code">            "number": &#123;</span></span><br><span class="line"><span class="code">                "type": "integer"</span></span><br><span class="line"><span class="code">            &#125;,</span></span><br><span class="line"><span class="code">            "create_time": &#123;</span></span><br><span class="line"><span class="code">                "type": "date",</span></span><br><span class="line"><span class="code">                "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"</span></span><br><span class="line"><span class="code">            &#125;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure><ul><li>通过插入一个或者多个文档来新建book索引</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X PUT 'localhost:9200/book/program_book/1' -d '</span><br><span class="line"> &#123;</span><br><span class="line">   "title": "Java并发编程实战",</span><br><span class="line">   "author": "Doug",</span><br><span class="line">   "number": 100,</span><br><span class="line">   "create_time":"2017-08-01"</span><br><span class="line"> &#125;'</span><br></pre></td></tr></table></figure><p>查看新建的所有索引</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X GET 'localhost:9200/_cat/indices?v'</span><br></pre></td></tr></table></figure><p>删除索引</p><ul><li>删除 book 索引</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X DELETE 'localhost:9200/book'</span><br></pre></td></tr></table></figure><p><strong>类型操作</strong></p><p>新建类型</p><ul><li>新建 program_book 类型</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X PUT 'localhost:9200/book' -d '</span><br><span class="line">&#123;</span><br><span class="line">   "mappings": &#123;</span><br><span class="line"><span class="code">       "program_book": &#123;</span></span><br><span class="line"><span class="code">           "properties": &#123;</span></span><br><span class="line"><span class="code">               "title": &#123;</span></span><br><span class="line"><span class="code">                   "type": "text",</span></span><br><span class="line"><span class="code">                   "analyzer": "ik_max_word",</span></span><br><span class="line"><span class="code">                   "search_analyzer": "ik_max_word"</span></span><br><span class="line"><span class="code">               &#125;,</span></span><br><span class="line"><span class="code">               "author": &#123;</span></span><br><span class="line"><span class="code">                   "type": "keyword"</span></span><br><span class="line"><span class="code">               &#125;,</span></span><br><span class="line"><span class="code">               "number": &#123;</span></span><br><span class="line"><span class="code">                   "type": "integer"</span></span><br><span class="line"><span class="code">               &#125;,</span></span><br><span class="line"><span class="code">               "create_time": &#123;</span></span><br><span class="line"><span class="code">                   "type": "date",</span></span><br><span class="line"><span class="code">                   "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"</span></span><br><span class="line"><span class="code">               &#125;</span></span><br><span class="line"><span class="code">           &#125;</span></span><br><span class="line"><span class="code">       &#125;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure><p>修改类型</p><ul><li>索引book，给类型program_book 新增一个update_time字段</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ curl-XPOST'localhost: 9200/book/program<span class="emphasis">_book/_</span>mapping?pretty'-d'&#123;</span><br><span class="line"><span class="code">    "program_books": &#123;</span></span><br><span class="line"><span class="code">        "properties": &#123;</span></span><br><span class="line"><span class="code">            "update_time": &#123;</span></span><br><span class="line"><span class="code">                "type": "date",</span></span><br><span class="line"><span class="code">                "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"</span></span><br><span class="line"><span class="code">            &#125;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure><p><strong>文档操作</strong></p><p>新增文档</p><ul><li>新增单条文档，指定Id</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl-XPUT'localhost: 9200/book/program_book/1'-d'&#123;</span><br><span class="line"><span class="code">    "title": "重构",</span></span><br><span class="line"><span class="code">    "author": "佚名",</span></span><br><span class="line"><span class="code">    "number": 50,</span></span><br><span class="line"><span class="code">    "create_time": "2017-01-11"</span></span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure><ul><li>新增单条文档，不指定id</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl-XPUT'localhost: 9200/book/program_book'-d'&#123;</span><br><span class="line"><span class="code">    "title": "重构",</span></span><br><span class="line"><span class="code">    "author": "佚名",</span></span><br><span class="line"><span class="code">    "number": 50,</span></span><br><span class="line"><span class="code">    "create_time": "2017-01-11"</span></span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure><p>查看文档</p><ul><li>查看/book/program_book/1这条记录，URL 的参数pretty=true表示以易读的格式返回。</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl 'localhost:9200/book/program_book/1?pretty=true'</span><br></pre></td></tr></table></figure><p>修改文档</p><ul><li>修改就是使用 PUT 请求，重新发送一次新增文档的数据。</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl-XPUT'localhost: 9200/book/program_book/1'-d'&#123;</span><br><span class="line"><span class="code">    "title": "修改操作-重构",</span></span><br><span class="line"><span class="code">    "author": "佚名",</span></span><br><span class="line"><span class="code">    "number": 50,</span></span><br><span class="line"><span class="code">    "create_time": "2017-01-11"</span></span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure><p>删除文档</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X DELETE 'localhost:9200/book/program_book/1'</span><br></pre></td></tr></table></figure><p>复杂查询</p><ul><li>查询指定索引，指定类型的的所有文档(/Index/Type/_search)</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl 'localhost:9200/book/program<span class="emphasis">_book/_</span>search?pretty'</span><br></pre></td></tr></table></figure><ul><li>使用 Match 查询,指定的匹配条件查询</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">curl'localhost: 9200/book/program<span class="emphasis">_book/_</span>search?pretty'-d'&#123;</span><br><span class="line"><span class="code">    "query": &#123;</span></span><br><span class="line"><span class="code">        "match": &#123;</span></span><br><span class="line"><span class="code">            "title": "重构"</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;,</span></span><br><span class="line"><span class="code">    "from": 1,    </span></span><br><span class="line"><span class="code">    "size": 1,</span></span><br><span class="line"><span class="code">    "sort": &#123;</span></span><br><span class="line"><span class="code">        "create_time": &#123;</span></span><br><span class="line"><span class="code">            "order": "desc"</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line">&#125;'</span><br><span class="line"></span><br><span class="line"><span class="section"># 参数解释</span></span><br><span class="line"><span class="section"># from 偏移量，指定查询从位置1开始（默认是从位置0开始）</span></span><br><span class="line"><span class="section"># size 指定返回数据的个数为1条</span></span><br><span class="line"><span class="section"># 根据 create_time 进行排序</span></span><br></pre></td></tr></table></figure><ul><li>使用 Match 查询,指定的匹配条件查询  （查询多个搜索关键字， Elastic 认为它们是or关系）</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl'localhost: 9200/book/program<span class="emphasis">_book/_</span>search?pretty'-d'&#123;</span><br><span class="line"><span class="code">    "query": &#123;</span></span><br><span class="line"><span class="code">        "match": &#123;</span></span><br><span class="line"><span class="code">            "title": "重构 修改"</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;,</span></span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure><ul><li>使用 Must 查询,指定的匹配条件查询  （查询多个搜索关键字， Elastic 认为它们是and关系）</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ curl 'localhost:9200/book/program<span class="emphasis">_book/_</span>search?pretty'  -d '</span><br><span class="line"> &#123;</span><br><span class="line">   "query": &#123;</span><br><span class="line"><span class="code">     "bool": &#123;</span></span><br><span class="line"><span class="code">       "must": [</span></span><br><span class="line"><span class="code">         &#123; "match": &#123; "desc": "重构" &#125; &#125;,</span></span><br><span class="line"><span class="code">         &#123; "match": &#123; "desc": "修改" &#125; &#125;</span></span><br><span class="line"><span class="code">       ]</span></span><br><span class="line"><span class="code">     &#125;</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;'</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ElasticSearch-常用API使用教程&quot;&gt;&lt;a href=&quot;#ElasticSearch-常用API使用教程&quot; class=&quot;headerlink&quot; title=&quot;ElasticSearch 常用API使用教程&quot;&gt;&lt;/a&gt;ElasticSearch 常用API使用教程&lt;/h3&gt;&lt;h3 id=&quot;1、基本概念介绍&quot;&gt;&lt;a href=&quot;#1、基本概念介绍&quot; class=&quot;headerlink&quot; title=&quot;1、基本概念介绍&quot;&gt;&lt;/a&gt;1、基本概念介绍&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;索引：含有相同属性的集合&lt;/li&gt;
&lt;li&gt;类型：索引可以定义一个或者多个类型，文档必须属于一个类型&lt;/li&gt;
&lt;li&gt;文档：文档是可以被索引的基本数据单位&lt;/li&gt;
&lt;li&gt;分片：每个索引都有多个分片，每个分片都是Lucene索引&lt;/li&gt;
&lt;li&gt;备份：拷贝一份分片就完成了分片的备份&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="elasticsearch" scheme="http://www.gulj.cn/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Linux服务管理</title>
    <link href="http://www.gulj.cn/2017/10/11/Linux%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/"/>
    <id>http://www.gulj.cn/2017/10/11/Linux服务管理/</id>
    <published>2017-10-11T09:36:27.000Z</published>
    <updated>2018-05-02T08:45:56.364Z</updated>
    
    <content type="html"><![CDATA[<h3 id="运行级别"><a href="#运行级别" class="headerlink" title="运行级别"></a>运行级别</h3><table><thead><tr><th>运行级别</th><th>含义</th></tr></thead><tbody><tr><td>0</td><td>关机</td></tr><tr><td>1</td><td>单用户模式，只要用于系统修复</td></tr><tr><td>2</td><td>不完全的命令行模式，不含NFS模式</td></tr><tr><td>3</td><td>完整的命令行模式，就是标准字符页面</td></tr><tr><td>4</td><td>系统保留</td></tr><tr><td>5</td><td>图形模式</td></tr><tr><td>6</td><td>重启</td></tr></tbody></table><a id="more"></a><h3 id="查看及修改系统运行级别"><a href="#查看及修改系统运行级别" class="headerlink" title="查看及修改系统运行级别"></a>查看及修改系统运行级别</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 查看系统运行级别</span><br><span class="line">// N：NULL。当前级别为3即字符界面，其上一个级别为N即为空，表示系统开机直接进入字符界面</span><br><span class="line"><span class="section"># runlevel</span></span><br><span class="line">N 3             </span><br><span class="line"></span><br><span class="line">// 修改系统运行级别</span><br><span class="line">// 进入图形级别，前提是安装图形界面</span><br><span class="line"><span class="section"># init 5 // 若未安装图形界面则会报错</span></span><br><span class="line"><span class="section"># runlevel</span></span><br><span class="line">3 5     // 仍然进入了5级别</span><br></pre></td></tr></table></figure><h3 id="查看及修改系统默认的运行级别"><a href="#查看及修改系统默认的运行级别" class="headerlink" title="查看及修改系统默认的运行级别"></a>查看及修改系统默认的运行级别</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># vim /etc/inittab</span></span><br><span class="line">id:3:initdefault:</span><br></pre></td></tr></table></figure><p><strong>注：不要把开机启动级别设置为0或6级别。</strong></p><h3 id="服务启动和自启动"><a href="#服务启动和自启动" class="headerlink" title="服务启动和自启动"></a>服务启动和自启动</h3><p>启动：就是在当前系统中让服务启动，并提供功能。</p><p>自启动：指让服务在系统开机或重启动之后，随着系统的启动而自动启动服务。</p><p>注：在chkconfig –list 查看到服务在不同运行级别时，<strong>服务自启动</strong>是否开启，不能确定现在服务是否已经开启。</p><h3 id="查询已安装的服务"><a href="#查询已安装的服务" class="headerlink" title="查询已安装的服务"></a>查询已安装的服务</h3><h5 id="①、RPM包安装的服务"><a href="#①、RPM包安装的服务" class="headerlink" title="①、RPM包安装的服务"></a>①、RPM包安装的服务</h5><p>chkconfig –list命令查看服务自启动状态，可以看到所有RPM包安装的服务</p><h5 id="②、源码包安装的服务"><a href="#②、源码包安装的服务" class="headerlink" title="②、源码包安装的服务"></a>②、源码包安装的服务</h5><p>查看服务安装位置，一般是/usr/local/目录下<br><em>service、chkconfig、ntsysv</em>都不能找到源码包安装的服务。</p><p><strong>两者区别：</strong>主要是安装位置的不同</p><p>源码包：一般安装在/usr/local/目录下<br>RPM包：默认安装位置</p><h3 id="RMP包服务管理"><a href="#RMP包服务管理" class="headerlink" title="RMP包服务管理"></a>RMP包服务管理</h3><p>常规的rpm包文件安装位置：</p><table><thead><tr><th>路径</th><th>作用</th></tr></thead><tbody><tr><td>/etc/init.d/</td><td>启动脚本位置</td></tr><tr><td>/etc/sysconfig/</td><td>初始化环境配置文件位置</td></tr><tr><td>/etc/</td><td>配置文件位置</td></tr><tr><td>/etc/xinetd.conf</td><td>xinetd配置文件</td></tr><tr><td>/etc/xinetd.d</td><td>基于xinetd服务的启动脚本</td></tr><tr><td>/var/lib/</td><td>服务产生的数据放在这里</td></tr><tr><td>/var/log/</td><td>日志</td></tr></tbody></table><h3 id="RMP包服务管理——独立服务的管理"><a href="#RMP包服务管理——独立服务的管理" class="headerlink" title="RMP包服务管理——独立服务的管理"></a>RMP包服务管理——独立服务的管理</h3><h5 id="①、独立服务的启动"><a href="#①、独立服务的启动" class="headerlink" title="①、独立服务的启动"></a>①、独立服务的启动</h5><ul><li>法一：/etc/init.d/ 独立服务名 或者 /etc/rc.d/init.d/ 独立服务名 start|stop|status|restart|</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 查看apache http服务的状态，其中httpd为一个shell脚本文件</span><br><span class="line"><span class="section"># /etc/init.d/httpd status</span></span><br><span class="line">// 启动apache服务</span><br><span class="line"><span class="section"># /etc/init.d/httpd start</span></span><br><span class="line"></span><br><span class="line">// 早期Linux版本服务管理脚本放在/etc/rc.d/init.d/目录</span><br><span class="line"><span class="section"># /etc/rc.d/init.d/httpd status</span></span><br></pre></td></tr></table></figure><ul><li>法二：service 独立服务名 start|stop|restart|status|</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># service httpd status</span></span><br><span class="line">// centos 7</span><br><span class="line"><span class="section"># systemctl [start/stop/status/restart] 独立服务名</span></span><br></pre></td></tr></table></figure><p>备注：上面两种方法一般无法管理源码包启动脚本，但可以把源码包启动脚本放置在/etc/init.d/目录下统一管理</p><h5 id="②、独立服务的自启动"><a href="#②、独立服务的自启动" class="headerlink" title="②、独立服务的自启动"></a>②、独立服务的自启动</h5><ul><li>法一：chkconfig  [ - - level 运行级别 ] 服务名</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># chkconfig [--level 运行级别] [独立服务名] [on/off]</span></span><br><span class="line">例如：</span><br><span class="line"><span class="section"># chkconfig --level 2345 httpd on   </span></span><br><span class="line"><span class="section"># chkconfig httpd off   # --level 2345 可以省略，默认就是2345级别</span></span><br></pre></td></tr></table></figure><ul><li>法二：修改文件：/etc/rc.d/rc.local  或者 /etc/rc.local 文件</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># vi /etc/rc.local 或者 vi /etc/rc.d/rc.local</span></span><br><span class="line">// 然后在尾部添加一行，例如</span><br><span class="line"><span class="section"># /etc/init.d/httpd start   # 开机apache服务就会自启动</span></span><br></pre></td></tr></table></figure><ul><li>法三：ntsysv 命令管理自启动（可管理独立服务，和基于xinetd服务）</li></ul><p><strong>备注</strong></p><blockquote><p>①、/etc/rc.d/rc.local文件是在系统启动时，把所有的服务启动完，用户登录到系统前最后执行的文件，因此系统会执行这个文件中的命令</p><p>②、/etc/rc.local文件是/etc/rc.d/rc.local文件的软连接</p></blockquote><h3 id="RMP包服务管理——基于xinetd服务的管理"><a href="#RMP包服务管理——基于xinetd服务的管理" class="headerlink" title="RMP包服务管理——基于xinetd服务的管理"></a>RMP包服务管理——基于xinetd服务的管理</h3><p>安装xinetd服务</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># yum -y install xinetd</span></span><br></pre></td></tr></table></figure><p>基于xinetd服务的启动</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 显示rsync服务的端口</span><br><span class="line"><span class="section"># grep rsync /etc/services</span></span><br><span class="line"></span><br><span class="line"><span class="section"># vim /etc/xinetd.d/rsync</span></span><br><span class="line">service rsync</span><br><span class="line">&#123;</span><br><span class="line"><span class="code">    flags = REUSE // 设置TCP/IP socket可重用</span></span><br><span class="line"><span class="code">    socket_type = stream</span></span><br><span class="line"><span class="code">    wait = no     // 允许多个连接同时连接</span></span><br><span class="line"><span class="code">    user = root   // 启动服务的用户为root</span></span><br><span class="line"><span class="code">    server = /usr/bin/rsync</span></span><br><span class="line"><span class="code">    server_args = --daemon</span></span><br><span class="line"><span class="code">    log_on_failure += USERID // 登录失败后，记录用户的ID</span></span><br><span class="line"><span class="code">    disable = no // 开启rsync服务，开启：no 关闭：yes</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 重启动xinetd服务</span><br><span class="line"><span class="section"># service xinetd restart </span></span><br><span class="line">或者</span><br><span class="line"><span class="section"># systemctl restart  xinetd (centos 7)</span></span><br></pre></td></tr></table></figure><p>基于xinetd服务的自启动</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># checkconfig time-stream on</span></span><br><span class="line">// ntsysv命令</span><br><span class="line"><span class="section"># ntsysv</span></span><br></pre></td></tr></table></figure><p><strong>备注</strong></p><p>xinetd的服务：实际上自启动与启动完全同步，自启动关闭/开启，启动同时关闭/开启,启动关闭/开启，自启动同时关闭/开启</p><h3 id="源码包服务管理"><a href="#源码包服务管理" class="headerlink" title="源码包服务管理"></a>源码包服务管理</h3><h5 id="①、源码包安装服务的启动"><a href="#①、源码包安装服务的启动" class="headerlink" title="①、源码包安装服务的启动"></a>①、源码包安装服务的启动</h5><p>使用绝对路径，调用启动脚本来启动。不同的源码包的启动脚本不通，可以查看源码包的安装说明，查看启动脚本的方法</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /usr/local/apache2/bin/apachectl start|stop</span></span><br></pre></td></tr></table></figure><h5 id="②、源码包安装服务的自启动"><a href="#②、源码包安装服务的自启动" class="headerlink" title="②、源码包安装服务的自启动"></a>②、源码包安装服务的自启动</h5><p>通过修改/etc/rc.d/rc.local文件加入启动命令</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># vim /etc/rc.d/rc.local // 加入/usr/local/apache2/bin/apachectl start</span></span><br></pre></td></tr></table></figure><h5 id="③、让源码包服务被服务管理命令识别（chkconfig，ntsysv，service）"><a href="#③、让源码包服务被服务管理命令识别（chkconfig，ntsysv，service）" class="headerlink" title="③、让源码包服务被服务管理命令识别（chkconfig，ntsysv，service）"></a>③、让源码包服务被服务管理命令识别（chkconfig，ntsysv，service）</h5><ul><li>让源码包的apache服务能被service命令管理启动</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># ln -s /usr/local/apache2/bin/apachectl /etc/init.d/apache # 软链接</span></span><br><span class="line"><span class="section"># service apache start</span></span><br></pre></td></tr></table></figure><ul><li>让源码包的apache服务能被chkconfig与ntsysv命令管理自启动</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/init.d/apache </span><br><span class="line">// 在apache启动脚本中添加</span><br><span class="line"><span class="section"># chkconfig: 35 86 76 # 格式：chkconfig : 运行级别 启动顺序 关闭顺序</span></span><br><span class="line"><span class="section"># description: source package apache  # description的内容随意</span></span><br><span class="line">// 把源码包apache加入chkconfig 命令</span><br><span class="line"><span class="section"># chkconfig --add apache</span></span><br><span class="line"><span class="section"># chkconfig --list |grep apache</span></span><br><span class="line"><span class="section"># apache 0:关闭 1:关闭  2:关闭 3:开启 4:关闭 5:开启 6:关闭</span></span><br><span class="line"></span><br><span class="line">// 这时，ntsysv命令也可以管理apache</span><br><span class="line"><span class="section"># ntsysv</span></span><br></pre></td></tr></table></figure><h3 id="systemctl"><a href="#systemctl" class="headerlink" title="systemctl"></a>systemctl</h3><p>systemctl命令将service和chkconfig命令结合在了一起。这样通过一个命令就可以实现两个命令的功能。(<strong>CentOS 7 和 Ubuntu可用</strong>)</p><p>格式：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl   动作   服务名.service</span><br><span class="line">systemctl start|stop|restart|status 服务名.service</span><br></pre></td></tr></table></figure><p>设置开机启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable httpd.service</span><br></pre></td></tr></table></figure><p>取消开机启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable httpd.service</span><br></pre></td></tr></table></figure><p>系统操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl reboot 重启</span><br><span class="line">systemctl poweroff 关机</span><br><span class="line">systemctl suspend 睡眠</span><br><span class="line">systemctl hibernate 休眠</span><br></pre></td></tr></table></figure><p>分析启动进程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemd-analyze</span><br></pre></td></tr></table></figure><p>分析各进程启动的时间</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemd-analyze blame</span><br></pre></td></tr></table></figure><h3 id="服务管理总结"><a href="#服务管理总结" class="headerlink" title="服务管理总结"></a>服务管理总结</h3><p><img src="/images/linux-service-manage.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;运行级别&quot;&gt;&lt;a href=&quot;#运行级别&quot; class=&quot;headerlink&quot; title=&quot;运行级别&quot;&gt;&lt;/a&gt;运行级别&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;运行级别&lt;/th&gt;
&lt;th&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;关机&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;单用户模式，只要用于系统修复&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;不完全的命令行模式，不含NFS模式&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;完整的命令行模式，就是标准字符页面&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;系统保留&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;图形模式&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;重启&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="linux" scheme="http://www.gulj.cn/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Java设计模式—适配器模式</title>
    <link href="http://www.gulj.cn/2017/09/28/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    <id>http://www.gulj.cn/2017/09/28/Java设计模式—适配器模式/</id>
    <published>2017-09-28T03:31:50.000Z</published>
    <updated>2018-05-22T06:42:41.693Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>适配器模式将一个类的接口适配成用户所期待的。一个适配器通常允许因为接口不兼容而不能一起工作的类能够在一起工作，做法是将类自己的接口包裹在一个已存在的类中</p><h4 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h4><p><img src="http://p6nkwri76.bkt.clouddn.com/15268946528056.jpg" alt=""></p><ul><li>目标(Target)角色：这就是所期待得到的接口</li><li>源(Adapee)角色：现在需要适配的接口。</li><li>适配器(Adaper)角色：适配器类是本模式的核心。适配器把源接口转换成目标接口。显然，这一角色不可以是接口，而必须是具体类。</li></ul><a id="more"></a><h5 id="类适配器"><a href="#类适配器" class="headerlink" title="类适配器"></a>类适配器</h5><ul><li>采用继承的方式</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 适配器Adapter继承自Adaptee，同时又实现了目标(Target)接口。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">Adaptee</span> <span class="keyword">implements</span> <span class="title">Target</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.目标接口要求调用Request()这个方法名，但源类Adaptee没有方法Request()</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 2.但实际上Request()只是调用源类Adaptee的SpecificRequest()方法的内容</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 3.所以适配器只是将SpecificRequest()方法作了一层封装，封装成Target可以调用的Request()而已</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.SpecificRequest();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="对象适配器"><a href="#对象适配器" class="headerlink" title="对象适配器"></a>对象适配器</h5><ul><li>采用对象组合方式</li></ul><h6 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h6><p>假设在我们的系统中有一个已经存在的方法（Adaptee可以实现一个接口，也可以是一个对象类） <strong>Adaptee</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 需要被适配的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adaptee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 已经存在的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">specificRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO 具体业务方法</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于已经存在的接口不能满足我们的需求，现在我们定义一个我们期望的目标接口 <strong>Target</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 目标接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Target</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 目标方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">request</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>定义适配器 <strong>Adapter</strong> ，进行适配 Adaptee</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 适配器类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">implements</span> <span class="title">Target</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 持有需要被适配的接口对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Adaptee adaptee;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 传入需要被适配的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> adaptee</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Adapter</span><span class="params">(Adaptee adaptee)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.adaptee = adaptee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 新接口中，调用的是已经存在的方法</span></span><br><span class="line">        adaptee.specificRequest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建需要被适配的对象</span></span><br><span class="line">        Adaptee adaptee = <span class="keyword">new</span> Adaptee();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建客户端需要调用的接口对象</span></span><br><span class="line">        Target target = <span class="keyword">new</span> Adapter(adaptee);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 表面上调用的是自己的新定义的接口，其内部实现还是原有的方法</span></span><br><span class="line">        target.request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="缺省适配器"><a href="#缺省适配器" class="headerlink" title="缺省适配器"></a>缺省适配器</h5><p>　在任何时候，如果不准备实现一个接口的所有方法时，就可以使用“缺省适配模式”制造一个<strong>抽象类</strong>，给出所有方法的默认空实现。这样，从这个抽象类再继承下去的子类就不必实现所有的方法了</p><h6 id="代码示例-1"><a href="#代码示例-1" class="headerlink" title="代码示例"></a>代码示例</h6><p>定义一个动物 <strong>Animal</strong> 行为的接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  游泳</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swim</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  睡觉</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  飞翔</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们知道麻雀只能飞翔，睡觉，但是不能在水里游泳；如我我们直接定义一个麻雀（Bird）类直接去实现动物（Animal）这个接口，那么 Animal 中游泳的方法我们也必须去实现 (这是接口的特性所导致)，为了解决这个问题，我们定义一个抽象类作为适配器的角色来解决这个问题</p><p>适配器类 <strong>Adapter</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>  <span class="keyword">abstract</span>  <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span>  <span class="keyword">implements</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 空实现</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 空实现</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 空实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来我们定义麻雀类（Bird） 我们不直接实现接口（Animal），而是继承我们定义的适配器类 Adapter</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span> <span class="keyword">extends</span> <span class="title">Adapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO 业务实现</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO 业务实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="适配器模式使用注意事项"><a href="#适配器模式使用注意事项" class="headerlink" title="适配器模式使用注意事项"></a>适配器模式使用注意事项</h4><ul><li>适配器模式中被适配的接口 Adaptee 和适配成为的接口 Target 是没有关联的，Adaptee 和 Target 中的方法既可以是相同的，也可以是不同的</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;适配器模式将一个类的接口适配成用户所期待的。一个适配器通常允许因为接口不兼容而不能一起工作的类能够在一起工作，做法是将类自己的接口包裹在一个已存在的类中&lt;/p&gt;
&lt;h4 id=&quot;结构&quot;&gt;&lt;a href=&quot;#结构&quot; class=&quot;headerlink&quot; title=&quot;结构&quot;&gt;&lt;/a&gt;结构&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;http://p6nkwri76.bkt.clouddn.com/15268946528056.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;目标(Target)角色：这就是所期待得到的接口&lt;/li&gt;
&lt;li&gt;源(Adapee)角色：现在需要适配的接口。&lt;/li&gt;
&lt;li&gt;适配器(Adaper)角色：适配器类是本模式的核心。适配器把源接口转换成目标接口。显然，这一角色不可以是接口，而必须是具体类。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="设计模式" scheme="http://www.gulj.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Java设计模式—装饰器模式</title>
    <link href="http://www.gulj.cn/2017/09/27/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    <id>http://www.gulj.cn/2017/09/27/Java设计模式-装饰器模式/</id>
    <published>2017-09-27T01:42:22.000Z</published>
    <updated>2018-05-02T08:45:56.365Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1、介绍"><a href="#1、介绍" class="headerlink" title="1、介绍"></a>1、介绍</h3><p>装饰器模式（Decorator Pattern）允许向一个现有的对象添加新的功能，同时又不改变其结构。这种类型的设计模式属于结构型模式，它是作为现有的类的一个包装。</p><p>这种模式创建了一个装饰类，用来包装原有的类，并在保持类方法签名完整性的前提下，提供了额外的功能</p><p><strong>①、要点</strong>：</p><ul><li>不改变原类文件</li><li>不使用继承</li><li>动态扩展</li></ul><a id="more"></a><p><strong>②、使用场景：</strong></p><ul><li>扩展一个类的功能</li><li>动态增加功能，动态撤销</li></ul><p>在不想增加很多子类的情况下扩展类。</p><p><strong>③、优点：</strong></p><p>装饰类和被装饰类可以独立发展，不会相互耦合，<strong>装饰模式是继承的一个替代模式</strong>，装饰模式可以动态扩展一个实现类的功能。</p><h3 id="2、类图（经典）"><a href="#2、类图（经典）" class="headerlink" title="2、类图（经典）"></a>2、类图（经典）</h3><p><img src="/images/java_design_decorator.png" alt=""></p><p>在装饰模式中的角色有：</p><ul><li><strong>抽象构件(Component)角色：</strong>给出一个抽象接口，以规范准备接收附加责任的对象</li><li><strong>具体构件(ConcreteComponent)角色：</strong>定义一个将要接收附加责任的类</li><li><strong>装饰(Decorator)角色：</strong>持有一个构件(Component)对象的实例，并定义一个与抽象构件接口一致的接口</li><li><strong>具体装饰(ConcreteDecorator)角色：</strong>负责给构件对象“贴上”附加的责任。</li></ul><p>类图的结构可以变化的地方：</p><ul><li>Component接口可以是接口也可以是抽象类，甚至是一个普通的父类（这个强烈不推荐，普通的类作为继承体系的超级父类不易于维护）</li><li>装饰器的抽象父类Decorator并不是必须的。</li></ul><h3 id="3、代码示例"><a href="#3、代码示例" class="headerlink" title="3、代码示例"></a>3、代码示例</h3><p>抽象构件角色</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体的接口实现类，也就是俗称的原始对象，或者说待装饰对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponent</span> <span class="keyword">implements</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//TODO  相关的业务代码</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>抽象装饰器父类，它主要是为装饰器定义了我们需要装饰的目标是什么，并对Component进行了基础的装饰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">implements</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Component component;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Decorator</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.component = component;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        component.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体装饰角色</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteDecoratorA</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteDecoratorA</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.operation();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO 相关的修饰业务代码 A</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteDecoratorB</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteDecoratorA</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.operation();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO 相关的修饰业务代码 B</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDecoratorPattern</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//原来的对象</span></span><br><span class="line">        Component component = <span class="keyword">new</span> ConcreteComponent();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//装饰成A</span></span><br><span class="line">        Decorator concreteDecoratorA = <span class="keyword">new</span> ConcreteDecoratorA(component);</span><br><span class="line">        <span class="comment">//装饰成A以后再装饰成B</span></span><br><span class="line">        Decorator concreteDecoratorB = <span class="keyword">new</span> ConcreteDecoratorB(concreteDecoratorA);</span><br><span class="line">        concreteDecoratorB.operation();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//简写方式</span></span><br><span class="line">        Decorator decorator = <span class="keyword">new</span> ConcreteDecoratorA(<span class="keyword">new</span> ConcreteDecoratorB(component));</span><br><span class="line">        decorator.operation();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4、装饰模式的简化类图"><a href="#4、装饰模式的简化类图" class="headerlink" title="4、装饰模式的简化类图"></a>4、装饰模式的简化类图</h3><p>如果只有一个ConcreteComponent类，那么可以考虑去掉抽象的Component类（接口），把Decorator作为一个ConcreteComponent子类。如下图所示:</p><p><img src="/images/java_design_decorator_simple.png" alt=""></p><p>如果只有一个ConcreteDecorator类，那么就没有必要建立一个单独的Decorator类，而可以把Decorator和ConcreteDecorator的责任合并成一个类。甚至在只有两个ConcreteDecorator类的情况下，都可以这样做。如下图所示：</p><p><img src="/images/java_design_decorator_simple_2.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;1、介绍&quot;&gt;&lt;a href=&quot;#1、介绍&quot; class=&quot;headerlink&quot; title=&quot;1、介绍&quot;&gt;&lt;/a&gt;1、介绍&lt;/h3&gt;&lt;p&gt;装饰器模式（Decorator Pattern）允许向一个现有的对象添加新的功能，同时又不改变其结构。这种类型的设计模式属于结构型模式，它是作为现有的类的一个包装。&lt;/p&gt;
&lt;p&gt;这种模式创建了一个装饰类，用来包装原有的类，并在保持类方法签名完整性的前提下，提供了额外的功能&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;①、要点&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不改变原类文件&lt;/li&gt;
&lt;li&gt;不使用继承&lt;/li&gt;
&lt;li&gt;动态扩展&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="设计模式" scheme="http://www.gulj.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Java设计模式—策略模式</title>
    <link href="http://www.gulj.cn/2017/09/26/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
    <id>http://www.gulj.cn/2017/09/26/Java设计模式-策略模式/</id>
    <published>2017-09-26T05:45:07.000Z</published>
    <updated>2018-05-02T08:45:56.365Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1、介绍"><a href="#1、介绍" class="headerlink" title="1、介绍"></a>1、介绍</h3><p>　　<strong>策略模式属于对象的行为模式。其用意是针对一组算法，将每一个算法封装到具有共同接口的独立的类中，从而使得它们可以相互替换。策略模式使得算法可以在不影响到客户端的情况下发生变化。</strong></p><h3 id="2、-类图"><a href="#2、-类图" class="headerlink" title="2、 类图"></a>2、 类图</h3><p><img src="/images/java_design_stategy.png" alt=""></p><a id="more"></a><h3 id="3、角色划分"><a href="#3、角色划分" class="headerlink" title="3、角色划分"></a>3、角色划分</h3><p>● <strong>环境(Context)角色：</strong>持有一个Strategy的引用。</p><p>● <strong>抽象策略(Strategy)角色：</strong>这是一个抽象角色，通常由一个接口或抽象类实现。此角色给出所有的具体策略类所需的接口。</p><p>● <strong>具体策略(ConcreteStrategy)角色：</strong>包装了相关的算法或行为。</p><h3 id="4、代码示例"><a href="#4、代码示例" class="headerlink" title="4、代码示例"></a>4、代码示例</h3><p><strong>抽象策略类 </strong>Strategy.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 策略方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> os</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">strategy</span><span class="params">(String os)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>具体策略类</strong>(实现策略接口，提供具体算法)</p><p>ConcreteStrategyA.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyA</span> <span class="keyword">implements</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 策略方法实现 A</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> os</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">strategy</span><span class="params">(String os)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 具体的业务方法</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ConcreteStrategyB.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyB</span> <span class="keyword">implements</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 策略方法实现 B</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> os</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">strategy</span><span class="params">(String os)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 具体的业务方法</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Context.java <strong>持有具体策略类的实例，负责调用具体算法</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 策略的引用</span></span><br><span class="line">    <span class="keyword">private</span> Strategy strategy;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Context</span><span class="params">(Strategy strategy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 策略方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">(String os)</span> </span>&#123;</span><br><span class="line">        strategy.strategy(os);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>测试类</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestStrategyPattern</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Context context = <span class="keyword">new</span> Context(<span class="keyword">new</span> ConcreteStrategyA());</span><br><span class="line">        context.action(<span class="string">"A"</span>);</span><br><span class="line"></span><br><span class="line">        context = <span class="keyword">new</span> Context(<span class="keyword">new</span> ConcreteStrategyB());</span><br><span class="line">        context.action(<span class="string">"B"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5、策略模式优缺点"><a href="#5、策略模式优缺点" class="headerlink" title="5、策略模式优缺点"></a>5、策略模式优缺点</h3><p><strong>①、 优点</strong></p><ul><li>算法可以自由切换</li><li>避免使用多重条件判断</li><li>扩展性良好</li></ul><p><strong>②、缺点</strong></p><ul><li>客户端必须知道所有的策略类，并自行决定使用哪一个策略类</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;1、介绍&quot;&gt;&lt;a href=&quot;#1、介绍&quot; class=&quot;headerlink&quot; title=&quot;1、介绍&quot;&gt;&lt;/a&gt;1、介绍&lt;/h3&gt;&lt;p&gt;　　&lt;strong&gt;策略模式属于对象的行为模式。其用意是针对一组算法，将每一个算法封装到具有共同接口的独立的类中，从而使得它们可以相互替换。策略模式使得算法可以在不影响到客户端的情况下发生变化。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;2、-类图&quot;&gt;&lt;a href=&quot;#2、-类图&quot; class=&quot;headerlink&quot; title=&quot;2、 类图&quot;&gt;&lt;/a&gt;2、 类图&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;/images/java_design_stategy.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="设计模式" scheme="http://www.gulj.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Java设计模式—代理模式</title>
    <link href="http://www.gulj.cn/2017/09/20/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"/>
    <id>http://www.gulj.cn/2017/09/20/Java设计模式—代理模式/</id>
    <published>2017-09-20T07:54:23.000Z</published>
    <updated>2018-05-02T08:45:56.362Z</updated>
    
    <content type="html"><![CDATA[<h3 id="为什么使用代理"><a href="#为什么使用代理" class="headerlink" title="为什么使用代理"></a>为什么使用代理</h3><p>我们在写一个功能函数时，经常需要在其中写入与功能不是直接相关但很有必要的代 码，如日志记录，信息发送，安全和事务支持等，这些枝节性代码虽然是必要的，但它会带来以下麻烦：</p><ol><li>枝节性代码游离在功能性代码之外，它不是函数的目的，这是对OO是一种破坏</li><li>枝节性代码会造成功能性代码对其它类的依赖，加深类之间的耦合，可重用性降低</li><li>从法理上说，枝节性代码应该<code>监视着功能性代码，然后采取行动，而不是功能性代码</code>通知枝节性代码采取行动，这好比吟游诗人应该是主动记录骑士的功绩而不是骑士主动要求诗人记录自己的功绩</li></ol><a id="more"></a><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>代理(Proxy)是一种设计模式,提供了对目标对象另外的访问方式;即通过代理对象访问目标对象.这样做的好处是:可以在目标对象实现的基础上,增强额外的功能操作,即扩展目标对象的功能.</p><p>代理模式的关键点是:代理对象与目标对象.代理对象是对目标对象的扩展,并会调用目标对象</p><h3 id="1、静态代理"><a href="#1、静态代理" class="headerlink" title="1、静态代理"></a>1、静态代理</h3><p>静态代理在使用时,需要定义接口或者父类,被代理对象与代理对象一起实现相同的接口或者是继承相同父类.</p><p>下面举个案例来解释:<br>模拟保存动作,定义一个保存动作的接口:IUserDao.java,然后目标对象实现这个接口的方法UserDao.java,此时如果使用静态代理方式,就需要在代理对象(UserDaoProxy.java)中也实现IUserDao接口.调用的时候通过调用代理对象的方法来调用目标对象.<br>需要注意的是,代理对象与目标对象要实现相同的接口,然后通过调用相同的方法来调用目标对象的方法</p><p><strong>代码示例</strong></p><p>接口:IUserDao.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>目标对象类:UserDao.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> <span class="keyword">implements</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"----已经保存数据!----"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代理对象:UserDaoProxy.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoProxy</span> <span class="keyword">implements</span> <span class="title">IUserDao</span></span>&#123;</span><br><span class="line">    <span class="comment">//接收保存目标对象</span></span><br><span class="line">    <span class="keyword">private</span> IUserDao target;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserDaoProxy</span><span class="params">(IUserDao target)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.target=target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始事务..."</span>);</span><br><span class="line">        target.save();<span class="comment">//执行目标对象的方法</span></span><br><span class="line">        System.out.println(<span class="string">"提交事务..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试类:App.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//目标对象</span></span><br><span class="line">        UserDao target = <span class="keyword">new</span> UserDao();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//代理对象,把目标对象传给代理对象,建立代理关系</span></span><br><span class="line">        UserDaoProxy proxy = <span class="keyword">new</span> UserDaoProxy(target);</span><br><span class="line"></span><br><span class="line">        proxy.save();<span class="comment">//执行的是代理的方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>静态代理总结</strong></p><ol><li>可以做到在不修改目标对象的功能前提下,对目标功能扩展.</li><li>缺点:<br>  代理类和委托类实现相同的接口，同时要实现相同的方法。这样就出现了大量的代码重复。如果接口增加一个方法，除了所有实现类需要实现这个方法外，所有代理类也需要实现此方法。增加了代码维护的复杂度。</li></ol><h3 id="2、动态代理"><a href="#2、动态代理" class="headerlink" title="2、动态代理"></a>2、动态代理</h3><p><strong>动态代理有以下特点:</strong><br>​    ①、代理对象,不需要实现接口<br>​    ②、代理对象的生成,是利用JDK的API,动态的在内存中构建代理对象(需要我们指定创建代理对象/目标对象实现的接口的类型)<br>​    ③、动态代理也叫做:JDK代理,接口代理</p><p><strong>JDK中生成代理对象的API：</strong><br>　代理类所在包:java.lang.reflect.Proxy<br>　JDK实现代理只需要使用newProxyInstance方法,但是该方法需要接收三个参数,完整的写法是:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> Object <span class="title">newProxyInstance</span><span class="params">(ClassLoader loader, Class [] interfaces, InvocationHandler handler)</span></span></span><br></pre></td></tr></table></figure><p>注意该方法是在Proxy类中是静态方法,且接收的三个参数依次为:</p><ul><li>ClassLoader loader:指定当前目标对象使用类加载器,用null表示默认类加载器</li><li>Class [] interfaces:需要实现的接口数组</li><li>InvocationHandler handler:调用处理器,执行目标对象的方法时,会触发调用处理器的方法,从而把当前执行目标对象的方法作为参数传入</li></ul><p><strong>代码示例:</strong><br>　　接口类IUserDao.java以及接口实现类UserDao是一样的.在这个基础上,增加一个代理工厂类(ProxyFactory.java),将代理类写在这个地方,然后在测试类中先建立目标对象和代理对象的联系,然后使用代理对象中的同名方法</p><p><strong>1）、JDK动态代理</strong></p><p>代理工厂类:ProxyFactory.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">//维护目标对象</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProxyFactory</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//给目标对象生成代理对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getProxyInstance1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), (Object proxy, Method method, Object[] args) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">"开始事务2"</span>);</span><br><span class="line">            <span class="comment">//执行目标对象方法</span></span><br><span class="line">            Object returnValue = method.invoke(target, args);</span><br><span class="line">            System.out.println(<span class="string">"提交事务2"</span>);</span><br><span class="line">            <span class="keyword">return</span> returnValue;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试类:App.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 目标对象</span></span><br><span class="line">    IUserDao target = <span class="keyword">new</span> UserDao();</span><br><span class="line">    <span class="comment">// 【原始的类型】</span></span><br><span class="line">    System.out.println(target.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给目标对象，创建代理对象</span></span><br><span class="line">    IUserDao proxy = (IUserDao) <span class="keyword">new</span> ProxyFactory(target).getProxyInstance();</span><br><span class="line">    <span class="comment">// com.sun.proxy.$Proxy0   内存中动态生成的代理对象</span></span><br><span class="line">    System.out.println(proxy.getClass());</span><br><span class="line">    <span class="comment">// 执行方法   【代理对象】</span></span><br><span class="line">    proxy.save();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JDK动态代理总结:</strong></p><p>　　代理对象不需要实现接口,但是目标对象一定要实现接口,否则不能用动态代理</p><h2 id="Cglib代理"><a href="#Cglib代理" class="headerlink" title="Cglib代理"></a>Cglib代理</h2><p>　　上面的静态代理和动态代理模式都是要求目标对象实现一个接口或者多个接口,但是有时候目标对象只是一个单独的对象,并没有实现任何的接口,这个时候就可以使用<strong>构建目标对象子类的方式</strong>实现代理,这种方法就叫做:Cglib代理<br>　　Cglib代理,也叫作子类代理,它是在内存中构建一个子类对象从而实现对目标对象功能的扩展.</p><ul><li>Cglib是一个强大的高性能的代码生成包,它可以在运行期扩展java类与实现java接口.它广泛的被许多AOP的框架使用,例如Spring AOP和synaop,为他们提供方法的interception(拦截)</li><li>Cglib包的底层是通过使用<strong>字节码处理框架ASM</strong>来转换字节码并生成新的子类.</li><li>代理的类不能为final,否则报错；目标对象的方法如果为final/static,那么就不会被拦截,即不会执行目标对象额外的业务方法</li></ul><p><strong>代码示例:</strong><br>目标对象类:UserDao.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 目标对象,没有实现任何接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"----已经保存数据!----"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Cglib代理工厂:ProxyFactory.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  Cglib子类代理工厂</span></span><br><span class="line"><span class="comment"> *  对UserDao在内存中动态构建一个子类对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyFactory</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span></span>&#123;</span><br><span class="line">     <span class="comment">//维护目标对象</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProxyFactory</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//给目标对象创建一个代理对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getProxyInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//1.工具类</span></span><br><span class="line">        Enhancer en = <span class="keyword">new</span> Enhancer();</span><br><span class="line">       <span class="comment">//2.设置父类</span></span><br><span class="line">        en.setSuperclass(target.getClass());</span><br><span class="line">        <span class="comment">//3.设置回调函数</span></span><br><span class="line">        en.setCallback(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//4.创建子类(代理对象)</span></span><br><span class="line">        <span class="keyword">return</span> en.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始事务..."</span>);</span><br><span class="line">        <span class="comment">//执行目标对象的方法</span></span><br><span class="line">        Object returnValue = method.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">"提交事务..."</span>);</span><br><span class="line">        <span class="keyword">return</span> returnValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试类:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//目标对象</span></span><br><span class="line">        UserDao target = <span class="keyword">new</span> UserDao();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//代理对象</span></span><br><span class="line">        UserDao proxy = (UserDao)<span class="keyword">new</span> ProxyFactory(target).getProxyInstance();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行代理对象的方法</span></span><br><span class="line">        proxy.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在Spring的AOP编程中:<br>如果加入容器的目标对象有实现接口,用JDK代理<br>如果目标对象没有实现接口,用Cglib代理</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;为什么使用代理&quot;&gt;&lt;a href=&quot;#为什么使用代理&quot; class=&quot;headerlink&quot; title=&quot;为什么使用代理&quot;&gt;&lt;/a&gt;为什么使用代理&lt;/h3&gt;&lt;p&gt;我们在写一个功能函数时，经常需要在其中写入与功能不是直接相关但很有必要的代 码，如日志记录，信息发送，安全和事务支持等，这些枝节性代码虽然是必要的，但它会带来以下麻烦：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;枝节性代码游离在功能性代码之外，它不是函数的目的，这是对OO是一种破坏&lt;/li&gt;
&lt;li&gt;枝节性代码会造成功能性代码对其它类的依赖，加深类之间的耦合，可重用性降低&lt;/li&gt;
&lt;li&gt;从法理上说，枝节性代码应该&lt;code&gt;监视着功能性代码，然后采取行动，而不是功能性代码&lt;/code&gt;通知枝节性代码采取行动，这好比吟游诗人应该是主动记录骑士的功绩而不是骑士主动要求诗人记录自己的功绩&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="设计模式" scheme="http://www.gulj.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Java设计模式—模板方法模式</title>
    <link href="http://www.gulj.cn/2017/09/19/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/"/>
    <id>http://www.gulj.cn/2017/09/19/JAVA设计模式—模板方法模式/</id>
    <published>2017-09-19T05:27:12.000Z</published>
    <updated>2018-05-02T08:45:56.361Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1、介绍"><a href="#1、介绍" class="headerlink" title="1、介绍"></a>1、介绍</h3><p>模板方法模式是类的行为模式。准备一个抽象类，将部分逻辑以具体方法以及具体构造函数的形式实现，然后声明一些抽象方法来迫使子类实现剩余的逻辑。不同的子类可以以不同的方式实现这些抽象方法，从而对剩余的逻辑有不同的实现。<br><a id="more"></a></p><h3 id="2、结构"><a href="#2、结构" class="headerlink" title="2、结构"></a>2、结构</h3><p>①、模板方法模式结构可以分为两个角色：<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;抽象模板(Abstract Template)角色<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;具体模板(Concrete Template)角色<br>②、模板方法模式的静态结构图如下所示：</p><p><img src="/images/java_design_model_muban01.jpeg" alt=""><br>这里涉及到两个角色：<br><strong>抽象模板(Abstract Template)角色职责：</strong></p><ul><li>定义了一个或多个抽象操作，以便让子类实现。这些抽象操作叫做基本操作，它们是一个顶级逻辑的组成步骤。</li><li>定义并实现了一个模板方法。这个模板方法一般是一个具体方法，它给出了一个顶级逻辑的骨架，而逻辑的组成步骤在相应的抽象操作中，推迟到子类实现。顶级逻辑也有可能调用一些具体方法。</li></ul><p><strong>具体模板(Concrete Template)角色职责：</strong></p><ul><li>实现父类所定义的一个或多个抽象方法，它们是一个顶级逻辑的组成步骤。</li><li>每一个抽象模板角色都可以有任意多个具体模板角色与之对应，而每一个具体模板角色都可以给出这些抽象方法（也就是顶级逻辑的组成步骤）的不同实现，从而使得顶级逻辑的实现各不相同。</li></ul><h3 id="3、代码示例"><a href="#3、代码示例" class="headerlink" title="3、代码示例"></a>3、代码示例</h3><p>抽象模板角色类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象模板类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gulj</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2017-09-08 下午2:48</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractTemplate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板方法（定义模板的算法，整体骨架，业务方法由具体子类实现）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">templateMethod</span><span class="params">(String params)</span> </span>&#123;<span class="comment">//核心的模板方法，不允许子类覆盖</span></span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();<span class="comment">//模板方法，统一的模板</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 具体的业务方法，可以有以下三种方式</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"---------------------------"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ①、需要所有子类实现各自的业务逻辑</span></span><br><span class="line">        String result = abstractMethod(params);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ②、本类已经实现的方法</span></span><br><span class="line">        concreteMethod();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ③、需要的子类可以重写</span></span><br><span class="line">        hookMethod();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"---------------------------"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis();<span class="comment">//模板方法，统一的模板</span></span><br><span class="line">        System.out.println(<span class="string">"耗时时间："</span> + (endTime - startTime));</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 抽象方法，供子类具体实现，定义为protected，可以只保证子类来实现，外界不允许调用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title">abstractMethod</span><span class="params">(String... params)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 基本方法（已经实现）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">final</span> String <span class="title">concreteMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"concreteMethod : 模板类实现已经实现的放方法"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 基本方法(空方法)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">hookMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *  我们可以定义一个空方法，这样可以保证不是所有子类都需要重写该方法</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="string">"hookMethod : 模板类的空方法，可供某些子类进行重写"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体模板角色类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体模板角色类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gulj</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2017-09-08 下午3:25</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteTemplate</span> <span class="keyword">extends</span> <span class="title">AbstractTemplate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写父类的抽象方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">abstractMethod</span><span class="params">(String... params)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"abstractMethod : 子类实现模板类中的抽象方法"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gulj</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2017-09-08 下午3:29</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTemplateDesignMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//子类实例</span></span><br><span class="line">        ConcreteTemplate concreteTemplate = <span class="keyword">new</span> ConcreteTemplate();</span><br><span class="line">        <span class="comment">//调用弗父类的模板方法</span></span><br><span class="line">        concreteTemplate.templateMethod(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 测试结果</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         ---------------------------</span></span><br><span class="line"><span class="comment">         abstractMethod : 子类实现模板类中的抽象方法</span></span><br><span class="line"><span class="comment">         concreteMethod : 模板类实现已经实现的放方法</span></span><br><span class="line"><span class="comment">         hookMethod : 模板类的空方法，可供某些子类进行重写</span></span><br><span class="line"><span class="comment">         ---------------------------</span></span><br><span class="line"><span class="comment">         耗时时间：1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4、说明"><a href="#4、说明" class="headerlink" title="4、说明"></a>4、说明</h3><p>模板方法中的方法可以分为两大类：模板方法和基本方法。</p><p>①、<strong>模板方法</strong></p><p>一个模板方法是定义在抽象类中的，把基本操作方法组合在一起形成一个总算法或一个总行为的方法。</p><p>一个抽象类可以有任意多个模板方法，而不限于一个。每一个模板方法都可以调用任意多个具体方法。</p><p>②、<strong>基本方法</strong></p><p>基本方法又可以分为三种：抽象方法(Abstract Method)、具体方法(Concrete Method)和钩子方法(Hook Method)。</p><p><strong>抽象方法：</strong>一个抽象方法由抽象类声明，由具体子类实现。在Java语言里抽象方法以abstract关键字标示。</p><p><strong>具体方法：</strong>一个具体方法由抽象类声明并实现，而子类并不实现或置换，如代码示例中的：concreteMethod()方法。</p><p><strong>钩子方法：</strong>一个钩子方法由抽象类声明并实现，而子类会加以扩展。通常抽象类给出的实现是一个空实现，作为方法的默认实现，如代码示例中的：hookMethod()方法。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;1、介绍&quot;&gt;&lt;a href=&quot;#1、介绍&quot; class=&quot;headerlink&quot; title=&quot;1、介绍&quot;&gt;&lt;/a&gt;1、介绍&lt;/h3&gt;&lt;p&gt;模板方法模式是类的行为模式。准备一个抽象类，将部分逻辑以具体方法以及具体构造函数的形式实现，然后声明一些抽象方法来迫使子类实现剩余的逻辑。不同的子类可以以不同的方式实现这些抽象方法，从而对剩余的逻辑有不同的实现。&lt;br&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="设计模式" scheme="http://www.gulj.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>java设计模式-单例模式</title>
    <link href="http://www.gulj.cn/2017/09/18/java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <id>http://www.gulj.cn/2017/09/18/java设计模式-单例模式/</id>
    <published>2017-09-18T09:43:24.000Z</published>
    <updated>2018-05-08T09:45:08.160Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="设计模式" scheme="http://www.gulj.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
</feed>
