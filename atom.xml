<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>顾大仙MQ | 博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.gulj.cn/"/>
  <updated>2019-02-14T07:22:07.272Z</updated>
  <id>http://www.gulj.cn/</id>
  
  <author>
    <name>顾立剑</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>awk命令</title>
    <link href="http://www.gulj.cn/2019/02/15/awk%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.gulj.cn/2019/02/15/awk命令/</id>
    <published>2019-02-15T07:13:37.000Z</published>
    <updated>2019-02-14T07:22:07.272Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="linux" scheme="http://www.gulj.cn/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>find和grep命令</title>
    <link href="http://www.gulj.cn/2019/02/14/find%E5%92%8Cgrep%E5%91%BD%E4%BB%A4-1/"/>
    <id>http://www.gulj.cn/2019/02/14/find和grep命令-1/</id>
    <published>2019-02-14T07:17:44.000Z</published>
    <updated>2019-02-14T07:50:41.971Z</updated>
    
    <content type="html"><![CDATA[<h4 id="find"><a href="#find" class="headerlink" title="find"></a>find</h4><h5 id="语法格式"><a href="#语法格式" class="headerlink" title="语法格式"></a>语法格式</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find 【路径】【选项】【操作】</span><br></pre></td></tr></table></figure><h5 id="选项参数"><a href="#选项参数" class="headerlink" title="选项参数"></a>选项参数</h5><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>-name</td><td>根据文件名查找</td></tr><tr><td>-iname</td><td>根据文件名查找不区分大小写</td></tr><tr><td>-perm</td><td>根据文件权限查找</td></tr><tr><td>-prune</td><td>该选项可以排除某些目录</td></tr><tr><td>-user</td><td>根据文件属主查找</td></tr><tr><td>-group</td><td>根据文件属组查找</td></tr><tr><td>-mtime  -n \</td><td>+n</td><td>根据文件更改时间查找，以天为单位</td></tr><tr><td>-mmin   -n \</td><td>+n</td><td>根据文件更改时间查找，以分钟为单位</td></tr><tr><td>-nogroup</td><td>查找无有效属组的文件</td></tr><tr><td>-nouser</td><td>查找无有效属主的文件</td></tr><tr><td>-type</td><td>按文件类型查找</td></tr><tr><td>-size -n \</td><td>+n</td><td>按文件大小查找</td></tr><tr><td>-mindepth n</td><td>从n级子目录开始查找</td></tr><tr><td>-maxdepth n</td><td>最多搜多到n级子目录</td></tr></tbody></table><h5 id="示例说明"><a href="#示例说明" class="headerlink" title="示例说明"></a>示例说明</h5><ul><li><p>-name</p><p>查找/etc目录下已conf结尾的文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc  -name "*.conf"</span><br></pre></td></tr></table></figure></li><li><p>-user</p><p>查找当前目录下属主食hadoop的文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -user hadoop</span><br></pre></td></tr></table></figure></li><li><p>-type</p><ul><li>f     (文件)</li><li>d    (目录)</li><li>c     (字符设备文件)</li><li>l     (链接文件)</li><li>p    (管道文件)</li></ul><p>查找当前路径下的文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -type f</span><br></pre></td></tr></table></figure></li><li><p>-size</p><ul><li>-n   (大小小于n的文件)</li><li>+n   (大小大于n的文件)</li></ul><p>查找/etc目录下小于1000的字节文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -size -1000c</span><br></pre></td></tr></table></figure><p>查找/etc目录下大于1兆的文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -size +1M</span><br></pre></td></tr></table></figure></li><li><p>-mtime</p><ul><li>-n   (n天以内修改的文件)</li><li>+n   (n天以外修改的文件)</li></ul><p>查找/etc目录下3天以内修改的文件且以conf结尾的文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -mtime -3 -name "*.conf"</span><br></pre></td></tr></table></figure><p>查找/etc目录下30分钟之前修改的目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -mmin +30 -type d</span><br></pre></td></tr></table></figure></li><li><p>mindepth</p><p>从/etc目录下3级子目录开始搜索文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -mindepth 3 -type f</span><br></pre></td></tr></table></figure></li><li><p>maxdepth</p><p>从/etc目录下查找文件权限为644，最多搜索到2级目录（当前位置表示一级目录）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -maxdepth 2 -perm 644</span><br></pre></td></tr></table></figure></li><li><p>-prune</p><blockquote><p>通常和path一起使用，用于将特定的目录排除在搜索之外</p></blockquote><p>查找当前目录下所有文件，但排除log目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -path ./log -prune -o -type f</span><br></pre></td></tr></table></figure><p>查找当前目录下所有文件，但排除log目录和lib目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -path ./log -prune -o -path ./lib -prune -o -type f</span><br></pre></td></tr></table></figure></li><li><p>-exec </p><blockquote><p>对搜索到文件执行特定的操作，格式为：-exec  ‘command’  {}  \;     {} 表示find查询到的结果集</p></blockquote><p>搜索/etc下的文件，文件名以conf结尾，且大小大于2K，然后将其复制到/root/hadoop目录下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -name "*.conf" -size +2K -type f -exec cp -r &#123;&#125; /root/hadoop \;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;find&quot;&gt;&lt;a href=&quot;#find&quot; class=&quot;headerlink&quot; title=&quot;find&quot;&gt;&lt;/a&gt;find&lt;/h4&gt;&lt;h5 id=&quot;语法格式&quot;&gt;&lt;a href=&quot;#语法格式&quot; class=&quot;headerlink&quot; title=&quot;语法格式&quot;&gt;&lt;/a
      
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="linux" scheme="http://www.gulj.cn/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Btrace监控调试基本教程</title>
    <link href="http://www.gulj.cn/2018/07/30/Btrace%E7%9B%91%E6%8E%A7%E8%B0%83%E8%AF%95%E5%9F%BA%E6%9C%AC%E6%95%99%E7%A8%8B/"/>
    <id>http://www.gulj.cn/2018/07/30/Btrace监控调试基本教程/</id>
    <published>2018-07-30T07:53:46.000Z</published>
    <updated>2019-02-14T07:07:12.859Z</updated>
    
    <content type="html"><![CDATA[<h4 id="拦截方法"><a href="#拦截方法" class="headerlink" title="拦截方法"></a>拦截方法</h4><ul><li><h5 id="普通方法"><a href="#普通方法" class="headerlink" title="普通方法"></a>普通方法</h5></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnMethod</span>( clazz = <span class="string">""</span>, method = <span class="string">""</span>)</span><br></pre></td></tr></table></figure><p>上一篇文章我们已经介绍，不清楚的小伙伴，可自行前往查看 </p><ul><li><h5 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h5></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnMethod</span>( clazz = <span class="string">""</span>, method = <span class="string">"&lt;init&gt;"</span>)</span><br></pre></td></tr></table></figure><a id="more"></a><p><strong>代码示例</strong></p><p>新建User类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写待追踪代码 ConstructorController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstructorController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/constructor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">constructor</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写追踪代码脚本 BtracePrintConstructorArgSimple.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BTrace</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BtracePrintConstructorArgSimple</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMethod</span>(clazz = <span class="string">"com.gulj.monitor.domain.User"</span>, method = <span class="string">"&lt;init&gt;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">andyRead</span><span class="params">(@ProbeClassName String pcn, @ProbeMethodName String pmn, AnyType[] args)</span> </span>&#123;</span><br><span class="line">        BTraceUtils.printArray(args);</span><br><span class="line">        BTraceUtils.println(<span class="string">"className="</span> + pcn + <span class="string">","</span> + <span class="string">"methodName="</span> + pmn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行追踪代码脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">btrace pid BtracePrintConstructorArgSimple.java</span><br></pre></td></tr></table></figure><p>发送请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:8080/constructor?name=gulj&amp;age=27</span><br></pre></td></tr></table></figure><blockquote><p>执行命令 btrace pid BtracePrintConstructorArgSimple.java (一起处于监听状态，当我们发送请求，会有监听结果输出) 还有笔者在测试的过程中有的时候没有监测到输出，当遇到这种情况，有的时候是因为慢的缘故，有的时候还请小伙伴多执行几次请求</p></blockquote><ul><li><h5 id="同名函数，用参数区分"><a href="#同名函数，用参数区分" class="headerlink" title="同名函数，用参数区分"></a>同名函数，用参数区分</h5></li></ul><p><strong>代码示例</strong></p><p>编写待追踪代码 SameMethodController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SameMethodController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/method1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">method</span><span class="params">(@RequestParam(<span class="string">"name"</span>)</span> String name) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/method2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">method</span><span class="params">(@RequestParam(<span class="string">"name"</span>)</span> String name, @<span class="title">RequestParam</span><span class="params">(<span class="string">"age"</span>)</span> <span class="keyword">int</span> age) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name + age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写追踪代码脚本 BtracePrintConstructorArgSimple.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BTrace</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BtracePrintSameMethodArgSimple</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注意，这个两个方法，除了最后的参数个数不同，其它都一样，读者在测试的时候可自行选择放开测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// curl:http://localhost:8080/method2?name=xxx&amp;age=100</span></span><br><span class="line">    <span class="meta">@OnMethod</span>(clazz = <span class="string">"com.gulj.monitor.controller.SameMethodController"</span>, method = <span class="string">"method"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">(@ProbeClassName String pcn, @ProbeMethodName String pmn,String name,<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        BTraceUtils.println(<span class="string">"className="</span> + pcn + <span class="string">","</span> + <span class="string">"methodName="</span> + pmn + <span class="string">","</span> + <span class="string">"name="</span> + name +<span class="string">","</span> + <span class="string">"age="</span> + age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    </span><br><span class="line">   <span class="comment">/* </span></span><br><span class="line"><span class="comment">    //访问：curl:http://localhost:8080/method1?name=xxx</span></span><br><span class="line"><span class="comment">    @OnMethod(clazz = "com.gulj.monitor.controller.SameMethodController", method = "method")</span></span><br><span class="line"><span class="comment">    public static void method(@ProbeClassName String pcn, @ProbeMethodName String pmn,String name) &#123;</span></span><br><span class="line"><span class="comment">        BTraceUtils.println("className=" + pcn + "," + "methodName=" + pmn + "," + "name=" + name );</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发送请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl:http://localhost:8080/method1?name=gulj&amp;age=12</span><br></pre></td></tr></table></figure><p>监控结果</p><p><img src="http://p6nkwri76.bkt.clouddn.com/15329362107844.jpg" alt=""></p><blockquote><p>通过笔者以上的介绍，小伙伴们想必已经知道btrace怎么玩了，下面为了避免篇幅过长，笔者只给出示例代码中的待追踪代码和追踪代码，小伙伴们自行运行查看效果。</p></blockquote><h4 id="拦截返回值、异常、行号"><a href="#拦截返回值、异常、行号" class="headerlink" title="拦截返回值、异常、行号"></a>拦截返回值、异常、行号</h4><h5 id="拦截返回值"><a href="#拦截返回值" class="headerlink" title="拦截返回值"></a>拦截返回值</h5><pre><code>拦截线上代码方法的返回值</code></pre><p>编写待追踪代码 ReturnValueController.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReturnValueController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/returnValue"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">returnValue</span><span class="params">(@RequestParam(<span class="string">"name"</span>)</span> String name) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>编写追踪代码脚本 BtracePrintConstructorArgSimple.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BTrace</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BtracePrintReturnValueSimple</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMethod</span>(</span><br><span class="line">            clazz = <span class="string">"com.gulj.monitor.controller.ReturnValueController"</span>,</span><br><span class="line">            method = <span class="string">"returnValue"</span>,</span><br><span class="line">            location = <span class="meta">@Location</span>(Kind.RETURN)</span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">anyRead</span><span class="params">(@ProbeClassName String pcn, @ProbeMethodName String pmn, @Return AnyType result)</span> </span>&#123;</span><br><span class="line">        BTraceUtils.println(<span class="string">"className="</span> + pcn + <span class="string">","</span> + <span class="string">"methodName="</span> + pmn + <span class="string">","</span> + <span class="string">"result="</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>使用 @Location(Kind.RETURN) 指定监控返回值的地方，使用 @Return AnyType result 存放监控的返回值</p></blockquote><h5 id="拦截异常"><a href="#拦截异常" class="headerlink" title="拦截异常"></a>拦截异常</h5><pre><code>拦截线上代码指定方法即使吞并异常，仍能异常栈信息被监控输出</code></pre><p>编写待追踪代码 OnThrowController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OnThrowController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/exception"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">exception</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//TODO 业务代码</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//TODO 业务代码</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写追踪代码脚本 BtracePrintOnThrowSimple.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BTrace</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BtracePrintOnThrowSimple</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 代码从 usersguide.html 中 copy btrace/samples/OnThrow.java</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// store current exception in a thread local</span></span><br><span class="line">    <span class="comment">// variable (@TLS annotation). Note that we can't</span></span><br><span class="line">    <span class="comment">// store it in a global variable!</span></span><br><span class="line">    <span class="meta">@TLS</span></span><br><span class="line">    <span class="keyword">static</span> Throwable currentException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// introduce probe into every constructor of java.lang.Throwable</span></span><br><span class="line">    <span class="comment">// class and store "this" in the thread local variable.</span></span><br><span class="line">    <span class="meta">@OnMethod</span>(</span><br><span class="line">            clazz = <span class="string">"java.lang.Throwable"</span>,</span><br><span class="line">            method = <span class="string">"&lt;init&gt;"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onthrow</span><span class="params">(@Self Throwable self)</span> </span>&#123;</span><br><span class="line">        currentException = self;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMethod</span>(</span><br><span class="line">            clazz = <span class="string">"java.lang.Throwable"</span>,</span><br><span class="line">            method = <span class="string">"&lt;init&gt;"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onthrow1</span><span class="params">(@Self Throwable self, String s)</span> </span>&#123;</span><br><span class="line">        currentException = self;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMethod</span>(</span><br><span class="line">            clazz = <span class="string">"java.lang.Throwable"</span>,</span><br><span class="line">            method = <span class="string">"&lt;init&gt;"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onthrow1</span><span class="params">(@Self Throwable self, String s, Throwable cause)</span> </span>&#123;</span><br><span class="line">        currentException = self;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMethod</span>(</span><br><span class="line">            clazz = <span class="string">"java.lang.Throwable"</span>,</span><br><span class="line">            method = <span class="string">"&lt;init&gt;"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onthrow2</span><span class="params">(@Self Throwable self, Throwable cause)</span> </span>&#123;</span><br><span class="line">        currentException = self;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// when any constructor of java.lang.Throwable returns</span></span><br><span class="line">    <span class="comment">// print the currentException's stack trace.</span></span><br><span class="line">    <span class="meta">@OnMethod</span>(</span><br><span class="line">            clazz = <span class="string">"java.lang.Throwable"</span>,</span><br><span class="line">            method = <span class="string">"&lt;init&gt;"</span>,</span><br><span class="line">            location = <span class="meta">@Location</span>(Kind.RETURN)</span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onthrowreturn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (currentException != <span class="keyword">null</span>) &#123;</span><br><span class="line">            BTraceUtils.Threads.jstack(currentException);</span><br><span class="line">            println(<span class="string">"====================="</span>);</span><br><span class="line">            currentException = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>监控结果<br><img src="http://p6nkwri76.bkt.clouddn.com/15330259155713.jpg" alt=""></p><blockquote><p>虽然我们在程序中把异常吞闭了，但是通过btrace的异常监控脚本我们仍能输出异常栈信息，这无疑很好地帮助我们解决线上问题（btrace的异常监控脚本参考 usersguide.html 中的 btrace/samples/OnThrow.java文件）</p></blockquote><h5 id="拦截行号"><a href="#拦截行号" class="headerlink" title="拦截行号"></a>拦截行号</h5><pre><code>拦截线上代码指定行是否被执行到</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;拦截方法&quot;&gt;&lt;a href=&quot;#拦截方法&quot; class=&quot;headerlink&quot; title=&quot;拦截方法&quot;&gt;&lt;/a&gt;拦截方法&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;h5 id=&quot;普通方法&quot;&gt;&lt;a href=&quot;#普通方法&quot; class=&quot;headerlink&quot; title=&quot;普通方法&quot;&gt;&lt;/a&gt;普通方法&lt;/h5&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@OnMethod&lt;/span&gt;( clazz = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, method = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上一篇文章我们已经介绍，不清楚的小伙伴，可自行前往查看 &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;h5 id=&quot;构造函数&quot;&gt;&lt;a href=&quot;#构造函数&quot; class=&quot;headerlink&quot; title=&quot;构造函数&quot;&gt;&lt;/a&gt;构造函数&lt;/h5&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@OnMethod&lt;/span&gt;( clazz = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, method = &lt;span class=&quot;string&quot;&gt;&quot;&amp;lt;init&amp;gt;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="btrace" scheme="http://www.gulj.cn/tags/btrace/"/>
    
  </entry>
  
  <entry>
    <title>Java 线上问题排查神器 BTrace 入门</title>
    <link href="http://www.gulj.cn/2018/07/30/Java-%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E7%A5%9E%E5%99%A8-BTrace-%E5%85%A5%E9%97%A8/"/>
    <id>http://www.gulj.cn/2018/07/30/Java-线上问题排查神器-BTrace-入门/</id>
    <published>2018-07-30T03:27:13.000Z</published>
    <updated>2019-02-14T07:07:12.861Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>BTrace是Java平台的安全，动态跟踪工具。</p><p>BTrace可用于动态跟踪正在运行的Java程序（类似于OpenSolaris应用程序和操作系统的DTrace）。 BTrace动态检测目标应用程序的类以注入跟踪代码（“字节码跟踪”）</p><p>BTrace是检查和解决线上的问题的利器，BTrace 可以通过编写脚本的方式，在服务不用重启的情况下，获取程序执行过程中相关信息。</p><a id="more"></a><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><h5 id="下载地址：Btrace-1-3-11"><a href="#下载地址：Btrace-1-3-11" class="headerlink" title="下载地址：Btrace-1.3.11"></a>下载地址：<a href="https://github.com/btraceio/btrace/releases" target="_blank" rel="noopener">Btrace-1.3.11</a></h5><p>  下载完成，进行解压，自行放入读者自己的安装目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压</span></span><br><span class="line">$ tar -zxvf btrace-bin-1.3.11.tgz.tar.gz</span><br></pre></td></tr></table></figure><h5 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h5><ul><li><p>MaxOs用户</p><p>编辑 ~/.bash_profile 文件添加</p></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrace(BTRACE_HOME的路径记得替换成自己的btrace的目录)</span></span><br><span class="line"><span class="built_in">export</span> BTRACE_HOME=/Users/gulj/Applications/developsoftware/btrace  </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$BTRACE_HOME</span>/bin</span><br></pre></td></tr></table></figure><p>  让.bash_profile生效</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> ~./bash_profile</span><br></pre></td></tr></table></figure><ul><li><p>Window用户</p><p>编辑：右键—&gt;我的电脑—&gt;我的电脑—&gt;属性—&gt;高级系统设置—&gt;环境变量—&gt;系统变量</p><p>在系统变量中新建环境变量 BTRACE_HOME </p></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BTRACE_HOME=/Users/gulj/Applications/developsoftware/btrace</span><br></pre></td></tr></table></figure><p>  在系统变量中找到path，在后面添加</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%BTRACE_HOME%\bin</span><br></pre></td></tr></table></figure><h5 id="验证安装是否正确"><a href="#验证安装是否正确" class="headerlink" title="验证安装是否正确"></a>验证安装是否正确</h5>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ btrace --version</span><br><span class="line"></span><br><span class="line">BTrace v.1.3.11 (20180406)</span><br></pre></td></tr></table></figure><h4 id="Btrace运行脚本方式"><a href="#Btrace运行脚本方式" class="headerlink" title="Btrace运行脚本方式"></a>Btrace运行脚本方式</h4><ul><li>在JVisual中添加Btrace插件，添加classpath</li><li>使用命令行 btrace [-I include-path] [-p port] [-cp classpath] pid btrace-script [args]</li></ul><h4 id="Btrace-注解"><a href="#Btrace-注解" class="headerlink" title="Btrace 注解"></a>Btrace 注解</h4><p>在我们解压后的/Users/gulj/Applications/developsoftware/btrace/docs目录下，有个usersguide.html文件，里面详细介绍了各种注解的作用以及使用方法</p><ul><li><strong>Method Annotations</strong><ul><li>@com.sun.btrace.annotations.OnMethod</li><li>@com.sun.btrace.annotations.OnTimer</li><li>@com.sun.btrace.annotations.OnError</li><li>@com.sun.btrace.annotations.OnExit</li><li>@com.sun.btrace.annotations.OnEvent</li><li>@com.sun.btrace.annotations.OnLowMemory</li><li>@com.sun.btrace.annotations.OnProbe</li></ul></li><li><strong>Argument Annotations</strong><ul><li>@com.sun.btrace.annotations.Self</li><li>@com.sun.btrace.annotations.Return</li><li>@com.sun.btrace.annotations.CalledInstance</li><li>@com.sun.btrace.annotations.CalledMethod</li></ul></li><li><strong>Field Annotations</strong><ul><li>@com.sun.btrace.annotations.Export</li><li>@com.sun.btrace.annotations.Property</li><li>@com.sun.btrace.annotations.TLS</li></ul></li><li><strong>Class Annotations</strong><ul><li>@com.sun.btrace.annotations.DTrace</li><li>@com.sun.btrace.annotations.DTraceRef</li><li>@com.sun.btrace.annotations.BTrace</li></ul></li></ul><h4 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h4><h5 id="新建一个springboot的web工程引入btrace的maven相关依赖"><a href="#新建一个springboot的web工程引入btrace的maven相关依赖" class="headerlink" title="新建一个springboot的web工程引入btrace的maven相关依赖"></a>新建一个springboot的web工程引入btrace的maven相关依赖</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- btrace start --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.sun.btrace&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;btrace-boot&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;system&lt;/scope&gt;</span><br><span class="line">    &lt;version&gt;1.3.11&lt;/version&gt;</span><br><span class="line">    &lt;type&gt;jar&lt;/type&gt;</span><br><span class="line">    &lt;systemPath&gt;/Users/gulj/Applications/developsoftware/btrace/build/btrace-boot.jar&lt;/systemPath&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.sun.btrace&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;btrace-client&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;system&lt;/scope&gt;</span><br><span class="line">    &lt;version&gt;1.3.11&lt;/version&gt;</span><br><span class="line">    &lt;type&gt;jar&lt;/type&gt;</span><br><span class="line">    &lt;systemPath&gt;/Users/gulj/Applications/developsoftware/btrace/build/btrace-client.jar&lt;/systemPath&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.sun.btrace&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;btrace-agent&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;system&lt;/scope&gt;</span><br><span class="line">    &lt;version&gt;1.3.11&lt;/version&gt;</span><br><span class="line">    &lt;type&gt;jar&lt;/type&gt;</span><br><span class="line">    &lt;systemPath&gt;/Users/gulj/Applications/developsoftware/btrace/build/btrace-agent.jar&lt;/systemPath&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- btrace end --&gt;</span><br></pre></td></tr></table></figure><h5 id="编写要追踪调试的代码"><a href="#编写要追踪调试的代码" class="headerlink" title="编写要追踪调试的代码"></a>编写要追踪调试的代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">helloBtrace</span><span class="params">(@RequestParam(<span class="string">"name"</span>)</span> String name) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello，"</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="编写追踪代码"><a href="#编写追踪代码" class="headerlink" title="编写追踪代码"></a>编写追踪代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BTrace</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BtracePrintArgSimple</span> </span>&#123;</span><br><span class="line">    <span class="meta">@OnMethod</span>(</span><br><span class="line">            clazz = <span class="string">"com.gulj.monitor.controller.UserController"</span>,</span><br><span class="line">            method = <span class="string">"helloBtrace"</span>,</span><br><span class="line">            location = <span class="meta">@Location</span>(Kind.ENTRY)</span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">andyRead</span><span class="params">(@ProbeClassName String pcn, @ProbeMethodName String pmn, AnyType[] args)</span> </span>&#123;</span><br><span class="line">        BTraceUtils.printArray(args);</span><br><span class="line">        BTraceUtils.println(<span class="string">"className="</span> + pcn + <span class="string">","</span> + <span class="string">"methodName"</span> + pmn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h5><p>先把我们的springboot工程启动，通过 <strong>jps -l</strong> 取得工程的pid ，然后在执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 49165 就是笔者工程的pid</span></span><br><span class="line">btrace 49165 BtracePrintArgSimple.java</span><br></pre></td></tr></table></figure><p>这样我们的追踪代码就处于一直监控状态，此时，我们通过curl、postman等方式，请求我们写好的接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:<span class="comment">//localhost:8080/hello?name="btrace"</span></span><br></pre></td></tr></table></figure><p>那么我们的btrace监控就会输出我们监控的结果</p><p><img src="http://p6nkwri76.bkt.clouddn.com/15329300815070.jpg" alt=""></p><blockquote><p>追踪的代码（BtracePrintArgSimple）可以单独存放，新建一个工程，不必和我们的业务工程放在一起</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;BTrace是Java平台的安全，动态跟踪工具。&lt;/p&gt;
&lt;p&gt;BTrace可用于动态跟踪正在运行的Java程序（类似于OpenSolaris应用程序和操作系统的DTrace）。 BTrace动态检测目标应用程序的类以注入跟踪代码（“字节码跟踪”）&lt;/p&gt;
&lt;p&gt;BTrace是检查和解决线上的问题的利器，BTrace 可以通过编写脚本的方式，在服务不用重启的情况下，获取程序执行过程中相关信息。&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="btrace" scheme="http://www.gulj.cn/tags/btrace/"/>
    
  </entry>
  
  <entry>
    <title>Spring集成ActiveMQ</title>
    <link href="http://www.gulj.cn/2018/06/20/Spring%E9%9B%86%E6%88%90ActiveMQ/"/>
    <id>http://www.gulj.cn/2018/06/20/Spring集成ActiveMQ/</id>
    <published>2018-06-20T10:29:51.000Z</published>
    <updated>2019-02-14T07:07:12.863Z</updated>
    
    <content type="html"><![CDATA[<h4 id="核心类介绍"><a href="#核心类介绍" class="headerlink" title="核心类介绍"></a>核心类介绍</h4><ul><li>ConnectionFactory 用于管理连接的连接工厂<ul><li>一个Spring为我们提供的连接池</li><li>Spring 中提供了 SingleConnectionFactory 和 CachingConnectionFactory</li></ul></li><li>JmsTemplate  用于发送和接收消息的模板类</li><li>MessageListener 消息监听器</li></ul><a id="more"></a><h4 id="在pom-xml中添加ActiveMQ依赖"><a href="#在pom-xml中添加ActiveMQ依赖" class="headerlink" title="在pom.xml中添加ActiveMQ依赖"></a>在pom.xml中添加ActiveMQ依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.2.5.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="队列模式演示"><a href="#队列模式演示" class="headerlink" title="队列模式演示"></a>队列模式演示</h4><h5 id="生产者发送消息"><a href="#生产者发送消息" class="headerlink" title="生产者发送消息"></a>生产者发送消息</h5><p>生产者发送消息接口 <strong>ProducerService.java</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProducerService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String message)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>生产者发送消息接口实现类  <strong>ProducerServiceImpl.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerServiceImpl</span> <span class="keyword">implements</span> <span class="title">ProducerService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JmsTemplate jmsTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"queueDestination"</span>)</span><br><span class="line">    <span class="keyword">private</span> Destination destination;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(<span class="keyword">final</span> String message)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 使用jmsTemplate发送消息</span></span><br><span class="line">        jmsTemplate.send(destination, <span class="keyword">new</span> MessageCreator() &#123;</span><br><span class="line">            <span class="comment">// 创建一个消息</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Message <span class="title">createMessage</span><span class="params">(Session session)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">                TextMessage textMessage = session.createTextMessage(message);</span><br><span class="line">                <span class="keyword">return</span> textMessage;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">"发送消息："</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>生产者公共配置文件 <strong>common.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 启用注解 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- active mq 为我们提供的 ConnectionFactory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"targetConnectionFactory"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brokerURL"</span> <span class="attr">value</span>=<span class="string">"tcp://localhost:61616"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring jms 为我们提供的连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"connectionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.connection.SingleConnectionFactory"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetConnectionFactory"</span> <span class="attr">ref</span>=<span class="string">"targetConnectionFactory"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 一个队列目的地，点对点的--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"queueDestination"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.command.ActiveMQQueue"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"queue-spring"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>生产者配置文件 <strong>producer.xml</strong> 导入公共 <strong>common.xml</strong> 文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 引入公共配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"common.xml"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 配置JmsTemplate，用于发送消息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.core.JmsTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置自己定义的bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.gulj.spring.jms.producer.ProducerServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>生产者启动类 <strong>AppProducer.java</strong> 运行main方法，启动生产者发送消息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppProducer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"producer.xml"</span>);</span><br><span class="line">        ProducerService producerService = context.getBean(ProducerService.class);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">80</span>; i++) &#123;</span><br><span class="line">            producerService.sendMessage(<span class="string">"test spring jms"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        context.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>生产者发送消息运行效果图</p></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15294921036770.jpg" alt=""></p><h5 id="消费者消费消息"><a href="#消费者消费消息" class="headerlink" title="消费者消费消息"></a>消费者消费消息</h5><p>消费者监听消息进行消费 <strong>ConsumerMessageListener.java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerMessageListener</span> <span class="keyword">implements</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">        TextMessage textMessage = (TextMessage) message;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"接收到的消息："</span> + textMessage.getText());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>消费者配置文件 <strong>consumer.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 引入公共配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"common.xml"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 配置自定义的消息监听器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"consumerMessageListener"</span> <span class="attr">class</span>=<span class="string">"com.gulj.spring.jms.consumer.ConsumerMessageListener"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置消息监听容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsContainer"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.listener.DefaultMessageListenerContainer"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 连接工厂 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 队列名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"destination"</span> <span class="attr">ref</span>=<span class="string">"queueDestination"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--消息监听器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageListener"</span> <span class="attr">ref</span>=<span class="string">"consumerMessageListener"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>消费者启动类  <strong>AppConsumer.java</strong> 直接运行main方法，监听消息进行消费</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"consumer.xml"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>消费者消费消息运行效果图</p></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15294923916910.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;核心类介绍&quot;&gt;&lt;a href=&quot;#核心类介绍&quot; class=&quot;headerlink&quot; title=&quot;核心类介绍&quot;&gt;&lt;/a&gt;核心类介绍&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ConnectionFactory 用于管理连接的连接工厂&lt;ul&gt;
&lt;li&gt;一个Spring为我们提供的连接池&lt;/li&gt;
&lt;li&gt;Spring 中提供了 SingleConnectionFactory 和 CachingConnectionFactory&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;JmsTemplate  用于发送和接收消息的模板类&lt;/li&gt;
&lt;li&gt;MessageListener 消息监听器&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="activemq" scheme="http://www.gulj.cn/tags/activemq/"/>
    
  </entry>
  
  <entry>
    <title>ActiveMQ入门教程</title>
    <link href="http://www.gulj.cn/2018/06/12/ActiveMQ%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
    <id>http://www.gulj.cn/2018/06/12/ActiveMQ入门教程/</id>
    <published>2018-06-12T07:10:18.000Z</published>
    <updated>2019-02-14T07:07:12.858Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><h5 id="ActiveMQ"><a href="#ActiveMQ" class="headerlink" title="ActiveMQ"></a>ActiveMQ</h5><p>ActiveMQ 是Apache出的，最流行的，功能强大的即时通讯和集成模式的开源服务器。ActiveMQ 是一个完全支持JMS1.1和J2EE 1.4规范的 JMS Provider实现。提供客户端支持跨语言和协议，带有易于在充分支持JMS 1.1和1.4使用J2EE企业集成模式和许多先进的功能。</p><h5 id="什么是JMS？"><a href="#什么是JMS？" class="headerlink" title="什么是JMS？"></a>什么是JMS？</h5><p>Java消息服务(Java Message Service) 即JMS，是一个java平台中关于面向消息中间件的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。</p><h5 id="什么是AMQP？"><a href="#什么是AMQP？" class="headerlink" title="什么是AMQP？"></a>什么是AMQP？</h5><p>AMQP(advanced message queuing protocol) 是一个提供统一消息服务的应用层标准层协议，基于此协议的客户端与消息中间件可传递性，并不受客户端/中间件不同产品，不同开发语言等条件的限制。</p><a id="more"></a><h5 id="JMS-和-AMQP-对比"><a href="#JMS-和-AMQP-对比" class="headerlink" title="JMS 和 AMQP 对比"></a>JMS 和 AMQP 对比</h5><p><img src="http://p6nkwri76.bkt.clouddn.com/15287919658014.jpg" alt=""></p><h5 id="ActiveMQ、RabbitMQ-和-Kafka-简单对比"><a href="#ActiveMQ、RabbitMQ-和-Kafka-简单对比" class="headerlink" title="ActiveMQ、RabbitMQ 和 Kafka 简单对比"></a>ActiveMQ、RabbitMQ 和 Kafka 简单对比</h5><p><img src="http://p6nkwri76.bkt.clouddn.com/15287922045430.jpg" alt=""></p><h4 id="JMS规范"><a href="#JMS规范" class="headerlink" title="JMS规范"></a>JMS规范</h4><h5 id="JMS相关概念"><a href="#JMS相关概念" class="headerlink" title="JMS相关概念"></a>JMS相关概念</h5><ul><li>消费者/订阅者 ： 接收并处理消息的客户端</li><li>消息 ： 应用程序之间传递的数据内容</li><li>消息模式 ： 在客户端之间传递消息的方式，JMS中定义了主题和队列两种模式</li></ul><h5 id="JMS消息模式—队列模型"><a href="#JMS消息模式—队列模型" class="headerlink" title="JMS消息模式—队列模型"></a>JMS消息模式—队列模型</h5><ul><li>客户端包括生产者和消费者</li><li>队列中的消息只能被一个消费者消费</li><li>消费者可以随时消费队列中的消息</li></ul><blockquote><p>队列模型示意图</p></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15287932053125.jpg" alt=""></p><h5 id="JMS消息模式—主题模型"><a href="#JMS消息模式—主题模型" class="headerlink" title="JMS消息模式—主题模型"></a>JMS消息模式—主题模型</h5><ul><li>客户端包括生产者和消费者</li><li>主题中的消息被所有消费者消费</li><li>消费者必须先订阅，才能消费发送到主题中的消息</li></ul><blockquote><p>主题模型示意图</p></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15287934870520.jpg" alt=""></p><h5 id="JMS编码接口"><a href="#JMS编码接口" class="headerlink" title="JMS编码接口"></a>JMS编码接口</h5><ul><li><strong>ConnectionFactory</strong> 用于创建连接到消息中间件的连接工厂</li><li><strong>Connection</strong> 代表了应用程序和消息服务器之间的通信链路</li><li><strong>Destination</strong> 指消息发布和接收的地点，包括队列或主题</li><li><strong>Session</strong> 表示一个单线程的上下文，用于发送和接收消息</li><li><strong>MessageConsumer</strong> 由会话创建，用于接收发送到目标的消息</li><li><strong>MessageProducer</strong> 由会话创建，用于发送消息到目标</li><li><strong>Message</strong> 是在消费者和生产者之间传送的对象，消息头，一组消息属性，一个消息体</li></ul><h5 id="JMS编码接口之间的关系"><a href="#JMS编码接口之间的关系" class="headerlink" title="JMS编码接口之间的关系"></a>JMS编码接口之间的关系</h5><p><img src="http://p6nkwri76.bkt.clouddn.com/15287940346330.jpg" alt=""></p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><ul><li>查询Docker镜像</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker search activemq</span><br></pre></td></tr></table></figure><ul><li>下载Docker镜像</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull webcenter/activemq</span><br></pre></td></tr></table></figure><ul><li>创建&amp;运行ActiveMQ容器</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name myactivemq -p 61616:61616 -p 8161:8161 webcenter/activemq</span><br></pre></td></tr></table></figure><ul><li>查看WEB管理页面</li></ul><blockquote><p>浏览器输入<a href="http://127.0.0.1:8161/" target="_blank" rel="noopener">http://127.0.0.1:8161/</a>  点击<strong>Manage ActiveMQ broker</strong>使用默认账号/密码：admin/admin进入查看</p></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15287925784817.jpg" alt=""></p><h4 id="队列模式消息和主题模式消息代码演示"><a href="#队列模式消息和主题模式消息代码演示" class="headerlink" title="队列模式消息和主题模式消息代码演示"></a>队列模式消息和主题模式消息代码演示</h4><h5 id="队列模式消息演示"><a href="#队列模式消息演示" class="headerlink" title="队列模式消息演示"></a>队列模式消息演示</h5><p><strong> 生产者 AppProducer.java </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppProducer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MQ服务器地址</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String BROKER_URL = <span class="string">"tcp://127.0.0.1:61616"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 队列名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">"queue-test"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.创建连接工厂</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ActiveMQConnectionFactory(BROKER_URL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.创建连接</span></span><br><span class="line">        Connection connection = factory.createConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.启动连接</span></span><br><span class="line">        connection.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.创建会话</span></span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.创建一个目标</span></span><br><span class="line">        Destination destination = session.createQueue(QUEUE_NAME);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.创建一个生产者</span></span><br><span class="line">        MessageProducer producer = session.createProducer(destination);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 循环发送消息</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// 创建消息</span></span><br><span class="line">            TextMessage textMessage = session.createTextMessage(<span class="string">"【test-activemq-producer】"</span> + i);</span><br><span class="line">            <span class="comment">// 发布消息</span></span><br><span class="line">            producer.send(textMessage);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"消息发送成功："</span> + textMessage);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭连接</span></span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>消费者 AppConsumer.java</strong> (由于消费者的创建流程和生产者非常类似，特意用 ActiveMqHelper 类进行简单封装一下)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建连接</span></span><br><span class="line">        Connection connection = ActiveMqHelper.createConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建会话</span></span><br><span class="line">        Session session = ActiveMqHelper.createSession(connection);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个目标</span></span><br><span class="line">        Destination destination = ActiveMqHelper.createQueue(session);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个消费者</span></span><br><span class="line">        MessageConsumer consumer = session.createConsumer(destination);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 消费者监听要消费的信息</span></span><br><span class="line">        consumer.setMessageListener(message -&gt; &#123;</span><br><span class="line">            <span class="comment">// 接收到的消息内容c</span></span><br><span class="line">            TextMessage textMessage = (TextMessage) message;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"【消费者接收到的消息】"</span> + textMessage.getText());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭连接,因为监听是异步操作，</span></span><br><span class="line">        <span class="comment">// 如果事先关闭连接，监听操作还未处理完成，则会收不到消息，</span></span><br><span class="line">        <span class="comment">// 正常处理逻辑是在监听事件处理完成后，再释放连接</span></span><br><span class="line">        <span class="comment">// connection.close();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>MQ帮助类 ActiveMqHelper.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActiveMqHelper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MQ服务器地址</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String BROKER_URL = <span class="string">"tcp://127.0.0.1:61616"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 队列名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">"queue-test"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主题名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_NAME = <span class="string">"topic-test"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建连接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> JMSException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">createConnection</span><span class="params">()</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.创建连接工厂</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ActiveMQConnectionFactory(BROKER_URL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.创建连接</span></span><br><span class="line">        Connection connection = factory.createConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.启动连接</span></span><br><span class="line">        connection.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建会话</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> connection</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> JMSException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">createSession</span><span class="params">(Connection connection)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">// 4.创建会话</span></span><br><span class="line">        <span class="keyword">return</span> connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建队列目标</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> JMSException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Destination <span class="title">createQueue</span><span class="params">(Session session)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">// 5.创建一个队列目标</span></span><br><span class="line">        <span class="keyword">return</span> session.createQueue(QUEUE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建主题目标</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> JMSException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Destination <span class="title">createTopic</span><span class="params">(Session session)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">// 5.创建一个主题目标</span></span><br><span class="line">        <span class="keyword">return</span> session.createTopic(TOPIC_NAME);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>代码效果图展示</code></pre><p><img src="http://p6nkwri76.bkt.clouddn.com/15287957083915.jpg" alt=""></p><h5 id="主题模式消息演示"><a href="#主题模式消息演示" class="headerlink" title="主题模式消息演示"></a>主题模式消息演示</h5><p><strong>生产者 AppProducer.java</strong> (主题模式的代码示例和队列模式的代码示例基本相同，只有在创建主题目标的时候不同，还请老铁自行实现) <strong>消费者同理参考队列模式代码实现</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppProducer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">// ....</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3.创建主题目标 (与队列模式唯一区别的代码，其它都一样)</span></span><br><span class="line">        Destination destination = session.createTopic(TOPIC_NAME);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ....</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>主题模式注意点</strong>：<br>1、先启动AppConsumer.java类（消费者先进行订阅），在启动 AppProvider.java 类（生产者进行生产）这样消费者才能监听到生产者生成的消息进行消费；队列模式没有此要求<br>2、生产者生产100条消息，若有多个消费者，每个消费者均消费100条消息；而队列模式，则是每个消费者合计起来消费这 100 条消息</p></blockquote><pre><code>代码效果图展示</code></pre><p><img src="http://p6nkwri76.bkt.clouddn.com/15287962252457.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;h5 id=&quot;ActiveMQ&quot;&gt;&lt;a href=&quot;#ActiveMQ&quot; class=&quot;headerlink&quot; title=&quot;ActiveMQ&quot;&gt;&lt;/a&gt;ActiveMQ&lt;/h5&gt;&lt;p&gt;ActiveMQ 是Apache出的，最流行的，功能强大的即时通讯和集成模式的开源服务器。ActiveMQ 是一个完全支持JMS1.1和J2EE 1.4规范的 JMS Provider实现。提供客户端支持跨语言和协议，带有易于在充分支持JMS 1.1和1.4使用J2EE企业集成模式和许多先进的功能。&lt;/p&gt;
&lt;h5 id=&quot;什么是JMS？&quot;&gt;&lt;a href=&quot;#什么是JMS？&quot; class=&quot;headerlink&quot; title=&quot;什么是JMS？&quot;&gt;&lt;/a&gt;什么是JMS？&lt;/h5&gt;&lt;p&gt;Java消息服务(Java Message Service) 即JMS，是一个java平台中关于面向消息中间件的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。&lt;/p&gt;
&lt;h5 id=&quot;什么是AMQP？&quot;&gt;&lt;a href=&quot;#什么是AMQP？&quot; class=&quot;headerlink&quot; title=&quot;什么是AMQP？&quot;&gt;&lt;/a&gt;什么是AMQP？&lt;/h5&gt;&lt;p&gt;AMQP(advanced message queuing protocol) 是一个提供统一消息服务的应用层标准层协议，基于此协议的客户端与消息中间件可传递性，并不受客户端/中间件不同产品，不同开发语言等条件的限制。&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="activemq" scheme="http://www.gulj.cn/tags/activemq/"/>
    
  </entry>
  
  <entry>
    <title>Mac OSX平台使用jenv管理多个Java版本</title>
    <link href="http://www.gulj.cn/2018/06/08/OSX%E5%B9%B3%E5%8F%B0%E4%BD%BF%E7%94%A8jenv%E7%AE%A1%E7%90%86%E5%A4%9A%E4%B8%AAJava%E7%89%88%E6%9C%AC/"/>
    <id>http://www.gulj.cn/2018/06/08/OSX平台使用jenv管理多个Java版本/</id>
    <published>2018-06-08T08:45:28.000Z</published>
    <updated>2019-02-14T07:07:12.862Z</updated>
    
    <content type="html"><![CDATA[<h4 id="JDK安装"><a href="#JDK安装" class="headerlink" title="JDK安装"></a>JDK安装</h4><ul><li>JDK下载</li></ul><p><a href="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html" target="_blank" rel="noopener">jdk7下载链接</a></p><p><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">jdk8下载链接</a></p><blockquote><p>下载自己需要的扩展名为dmg的Jdk版本，按照提示直接一步步安装即可</p></blockquote><ul><li>配置JDK环境变量</li></ul><p>打开 vim ~/.bash_profile 文件 进行添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_8_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_112.jdk/Contents/Home</span><br><span class="line"><span class="built_in">export</span> JAVA_7_HOME=/Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home</span><br><span class="line"><span class="comment"># 默认激活 jdk8</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=<span class="variable">$JAVA_8_HOME</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>编辑完成，重新加载 .bash_profile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure><h4 id="jEnv安装"><a href="#jEnv安装" class="headerlink" title="jEnv安装"></a>jEnv安装</h4><ul><li>安装</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install jenv</span><br></pre></td></tr></table></figure><ul><li>配置</li></ul><p>安装了zsh，配置如下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'export PATH="$HOME/.jenv/bin:$PATH"'</span> &gt;&gt; ~/.zshrc</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'eval "$(jenv init -)"'</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure></p><p>如果是默认的bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'export PATH="$HOME/.jenv/bin:$PATH"'</span> &gt;&gt; ~/.bash_profile</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'eval "$(jenv init -)"'</span> &gt;&gt; ~/.bash_profilec</span><br></pre></td></tr></table></figure><h4 id="jEnv配置JDK"><a href="#jEnv配置JDK" class="headerlink" title="jEnv配置JDK"></a>jEnv配置JDK</h4><p>查看安装的java版本，如果我们一开始未添加jdk，执行jenv versions 应该是空的，* 号位置表示当前的jdk版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ jenv versions</span><br><span class="line">  system</span><br><span class="line">  1.7</span><br><span class="line">* 1.7.0.80 (<span class="built_in">set</span> by /Users/gulj/.java-version)</span><br><span class="line">  1.8</span><br><span class="line">  1.8.0.112</span><br><span class="line">  oracle64-1.7.0.80</span><br><span class="line">  oracle64-1.8.0.112</span><br></pre></td></tr></table></figure><p>重启下terminal，为jEnv添加java版本</p><pre><code>添加jdk7</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jenv add /Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home</span><br></pre></td></tr></table></figure><pre><code>添加jdk8</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jenv add /Library/Java/JavaVirtualMachines/jdk1.8.0_112.jdk/Contents/Home</span><br></pre></td></tr></table></figure><blockquote><p>添加完jdk7和jdk8之后，再执行 <strong>jenv versions</strong> 命令就会看到我们添加的jdk</p></blockquote><h4 id="jEnv常用命令"><a href="#jEnv常用命令" class="headerlink" title="jEnv常用命令"></a>jEnv常用命令</h4><ul><li>移除指定版本jdk</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jenv remove 1.8.0.111</span><br></pre></td></tr></table></figure><ul><li>选择一个jdk版本</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jenv <span class="built_in">local</span> 1.8.0.111</span><br></pre></td></tr></table></figure><ul><li>设置默认的jdk版本</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jenv global 1.8.0.111</span><br></pre></td></tr></table></figure><ul><li>查看当前版本jdk的路径</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jenv <span class="built_in">which</span> java</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;JDK安装&quot;&gt;&lt;a href=&quot;#JDK安装&quot; class=&quot;headerlink&quot; title=&quot;JDK安装&quot;&gt;&lt;/a&gt;JDK安装&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;JDK下载&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;http://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;jdk7下载链接&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;jdk8下载链接&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;下载自己需要的扩展名为dmg的Jdk版本，按照提示直接一步步安装即可&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;配置JDK环境变量&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;打开 vim ~/.bash_profile 文件 进行添加&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; JAVA_8_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_112.jdk/Contents/Home&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; JAVA_7_HOME=/Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 默认激活 jdk8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; JAVA_HOME=&lt;span class=&quot;variable&quot;&gt;$JAVA_8_HOME&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="mac" scheme="http://www.gulj.cn/tags/mac/"/>
    
  </entry>
  
  <entry>
    <title>Mac OSX平台开发工具和常用软件推荐</title>
    <link href="http://www.gulj.cn/2018/06/07/OSX%E5%B9%B3%E5%8F%B0%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E5%92%8C%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E6%8E%A8%E8%8D%90/"/>
    <id>http://www.gulj.cn/2018/06/07/OSX平台开发工具和常用软件推荐/</id>
    <published>2018-06-07T01:30:46.000Z</published>
    <updated>2019-02-14T07:07:12.863Z</updated>
    
    <content type="html"><![CDATA[<h4 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h4><blockquote><h5 id="Beyond-Compare-4"><a href="#Beyond-Compare-4" class="headerlink" title="Beyond Compare 4"></a><a href="">Beyond Compare 4</a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283665142155.jpg" alt=""></p><p>Beyond Compare 是一款强大专业的文件和文件夹对比工具。使用它可以很方便地比较出两个文件或文件夹的差异，相差的每一个字节用颜色加以标识，让您查看方便，支持众多种格式的对比。只需使用简单操作方式方可开启快捷省事的文件对比体验，找出您所需差异、合并变化，然后同步文件，并生成报告一气呵成。</p><pre><code>因版本问题，不再提供下载，还请大家支持正版！</code></pre><a id="more"></a><blockquote><h5 id="IntelliJ-IDEA"><a href="#IntelliJ-IDEA" class="headerlink" title="IntelliJ IDEA"></a><a href="https://www.jetbrains.com/idea/download/#section=mac" target="_blank" rel="noopener"><strong>IntelliJ IDEA</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283664787908.jpg" alt=""></p><p>IntelliJ IDEA 主要用于支持 Java、Scala、Groovy 等语言的开发工具，同时具备支持目前主流的技术和框架，擅长于企业应用、移动应用和 Web 应用的开发</p><ul><li><a href="https://www.jetbrains.com/idea/download/#section=mac" target="_blank" rel="noopener">IntelliJ IDEA 下载</a></li></ul><blockquote><h5 id="Navicat-Premium-12"><a href="#Navicat-Premium-12" class="headerlink" title="Navicat Premium 12"></a><a href=""><strong>Navicat Premium 12</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283665560503.jpg" alt=""></p><p>Navicat Premium是一套数据库管理工具，结合了其它Navicat成员的功能，支持单一程序同時连接到MySQL、MariaDB、SQL Server、SQLite、Oracle和PostgreSQL数据库。Navicat Premium可满足现今数据库管理系统的使用功能，包括存储过程、事件、触发器、函数、视图等。</p><ul><li><a href="https://pan.baidu.com/s/1Yg_URJVMrwXpWg0Zjz0U7A" target="_blank" rel="noopener">Navicat Premium 12.0.26 Mac中文破解版下载</a>  密码: x643</li></ul><blockquote><h5 id="SwitchHosts"><a href="#SwitchHosts" class="headerlink" title="SwitchHosts"></a><a href="https://oldj.github.io/SwitchHosts/" target="_blank" rel="noopener"><strong>SwitchHosts</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283666788213.jpg" alt=""></p><p>用于快速切换 hosts 文件的小程序，基于 Electron 开发，同时使用了 React、Ant Design 以及 CodeMirror 等框架/库。</p><ul><li><a href="https://oldj.github.io/SwitchHosts/" target="_blank" rel="noopener">SwitchHosts下载</a></li></ul><blockquote><h5 id="Charles"><a href="#Charles" class="headerlink" title="Charles"></a><a href=""><strong>Charles</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283852138077.jpg" alt=""></p><p>Charles是一款用于HTTP信息抓包工具，可以快速有效的获得HTTP信息，非常利于开发者的网页开发和调试修改等！Charles 有着可视化的操作界面，非常利用编辑者的使用和调试！</p><p><a href="https://pan.baidu.com/s/13wK-LESpOnlkDHnDeKzT8g" target="_blank" rel="noopener">Charles 4.2.5 Mac破解版下载</a>   密码: mpdd</p><blockquote><h5 id="iTerm2"><a href="#iTerm2" class="headerlink" title="iTerm2"></a><a href="https://www.iterm2.com/downloads.html" target="_blank" rel="noopener"><strong>iTerm2</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283668785778.jpg" alt=""></p><p>iTerm2是Mac下最好的终端工具</p><ul><li><a href="https://www.iterm2.com/downloads.html" target="_blank" rel="noopener">iTerm2下载</a></li></ul><blockquote><h5 id="typora"><a href="#typora" class="headerlink" title="typora"></a><a href="https://www.typora.io/" target="_blank" rel="noopener"><strong>typora</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283510068673.jpg" alt="typora下载"></p><p>一款无可挑剔的 Markdown 编辑器</p><ul><li><a href="https://www.typora.io/" target="_blank" rel="noopener">typora下载</a></li></ul><blockquote><h5 id="Redis-Desktop-Manager"><a href="#Redis-Desktop-Manager" class="headerlink" title="Redis Desktop Manager"></a><a href=""><strong>Redis Desktop Manager</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283517957054.jpg" alt=""></p><p>一款基于Qt5的跨平台Redis桌面管理软件</p><ul><li><a href="https://github.com/uglide/RedisDesktopManager/releases" target="_blank" rel="noopener">Redis Desktop Manager下载</a></li></ul><blockquote><h5 id="VirtualBox"><a href="#VirtualBox" class="headerlink" title="VirtualBox"></a><a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="noopener"><strong>VirtualBox</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283521669374.jpg" alt=""></p><p>VirtualBox号称是最强的免费虚拟机软件，它不仅具有丰富的特色，而且性能也很优异！</p><ul><li><a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="noopener">VirtualBox 下载</a></li></ul><blockquote><h5 id="Postman"><a href="#Postman" class="headerlink" title="Postman"></a><a href="https://www.getpostman.com" target="_blank" rel="noopener"><strong>Postman</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283526329071.jpg" alt=""></p><p>Postman是google开发的一款功能强大的网页调试与发送网页HTTP请求，并能运行测试用例的的Chrome插件</p><ul><li><a href="https://www.getpostman.com/apps" target="_blank" rel="noopener">Postman 下载</a></li></ul><blockquote><h5 id="Visual-Studio-Code"><a href="#Visual-Studio-Code" class="headerlink" title="Visual Studio Code"></a><a href="https://code.visualstudio.com/" target="_blank" rel="noopener"><strong>Visual Studio Code</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283533842261.jpg" alt=""></p><p>Visual Studio Code（简称VS Code）是一个由微软开发的，同时支持Windows、Linux和macOS操作系统且开放源代码的文本编辑器。[4]它支持调试，并内置了Git 版本控制功能，同时也具有开发环境功能，例如代码补全（类似于 IntelliSense）、代码片段、代码重构等。该编辑器支持用户自定义配置，例如改变主题颜色、键盘快捷方式、编辑器属性和其他参数，还支持扩展程序并在编辑器中内置了扩展程序管理的功能</p><ul><li><a href="https://code.visualstudio.com/" target="_blank" rel="noopener">Visual Studio Code 下载</a></li></ul><blockquote><h5 id="Go2Shell"><a href="#Go2Shell" class="headerlink" title="Go2Shell"></a><a href="http://zipzapmac.com/go2shell" target="_blank" rel="noopener"><strong>Go2Shell</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283669617974.jpg" alt=""></p><p>Go2Shell 可以在 Finder 中打开当前目录的终端窗口，是一个对开发者来说非常有用的App</p><ul><li><a href="http://zipzapmac.com/go2shell" target="_blank" rel="noopener">Go2Shell 下载</a></li></ul><blockquote><h5 id="Axure-RP"><a href="#Axure-RP" class="headerlink" title="Axure RP"></a><a href=""><strong>Axure RP</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283649835518.jpg" alt=""></p><p>Axure RP是美国Axure Software Solution公司旗舰产品，是一个专业的快速原型设计工具，让负责定义需求和规格、设计功能和界面的专家能够快速创建应用软件或Web网站的线框图、流程图、原型和规格说明文档。作为专业的原型设计工具，它能快速、高效的创建原型，同时支持多人协作设计和版本控制管理。</p><ul><li><a href="https://pan.baidu.com/s/1TgoSd1gv5oaBmNDlxn7GpQ" target="_blank" rel="noopener">Axure RP 8.1.0.3372 Mac破解版下载</a>  密码: ast9</li></ul><h4 id="常用软件"><a href="#常用软件" class="headerlink" title="常用软件"></a>常用软件</h4><blockquote><h5 id="PDF-Expert"><a href="#PDF-Expert" class="headerlink" title="PDF Expert"></a><a href=""><strong>PDF Expert</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283663140153.jpg" alt=""></p><p>快速、轻巧、易用的PDF编辑器，轻松在MAC上完成PDF编辑、阅读、批注、编辑文本、添加照片、填写表单、签署合同、合并PDF文档以及加密保护，只需轻轻点击几下即可，前所未有的体验</p><pre><code>因版本问题，不再提供下载，还请大家支持正版！</code></pre><blockquote><h5 id="Alfred-3"><a href="#Alfred-3" class="headerlink" title="Alfred 3"></a><a href=""><strong>Alfred 3</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283630704984.jpg" alt=""></p><p>Alfred可以帮助你快速、方便的打开任意应用程序，配合快捷键你可以大大提高工作效率。</p><ul><li><a href="https://pan.baidu.com/s/1CNRCeXBkkoQo2YM0M54yvg" target="_blank" rel="noopener">Alfred 3.6.1 Mac破解版下载</a> 密码: kq9t</li></ul><blockquote><h5 id="BetterZip"><a href="#BetterZip" class="headerlink" title="BetterZip"></a><a href=""><strong>BetterZip</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283636990531.jpg" alt=""></p><p>BetterZip是一款功能强大的压缩软件，不必解压就能快速地检查压缩文档。它能执行文件之间的合并并提供密码。使用它，用户可以更快捷的向压缩文件中添加和删除文件。 它支持包括zip、gz、bz、bz2、tar、tgz、tbz、rar、7-zip、cpio、 arj、lha、lhz、cab、iso、chm、rpm、deb、nsis、sit、dd、hqx和bin等多种格式的文件。</p><ul><li><a href="https://pan.baidu.com/s/1G-U64a1X4-i7ytVkpqbOfQ" target="_blank" rel="noopener">BetterZip 4.1.3 Mac中文破解版下载</a> 密码: kndb</li></ul><blockquote><h5 id="Snagit"><a href="#Snagit" class="headerlink" title="Snagit"></a><a href=""><strong>Snagit</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283663479522.jpg" alt=""></p><p>Snagit可以使用此工具轻松抓取图像、文本和影音等多种内容形式，内置强大编辑器，捕捉、编辑一步到位。</p><ul><li><a href="https://pan.baidu.com/s/1MOrfJjxCiuKSOf5n8IX6Ug" target="_blank" rel="noopener">Snagit 4.1.9 Mac破解版下载</a>  密码: dga7</li></ul><blockquote><h5 id="Office"><a href="#Office" class="headerlink" title="Office"></a><a href=""><strong>Office</strong></a></h5></blockquote><p><img src="http://p6nkwri76.bkt.clouddn.com/15283662261261.jpg" alt=""></p><p>Office 2016是一款集成自动化办公软件，Office 2016由各种功能组件构成，包括Word 2016、Excel 2016、PowerPoint 2016、Access 2016、Outlook 2016和Publisher 2016等</p><p><a href="https://pan.baidu.com/s/1WN8wuONp7Qd3C_I0F9hO3w" target="_blank" rel="noopener">Office 2016 16.13.1 Mac中文破解版下载</a>  密码: 2qwt</p><p><a href="https://pan.baidu.com/s/13jKpDdtZObT-MLZUMkAkSw" target="_blank" rel="noopener">Office 2016 破解补丁下载</a>  密码: 8y59</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;开发工具&quot;&gt;&lt;a href=&quot;#开发工具&quot; class=&quot;headerlink&quot; title=&quot;开发工具&quot;&gt;&lt;/a&gt;开发工具&lt;/h4&gt;&lt;blockquote&gt;
&lt;h5 id=&quot;Beyond-Compare-4&quot;&gt;&lt;a href=&quot;#Beyond-Compare-4&quot; class=&quot;headerlink&quot; title=&quot;Beyond Compare 4&quot;&gt;&lt;/a&gt;&lt;a href=&quot;&quot;&gt;Beyond Compare 4&lt;/a&gt;&lt;/h5&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;http://p6nkwri76.bkt.clouddn.com/15283665142155.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Beyond Compare 是一款强大专业的文件和文件夹对比工具。使用它可以很方便地比较出两个文件或文件夹的差异，相差的每一个字节用颜色加以标识，让您查看方便，支持众多种格式的对比。只需使用简单操作方式方可开启快捷省事的文件对比体验，找出您所需差异、合并变化，然后同步文件，并生成报告一气呵成。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;因版本问题，不再提供下载，还请大家支持正版！
&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="工具" scheme="http://www.gulj.cn/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="mac" scheme="http://www.gulj.cn/tags/mac/"/>
    
  </entry>
  
  <entry>
    <title>IntelliJ IDEA 使用技巧</title>
    <link href="http://www.gulj.cn/2018/05/23/idea-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    <id>http://www.gulj.cn/2018/05/23/idea-使用技巧/</id>
    <published>2018-05-23T09:37:25.000Z</published>
    <updated>2019-02-14T07:07:12.865Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h4 id="无处不在的跳转"><a href="#无处不在的跳转" class="headerlink" title="无处不在的跳转"></a>无处不在的跳转</h4></blockquote><ul><li><h5 id="项目之间的跳转"><a href="#项目之间的跳转" class="headerlink" title="项目之间的跳转"></a>项目之间的跳转</h5><ul><li><h6 id="下一个工程窗口-（Window-gt-Next-Project-Window）"><a href="#下一个工程窗口-（Window-gt-Next-Project-Window）" class="headerlink" title="下一个工程窗口 （Window -&gt; Next Project Window）"></a>下一个工程窗口 （Window -&gt; Next Project Window）</h6><pre><code>alt + command + ]</code></pre></li><li><h6 id="上一个工程窗口-（Window-gt-Previous-Project-Window）"><a href="#上一个工程窗口-（Window-gt-Previous-Project-Window）" class="headerlink" title="上一个工程窗口 （Window -&gt; Previous Project Window）"></a>上一个工程窗口 （Window -&gt; Previous Project Window）</h6><pre><code>alt + command + [</code></pre><a id="more"></a></li></ul></li><li><h5 id="文件之间的跳转"><a href="#文件之间的跳转" class="headerlink" title="文件之间的跳转"></a>文件之间的跳转</h5><ul><li><h6 id="查看当前打开的文件"><a href="#查看当前打开的文件" class="headerlink" title="查看当前打开的文件"></a>查看当前打开的文件</h6><pre><code>command + e</code></pre></li><li><h6 id="只查看当前打开并且修改的文件"><a href="#只查看当前打开并且修改的文件" class="headerlink" title="只查看当前打开并且修改的文件"></a>只查看当前打开并且修改的文件</h6><pre><code>shift + command + e</code></pre></li></ul></li><li><h5 id="浏览修改位置跳转"><a href="#浏览修改位置跳转" class="headerlink" title="浏览修改位置跳转"></a>浏览修改位置跳转</h5><ul><li><h6 id="最后一次修改的位置-（Navigate-gt-Last-Edit-Location）"><a href="#最后一次修改的位置-（Navigate-gt-Last-Edit-Location）" class="headerlink" title="最后一次修改的位置 （Navigate -&gt; Last Edit Location）"></a>最后一次修改的位置 （Navigate -&gt; Last Edit Location）</h6><pre><code>shift + command + delete</code></pre></li></ul></li><li><h5 id="浏览位置跳转"><a href="#浏览位置跳转" class="headerlink" title="浏览位置跳转"></a>浏览位置跳转</h5><ul><li><h6 id="后一个浏览的位置-（Navigate-gt-Back）"><a href="#后一个浏览的位置-（Navigate-gt-Back）" class="headerlink" title="后一个浏览的位置 （Navigate -&gt; Back）"></a>后一个浏览的位置 （Navigate -&gt; Back）</h6><pre><code>alt + command + &lt;—</code></pre></li><li><h6 id="前一个浏览的位置-（Navigate-gt-Forward）"><a href="#前一个浏览的位置-（Navigate-gt-Forward）" class="headerlink" title="前一个浏览的位置 （Navigate -&gt; Forward）"></a>前一个浏览的位置 （Navigate -&gt; Forward）</h6><pre><code>alt + command + —&gt;</code></pre></li></ul></li><li><h5 id="收藏类或某一个方法"><a href="#收藏类或某一个方法" class="headerlink" title="收藏类或某一个方法"></a>收藏类或某一个方法</h5><p>使用 command + 2 调出 favorite 窗口<br><img src="http://p6nkwri76.bkt.clouddn.com/15272128141350.jpg" alt=""><br>使用快捷键 <strong>alt + shirt + f</strong> 可以将类添加到自定的favorite中，添加方法：首先要选中方法名，然后再按住快捷键( <strong>shift + command + f</strong> )进行添加<br><img src="http://p6nkwri76.bkt.clouddn.com/15272131524517.jpg" alt=""></p></li><li><h5 id="字符跳转插件emacsIdea置跳转"><a href="#字符跳转插件emacsIdea置跳转" class="headerlink" title="字符跳转插件emacsIdea置跳转"></a>字符跳转插件emacsIdea置跳转</h5></li></ul><p><strong>作用：</strong> 快速跳转到以某一个字符开头的位置</p><p>安装插件 <strong>eamcsIdea</strong> 的方法可以查看我上一篇博文 <a href="http://gulj.cn/2018/05/22/intellij-idea-%E5%BF%85%E5%A4%87%E6%8F%92%E4%BB%B6/#more" target="_blank" rel="noopener">Intellij Idea 必备插件 </a></p><p>插件安装完成，在keymap中找到 AceJumpWord 右键选择 Add Keyboard ShorCut 添加 <strong>crtl + k</strong> 快捷键<br><img src="http://p6nkwri76.bkt.clouddn.com/15272152818371.jpg" alt=""></p><p>效果演示<br><strong>需求</strong>：跳转到以 a 字母开头 address 位置；（在效果图T1类中有三个地方是以字母a开头，“成员变量 address，成员变量 age，局部变量 a ”）；<br><strong>操作：</strong>首先我们先按 <strong>ctrl + k</strong>（就是我们之前定义插件eamcsIdea的快捷键） 然后按字母 <strong>a</strong>（想以什么字母开头就按什么字母，这里只演示以a字母开头） 这样在T1类中就会以字母标识选中所有以a开头的字符，我们要跳转到哪里就按选中标识的字符即可 ，现在我们要跳转到 <strong>address</strong> 位置，选中的字符是 <strong>d</strong> 在键盘上按字符 <strong>d</strong> 即可</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-25_10-41-33.gif" alt="2018-05-25_10-41-33"></p><blockquote><h4 id="精准搜索"><a href="#精准搜索" class="headerlink" title="精准搜索"></a>精准搜索</h4></blockquote><ul><li><h5 id="类"><a href="#类" class="headerlink" title="类"></a>类</h5><pre><code>command + n</code></pre></li><li><h5 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h5><pre><code>shift + command + n</code></pre></li><li><h5 id="方法或属性"><a href="#方法或属性" class="headerlink" title="方法或属性"></a>方法或属性</h5><pre><code>alt + shift + command + n</code></pre></li><li><h5 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h5><pre><code>ctrl + shift + f </code></pre></li></ul><blockquote><h4 id="代码小助手"><a href="#代码小助手" class="headerlink" title="代码小助手"></a>代码小助手</h4></blockquote><ul><li><h5 id="列操作"><a href="#列操作" class="headerlink" title="列操作"></a>列操作</h5></li></ul><p>选中一个冒号（ <strong>：</strong>）字符，按 <strong>ctrl + command + g</strong> 则会选中所有冒号，按键盘左右方向键进行光标左右方向移动, 按 <strong>command + w</strong> 可选中一定区域的字符<br><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-25_08-37-55.gif" alt="2018-05-25_08-37-55"></p><ul><li><h5 id="Live-Template"><a href="#Live-Template" class="headerlink" title="Live Template"></a>Live Template</h5></li></ul><p>作用：定义诸多代码模板，利用快捷键快速生成自定义代码模板</p><p>演示：<br><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-25_13-07-44.gif" alt="2018-05-25_13-07-44"></p><p>笔者常用自定义的代码模板如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// int 常量</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> $VAR1$ = $VAR2$;</span><br><span class="line"></span><br><span class="line"><span class="comment">// String 常量 </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> $VAR1$ = $VAR2$;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带有注释的 private int 快捷键 （pic）</span></span><br><span class="line">************************************</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * $VAR1$</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> $VAR2$;</span><br><span class="line"></span><br><span class="line">$END$</span><br><span class="line">************************************</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带有注释的 private String 快捷键 （psc）</span></span><br><span class="line">************************************</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * $VAR1$</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String $VAR2$;</span><br><span class="line"></span><br><span class="line">$END$</span><br><span class="line">************************************</span><br></pre></td></tr></table></figure><ul><li><h5 id="Postfix"><a href="#Postfix" class="headerlink" title="Postfix"></a>Postfix</h5></li></ul><p>介绍 for，nn，sout，return 的用法</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-25_13-43-36.gif" alt="2018-05-25_13-43-36"></p><ul><li><h5 id="神奇的-alter-enter"><a href="#神奇的-alter-enter" class="headerlink" title="神奇的 alter + enter"></a>神奇的 alter + enter</h5></li></ul><p>使用 alter + enter 快捷键能够帮助我们：实现接口、导包、创建函数、纠正单词拼写、生成函数返回变量、字符串format等等</p><p>演示：</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-25_14-42-30.gif" alt="2018-05-25_14-42-30"></p><blockquote><h4 id="编写高质量的代码"><a href="#编写高质量的代码" class="headerlink" title="编写高质量的代码"></a>编写高质量的代码</h4></blockquote><ul><li><h5 id="重构（重构变量，重构方法）"><a href="#重构（重构变量，重构方法）" class="headerlink" title="重构（重构变量，重构方法）"></a>重构（重构变量，重构方法）</h5><p> 光标放到变量位置 按 <strong>shift + f6</strong> 会出现红框选中变量，进行变量重构；为方法添加参数，使用 <strong>alter + enter</strong> 提示进行方法重构</p></li></ul><p>演示：<br><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-25_15-26-56.gif" alt="2018-05-25_15-26-56"></p><ul><li><h5 id="抽取"><a href="#抽取" class="headerlink" title="抽取"></a>抽取</h5><ul><li><h6 id="抽取变量"><a href="#抽取变量" class="headerlink" title="抽取变量"></a>抽取变量</h6><pre><code>alt + command + v</code></pre></li><li><h6 id="抽取静态变量"><a href="#抽取静态变量" class="headerlink" title="抽取静态变量"></a>抽取静态变量</h6><pre><code>alt + command + c</code></pre></li><li><h6 id="抽取成员变量"><a href="#抽取成员变量" class="headerlink" title="抽取成员变量"></a>抽取成员变量</h6><pre><code>alt + command + f</code></pre></li></ul></li></ul><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-25_15-42-02.gif" alt="2018-05-25_15-42-02"></p><ul><li><h6 id="抽取方法参数"><a href="#抽取方法参数" class="headerlink" title="抽取方法参数"></a>抽取方法参数</h6><pre><code>alt + command + p</code></pre></li></ul><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-25_15-54-22.gif" alt="2018-05-25_15-54-22"></p><ul><li><h6 id="抽取方法"><a href="#抽取方法" class="headerlink" title="抽取方法"></a>抽取方法</h6><pre><code>alt + command + m</code></pre></li></ul><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-25_16-06-25.gif" alt="2018-05-25_16-06-25"></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;h4 id=&quot;无处不在的跳转&quot;&gt;&lt;a href=&quot;#无处不在的跳转&quot; class=&quot;headerlink&quot; title=&quot;无处不在的跳转&quot;&gt;&lt;/a&gt;无处不在的跳转&lt;/h4&gt;&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;h5 id=&quot;项目之间的跳转&quot;&gt;&lt;a href=&quot;#项目之间的跳转&quot; class=&quot;headerlink&quot; title=&quot;项目之间的跳转&quot;&gt;&lt;/a&gt;项目之间的跳转&lt;/h5&gt;&lt;ul&gt;
&lt;li&gt;&lt;h6 id=&quot;下一个工程窗口-（Window-gt-Next-Project-Window）&quot;&gt;&lt;a href=&quot;#下一个工程窗口-（Window-gt-Next-Project-Window）&quot; class=&quot;headerlink&quot; title=&quot;下一个工程窗口 （Window -&amp;gt; Next Project Window）&quot;&gt;&lt;/a&gt;下一个工程窗口 （Window -&amp;gt; Next Project Window）&lt;/h6&gt;&lt;pre&gt;&lt;code&gt;alt + command + ]
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;h6 id=&quot;上一个工程窗口-（Window-gt-Previous-Project-Window）&quot;&gt;&lt;a href=&quot;#上一个工程窗口-（Window-gt-Previous-Project-Window）&quot; class=&quot;headerlink&quot; title=&quot;上一个工程窗口 （Window -&amp;gt; Previous Project Window）&quot;&gt;&lt;/a&gt;上一个工程窗口 （Window -&amp;gt; Previous Project Window）&lt;/h6&gt;&lt;pre&gt;&lt;code&gt;alt + command + [
&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="idea" scheme="http://www.gulj.cn/tags/idea/"/>
    
  </entry>
  
  <entry>
    <title>IntelliJ IDEA 必备插件</title>
    <link href="http://www.gulj.cn/2018/05/22/intellij-idea-%E5%BF%85%E5%A4%87%E6%8F%92%E4%BB%B6/"/>
    <id>http://www.gulj.cn/2018/05/22/intellij-idea-必备插件/</id>
    <published>2018-05-22T08:49:44.000Z</published>
    <updated>2019-02-14T07:07:12.866Z</updated>
    
    <content type="html"><![CDATA[<h4 id="插件安装方式"><a href="#插件安装方式" class="headerlink" title="插件安装方式"></a>插件安装方式</h4><ul><li><h5 id="下载插件到本地，从本地安装"><a href="#下载插件到本地，从本地安装" class="headerlink" title="下载插件到本地，从本地安装"></a>下载插件到本地，从本地安装</h5><p>打开 idea -&gt; settings -&gt; plugins -&gt; Install plugin from disk -&gt; 选中本地下载好的插件jar包 -&gt; 重启</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_16-52-44.gif"></p></li></ul><a id="more"></a><ul><li><h5 id="直接在线安装"><a href="#直接在线安装" class="headerlink" title="直接在线安装"></a>直接在线安装</h5><p>打开 idea -&gt; settings -&gt; plugins -&gt; 输入插件名称 -&gt; 安装 -&gt; 重启idea</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_11-40-18.gif"></p></li></ul><h4 id="插件列表"><a href="#插件列表" class="headerlink" title="插件列表"></a>插件列表</h4><ul><li><h5 id="lombok"><a href="#lombok" class="headerlink" title="lombok"></a>lombok</h5><p>地址：<a href="https://plugins.jetbrains.com/plugin/6317-lombok-plugin" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/6317-lombok-plugin</a></p><p>作用：</p><p>​    免去IDE去生成其属性的构造器、getter、setter、equals、hashcode、toString等方法</p><p>截图：</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-22_17-42-54-1.gif"></p></li></ul><ul><li><h5 id="ignore"><a href="#ignore" class="headerlink" title=".ignore"></a>.ignore</h5><p><strong>地址</strong>：<a href="https://plugins.jetbrains.com/plugin/7495--ignore" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/7495--ignore</a></p><p><strong>作用</strong>：</p><p>​    生成各种ignore文件，一键创建git ignore文件模板，通过编辑器直接将文件加入到ignore文件中，免去手动添加操作</p><p><strong>截图</strong>：</p><p> <img src="http://p6nkwri76.bkt.clouddn.com/2018-05-22_18-33-19.gif"></p></li><li><h5 id="FindBugs-IDEA"><a href="#FindBugs-IDEA" class="headerlink" title="FindBugs-IDEA"></a>FindBugs-IDEA</h5><p><strong>地址</strong>：<a href="https://plugins.jetbrains.com/plugin/3847-findbugs-idea" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/3847-findbugs-idea</a></p><p><strong>作用</strong>：</p><p>​    检测代码中可能隐藏的bug以及不规范位置</p><p><strong>截图</strong>：</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_09-12-33.gif"></p></li></ul><ul><li><h5 id="GsonFormat"><a href="#GsonFormat" class="headerlink" title="GsonFormat"></a>GsonFormat</h5><p>地址：<a href="https://plugins.jetbrains.com/plugin/7654-gsonformat" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/7654-gsonformat</a></p><p>作用：</p><p>​    根据json文本，生成对应的java类</p><p>截图：</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_09-30-33.gif"></p></li></ul><ul><li><h5 id="VisualVM-Launcher"><a href="#VisualVM-Launcher" class="headerlink" title="VisualVM Launcher"></a>VisualVM Launcher</h5><p>地址：<a href="https://plugins.jetbrains.com/plugin/7115-visualvm-launcher" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/7115-visualvm-launcher</a></p><p>作用：</p><p>查看java程序jvm的使用情况，例如内存分析，cpu分析，对象占用内存大小，方便jvm调优</p></li></ul><p>  截图：</p><p> <img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_11-07-01.gif"></p><blockquote><p>使用 VisualVM Launcher 不像其它插件一样，直接安装插件就可以使用，它要配合  <a href="https://visualvm.github.io/download.html" target="_blank" rel="noopener">VisualVM</a> 客户端一起使用<br>   首次用 Intellij IDEA 执行VisualVM的时候，需要配置 VisualVM executable 笔者的路径是： <strong>/Applications/VisualVM.app/Contents/Resources/visualvm/bin/visualvm</strong></p></blockquote><p> <img src="http://p6nkwri76.bkt.clouddn.com/15270456447904.jpg" alt=""></p><ul><li><h5 id="GenerateAllSetter"><a href="#GenerateAllSetter" class="headerlink" title="GenerateAllSetter"></a>GenerateAllSetter</h5><p>地址：<a href="https://plugins.jetbrains.com/plugin/9360-generateallsetter" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/9360-generateallsetter</a></p><p>作用：</p><p>​    一键生成对象的所有set方法</p><p>截图：</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_09-41-10.gif"></p></li></ul><ul><li><h5 id="Free-Mybatis-Plugin"><a href="#Free-Mybatis-Plugin" class="headerlink" title="Free Mybatis Plugin"></a>Free Mybatis Plugin</h5><p>地址：<a href="https://plugins.jetbrains.com/plugin/8321-free-mybatis-plugin" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/8321-free-mybatis-plugin</a></p><p>作用：</p><p> 根据定义mapper接口方法，生成对应的mapper.xml文件中的方法，快速在mapper.java文件和mapper.xml文件之间来回切换</p><p>截图：</p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_10-09-14.gif"></p></li></ul><ul><li><h5 id="Background-Image-Plus"><a href="#Background-Image-Plus" class="headerlink" title="Background Image Plus"></a>Background Image Plus</h5><p>地址：<a href="https://plugins.jetbrains.com/plugin/8502-background-image-plus" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/8502-background-image-plus</a></p><p>作用：</p><p>​    为idea编辑器设置图片背景</p><p>截图：  </p><p><img src="http://p6nkwri76.bkt.clouddn.com/2018-05-23_09-54-17.gif"></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;插件安装方式&quot;&gt;&lt;a href=&quot;#插件安装方式&quot; class=&quot;headerlink&quot; title=&quot;插件安装方式&quot;&gt;&lt;/a&gt;插件安装方式&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;h5 id=&quot;下载插件到本地，从本地安装&quot;&gt;&lt;a href=&quot;#下载插件到本地，从本地安装&quot; class=&quot;headerlink&quot; title=&quot;下载插件到本地，从本地安装&quot;&gt;&lt;/a&gt;下载插件到本地，从本地安装&lt;/h5&gt;&lt;p&gt;打开 idea -&amp;gt; settings -&amp;gt; plugins -&amp;gt; Install plugin from disk -&amp;gt; 选中本地下载好的插件jar包 -&amp;gt; 重启&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://p6nkwri76.bkt.clouddn.com/2018-05-23_16-52-44.gif&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="idea" scheme="http://www.gulj.cn/tags/idea/"/>
    
  </entry>
  
  <entry>
    <title>Webpack 学习示例</title>
    <link href="http://www.gulj.cn/2018/04/09/webpack-%E6%95%99%E7%A8%8B/"/>
    <id>http://www.gulj.cn/2018/04/09/webpack-教程/</id>
    <published>2018-04-09T08:13:54.000Z</published>
    <updated>2019-02-14T07:07:13.521Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p><a href="https://doc.webpack-china.org/concepts" target="_blank" rel="noopener">Webpack</a> 是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)。当 Webpack 处理应用程序时，它会递归地构建一个依赖关系图(dependency graph)，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 bundle </p><p>本章节主要介绍Webpack的核心概念的Demo使用示例，建议读者查看之前请阅读Webpack的<a href="https://webpack.js.org/concepts/" target="_blank" rel="noopener">官方文档</a>也可以查看<a href="https://doc.webpack-china.org/concepts" target="_blank" rel="noopener">中文</a>地址文档</p><p><strong>Webpack版本</strong>： 3.9.0</p><p><strong>代码GitHub地址</strong>： <a href="https://github.com/gulijian/webpack-learning-example" target="_blank" rel="noopener">https://github.com/gulijian/webpack-learning-example</a></p><a id="more"></a><h4 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h4><p>Install webpack</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i -g webpack</span><br></pre></td></tr></table></figure><p>Clone the repo.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/gulijian/webpack-learning-example.git</span><br></pre></td></tr></table></figure><p>Install the dependencies</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入每个章节根目录，执行 npm install </span></span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure><p>Open the each chapter  index.html</p><h4 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h4><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter4-1-source" target="_blank" rel="noopener">Style-loader</a></p><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter4-2-source" target="_blank" rel="noopener">Style-loader/url</a></p><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter4-3-source" target="_blank" rel="noopener">Css-loader And Css-Module</a></p><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter5-1-source" target="_blank" rel="noopener">Js Tree-shaking</a></p><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter6-1-source" target="_blank" rel="noopener">Url-loader</a></p><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter7-1-source" target="_blank" rel="noopener">ProvidePlugin</a></p><p><a href="https://github.com/gulijian/webpack-learning-example/blob/master/README.md#chapter8-1-source" target="_blank" rel="noopener">Clean-webpack-plugin</a></p><h3 id="chapter4-1-source"><a href="#chapter4-1-source" class="headerlink" title="chapter4-1 (source)"></a>chapter4-1 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter4-1" target="_blank" rel="noopener">source</a>)</h3><p>style-loader use</p><blockquote><p>处理css，以 style 标签形式引入css</p></blockquote><h5 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./css/app.css'</span></span><br></pre></td></tr></table></figure><h5 id="app-css"><a href="#app-css" class="headerlink" title="app.css"></a>app.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#00bcd4b5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'style-loader'</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="chapter4-2-source"><a href="#chapter4-2-source" class="headerlink" title="chapter4-2 (source)"></a>chapter4-2 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter4-2" target="_blank" rel="noopener">source</a>)</h3><p>style-loader/url use</p><blockquote><p>处理css，以<link>标签形式引入css</p></blockquote><h5 id="app-js-1"><a href="#app-js-1" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./css/app.css'</span></span><br></pre></td></tr></table></figure><h5 id="app-css-1"><a href="#app-css-1" class="headerlink" title="app.css"></a>app.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#00bcd4b5</span>;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#styleLoaderUrl</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="index-html-1"><a href="#index-html-1" class="headerlink" title="index.html"></a>index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"styleLoaderUrl"</span>&gt;</span> hello style-loader/url<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpak-config-js"><a href="#webpak-config-js" class="headerlink" title="webpak.config.js"></a>webpak.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        publicPath: <span class="string">'./dist/'</span>,</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'style-loader/url'</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'file-loader'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="chapter4-3-source"><a href="#chapter4-3-source" class="headerlink" title="chapter4-3 (source)"></a>chapter4-3 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter4-3" target="_blank" rel="noopener">source</a>)</h3><p>css-loader and css-module use</p><blockquote><p>处理css，支持 css-module 形式</p></blockquote><h5 id="app-js-2"><a href="#app-js-2" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> app1 <span class="keyword">from</span> <span class="string">'./css/app1.css'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> app2 <span class="keyword">from</span>  <span class="string">'./css/app2.css'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用样式</span></span><br><span class="line">app.innerHTML = <span class="string">'&lt;div class = "'</span>+app1.box+<span class="string">'"&gt;&lt;/div&gt;'</span></span><br></pre></td></tr></table></figure><h5 id="app1-css"><a href="#app1-css" class="headerlink" title="app1.css"></a>app1.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">composes</span>: borderBox from <span class="string">'./app2.css'</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#76d4e0ab</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="app2-css"><a href="#app2-css" class="headerlink" title="app2.css"></a>app2.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.borderBox</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">4px</span> solid <span class="number">#e87ff5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="index-html-2"><a href="#index-html-2" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js-1"><a href="#webpack-config-js-1" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'style-loader'</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            minimize: <span class="literal">true</span>,  <span class="comment">// 启用压缩</span></span><br><span class="line">                            modules: <span class="literal">true</span>    <span class="comment">// 启用 css module</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="chapter5-1-source"><a href="#chapter5-1-source" class="headerlink" title="chapter5-1 (source)"></a>chapter5-1 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter5-1" target="_blank" rel="noopener">source</a>)</h3><p>UglifyJsPlugin  use</p><blockquote><p>使用 <strong>UglifyJsPlugin</strong> 插件； 不打包没有使用的 js</p></blockquote><h5 id="util-js"><a href="#util-js" class="headerlink" title="util.js"></a>util.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">a</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'this is a'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">b</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'this is b'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">c</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'this is c'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="app-js-3"><a href="#app-js-3" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; a &#125; <span class="keyword">from</span> <span class="string">'./common/util.js'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a())</span><br></pre></td></tr></table></figure><h5 id="index-html-3"><a href="#index-html-3" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js-2"><a href="#webpack-config-js-2" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span>,</span><br><span class="line">        </span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>app.js 中只使用了 util.js 中的 a 函数 打包的时候只会打包 a 函数；因为 b 和  c 函数没有使用到，则不会被打包</p></blockquote><h3 id="chapter6-1-source"><a href="#chapter6-1-source" class="headerlink" title="chapter6-1 (source)"></a>chapter6-1 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter6-1" target="_blank" rel="noopener">source</a>)</h3><p>url-loader use</p><blockquote><p>图片文件处理</p></blockquote><h5 id="app-js-4"><a href="#app-js-4" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img1 = <span class="built_in">document</span>.getElementById(<span class="string">'img1'</span>)</span><br><span class="line"><span class="keyword">var</span> img2 = <span class="built_in">document</span>.getElementById(<span class="string">'img2'</span>)</span><br><span class="line"></span><br><span class="line">img1.src = <span class="built_in">require</span>(<span class="string">'./assets/img1.jpg'</span>)</span><br><span class="line">img2.src = <span class="built_in">require</span>(<span class="string">'./assets/img2.png'</span>)</span><br></pre></td></tr></table></figure><h5 id="index-html-4"><a href="#index-html-4" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- size &lt; 30kb --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"img1"</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- size &gt; 30kb --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"img2"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js-3"><a href="#webpack-config-js-3" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line"></span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(png|jpg|jpeg|gif)$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader:<span class="string">'url-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            limit: <span class="number">30000</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>图片 小于 30kb 会变成base64编码，大于 30kb 会生成图片地址</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"img1"</span> <span class="attr">src</span>=<span class="string">"6443347e97d394b23b05746b2fe41cd1.jpg"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"img2"</span> <span class="attr">src</span>=<span class="string">"data:image/png;base64,iVBORw0KGgoAXBIWXMAAC4jAAAuIwF4pT92AAAKTWlD"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="chapter7-1-source"><a href="#chapter7-1-source" class="headerlink" title="chapter7-1 (source)"></a>chapter7-1 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter7-1" target="_blank" rel="noopener">source</a>)</h3><p>ProvidePlugin use</p><blockquote><p>处理第三方 JS 库，方式一：（ jquery 作为npm的一个module）</p></blockquote><h5 id="app-js-5"><a href="#app-js-5" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#app'</span>).append(<span class="string">'hello jquery'</span>)</span><br></pre></td></tr></table></figure><h5 id="index-html-5"><a href="#index-html-5" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js-4"><a href="#webpack-config-js-4" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">            $: <span class="string">'jquery'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="chapter7-2-source"><a href="#chapter7-2-source" class="headerlink" title="chapter7-2 (source)"></a>chapter7-2 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter7-2" target="_blank" rel="noopener">source</a>)</h3><blockquote><p>处理第三方 JS 库，方式二：（引入本地的 jquery 库）</p></blockquote><h5 id="app-js-6"><a href="#app-js-6" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#app'</span>).append(<span class="string">'hello jquery'</span>)</span><br></pre></td></tr></table></figure><h5 id="index-html-6"><a href="#index-html-6" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js-5"><a href="#webpack-config-js-5" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注意 jquery$ 的名字 要和 ProvidePlugin 插件中配置的名称（jquery）保持一致</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            jquery$: path.resolve(__dirname,<span class="string">'src/libs/jquery.min.js'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">            $: <span class="string">'jquery'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>如果 jquery 在CDN上，直接引入即可</p></blockquote><h3 id="chapter8-1-source"><a href="#chapter8-1-source" class="headerlink" title="chapter8-1 (source)"></a>chapter8-1 (<a href="https://github.com/gulijian/webpack-learning-example/tree/master/chapter8-1" target="_blank" rel="noopener">source</a>)</h3><p>clean-webpack-plugin use</p><blockquote><p>每次打包清除原先的打包目录</p></blockquote><h5 id="app-js-7"><a href="#app-js-7" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>)</span><br><span class="line"></span><br><span class="line">app.innerHTML = <span class="string">'&lt;h1&gt;使用 clean-webpack-plugin 插件，可以每次打包清除原先的打包目录&lt;/h1&gt;'</span></span><br></pre></td></tr></table></figure><h5 id="index-html-7"><a href="#index-html-7" class="headerlink" title="index.html"></a>index.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="webpack-config-js-6"><a href="#webpack-config-js-6" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        <span class="string">'app'</span>: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'./dist/'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    plugins: [</span><br><span class="line">       <span class="keyword">new</span> CleanWebpackPlugin([</span><br><span class="line">           <span class="string">'dist'</span></span><br><span class="line">       ])</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;&lt;a href=&quot;https://doc.webpack-china.org/concepts&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Webpack&lt;/a&gt; 是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)。当 Webpack 处理应用程序时，它会递归地构建一个依赖关系图(dependency graph)，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 bundle &lt;/p&gt;
&lt;p&gt;本章节主要介绍Webpack的核心概念的Demo使用示例，建议读者查看之前请阅读Webpack的&lt;a href=&quot;https://webpack.js.org/concepts/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;官方文档&lt;/a&gt;也可以查看&lt;a href=&quot;https://doc.webpack-china.org/concepts&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;中文&lt;/a&gt;地址文档&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Webpack版本&lt;/strong&gt;： 3.9.0&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;代码GitHub地址&lt;/strong&gt;： &lt;a href=&quot;https://github.com/gulijian/webpack-learning-example&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/gulijian/webpack-learning-example&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://www.gulj.cn/categories/Java/"/>
    
    
      <category term="webpack" scheme="http://www.gulj.cn/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker Linux网络命名空间</title>
    <link href="http://www.gulj.cn/2018/03/31/docker-linux%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/"/>
    <id>http://www.gulj.cn/2018/03/31/docker-linux命名空间/</id>
    <published>2018-03-31T02:44:25.000Z</published>
    <updated>2019-02-14T07:07:12.863Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>到现在我们已经了解到Docker的镜像、容器等概念，我们可以在一台宿主机上运行一个或者多个容器，也可以将不同的容器运行在不同的宿主机上，那么这些容器是怎样进行互相通信呢？本文将介绍Linux网络命名空间概念，来帮助读者更好地了解到Docker容器之间的通信。</p><h4 id="容器之间的通信-同一台宿主机上"><a href="#容器之间的通信-同一台宿主机上" class="headerlink" title="容器之间的通信(同一台宿主机上)"></a>容器之间的通信(同一台宿主机上)</h4><p>默认情况下，在同一台宿主机上的多个容器是可以互相访问的，容器的网络命名空间和宿主机的网络命名空间是相互独立隔离的</p><p>查看宿主机的网络命名空间</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 52:54:00:ad:3b:43 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 85639sec preferred_lft 85639sec</span><br><span class="line">    inet6 fe80::5054:ff:fead:3b43/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 08:00:27:7e:86:8c brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.215.20/24 brd 192.168.215.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::a00:27ff:fe7e:868c/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN</span><br><span class="line">    link/ether 02:42:79:71:de:73 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><p>新建两个容器放入后台运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name demo1 busybox /bin/sh -c <span class="string">"while true;do sleep 3600;done"</span></span><br><span class="line"></span><br><span class="line">$ docker run -d --name demo2 busybox /bin/sh -c <span class="string">"while true;do sleep 3600;done"</span></span><br></pre></td></tr></table></figure><p>查看两个容器的网络命名空间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> demo1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">5: eth0@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue</span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">$ docker <span class="built_in">exec</span> demo2 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: eth0@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue</span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><p>这里可以看到宿主机、demo1和demo2的网络命名空间都是独立的，测试容器demo1和容器demo2是否可以互通</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 demo1 内 ping demo2容器的ip地址</span></span><br><span class="line">$ docker <span class="built_in">exec</span> test1 ping 172.17.0.3</span><br><span class="line">PING 172.17.0.3 (172.17.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.3: seq=0 ttl=64 time=0.086 ms</span><br><span class="line">64 bytes from 172.17.0.3: seq=1 ttl=64 time=0.104 ms</span><br><span class="line">64 bytes from 172.17.0.3: seq=2 ttl=64 time=0.081 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 demo2 内 ping demo1容器的ip地址</span></span><br><span class="line">$ docker <span class="built_in">exec</span> test2  ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.2: seq=0 ttl=64 time=0.079 ms</span><br><span class="line">64 bytes from 172.17.0.2: seq=1 ttl=64 time=0.102 ms</span><br><span class="line">64 bytes from 172.17.0.2: seq=2 ttl=64 time=0.101 ms</span><br></pre></td></tr></table></figure><p>从上面看出容器demo1和容器demok2可以互相访问</p><p>为了更好地了解到在同一宿主机上容器间的通信，下面我们从Linux网络命名空间来为大家解释</p><p>在这之前我们先把我们刚才运行的demo1和demo2两个容器停止掉</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker stop demo1 demo2</span><br></pre></td></tr></table></figure><h5 id="Linux-的网络命名空间-namespace"><a href="#Linux-的网络命名空间-namespace" class="headerlink" title="Linux 的网络命名空间(namespace)"></a>Linux 的网络命名空间(namespace)</h5><p>下面我们将在宿主机上创建两个网络命名空间分别为test1和test2，然后再创建一对<br><strong>Veth 接口</strong>，分别分配给test1和test2，这样test1和test2就能够连接起来，能够互相访问</p><p><img src="http://p6nkwri76.bkt.clouddn.com/15224774725025.jpg" alt=""></p><h5 id="创建网络命名空间"><a href="#创建网络命名空间" class="headerlink" title="创建网络命名空间"></a>创建网络命名空间</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip netns add test1</span><br><span class="line"></span><br><span class="line">$ sudo ip netns add test2</span><br></pre></td></tr></table></figure><h5 id="查看网络命名空间"><a href="#查看网络命名空间" class="headerlink" title="查看网络命名空间"></a>查看网络命名空间</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip netns list</span><br><span class="line">test2</span><br><span class="line">test1</span><br></pre></td></tr></table></figure><p>在docker容器中，我们可以查看容器的网络命名空间，同理我们也可以查看我们创建的网络命名空间详细信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip netns <span class="built_in">exec</span> test1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    </span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test2 ip a </span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br></pre></td></tr></table></figure><p>现在可以看到我们创建的两个命名空间test1和tes2只有本地的回环端口，也没有本地 ip 127.0.0.1 之类并且状态是DOWN的状态</p><p>查看本地的 ip link</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip link </span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:00:ad:3b:43 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 08:00:27:7e:86:8c brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT</span><br><span class="line">    link/ether 02:42:79:71:de:73 brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure><p>现在本地只有四个 <strong>ip link</strong> 下面在宿主机上添加一对 <strong>link</strong> (<strong>vethl-test1 和 veth-test2</strong>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip link add veth-test1 <span class="built_in">type</span> veth peer name veth-test2</span><br></pre></td></tr></table></figure><p>接下来我们再次查看本地的 <strong>ip link</strong> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip link </span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:00:ad:3b:43 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 08:00:27:7e:86:8c brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT</span><br><span class="line">    link/ether 02:42:79:71:de:73 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">9: veth-test2@veth-test1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 9e:44:34:0b:41:39 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">10: veth-test1@veth-test2: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 5a:ed:e6:53:00:fb brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure><p>序号：9.（veth-test2@veth-test1），10.（veth-test1@veth-test2）就是我们刚添加的一对 link</p><p>将 veth-test1 这个接口添加到网络命名空间test1上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip link <span class="built_in">set</span> veth-test1 netns test1</span><br></pre></td></tr></table></figure><p>这时候我们会发现本地的 ip link 序号：10 消失了，而我们创建的test1网络命名空间多了 veth-test1,我们来查看test1的 ip link</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip netns <span class="built_in">exec</span> test1 ip link </span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">10: veth-test1@if9: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 5a:ed:e6:53:00:fb brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br></pre></td></tr></table></figure><p>同理将 veth-test2 这个接口添加到网络命名空间test2上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip link <span class="built_in">set</span> veth-test2 netns test2</span><br></pre></td></tr></table></figure><p>现在我们把创建的veth-test1和veth-test2分别添加到了网络命名空间test1和test2上(<strong>此时他们都没有ip地址，状态也是DOWN的状态</strong>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test1</span></span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test1 ip link </span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">10: veth-test1@if9: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 5a:ed:e6:53:00:fb brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># test2</span></span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">9: veth-test2@if10: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 9e:44:34:0b:41:39 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br></pre></td></tr></table></figure><p>分别为两个接口 <strong>veth-test1</strong> 和 <strong>veth-test2</strong> 分配ip地址,然后让其状态由<strong>DOWN</strong>变为<strong>UP</strong> (同时也可以把各自的回环端口 lo 状态也设置为 UP，不然到时候ping自己的时候ping不通)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为veth-test1和veth-test2分配IP地址</span></span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test1 ip addr add 192.168.1.1/24 dev veth-test1</span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test2 ip addr add 192.168.1.2/24 dev veth-test2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置veth-test1和veth-test2的状态由DOWN变为UP</span></span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test1 ip link <span class="built_in">set</span> dev veth-test1 up</span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test2 ip link <span class="built_in">set</span> dev veth-test2 up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置test1和test2的本地回环端口状态由DOWN变为UP</span></span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test1 ip link <span class="built_in">set</span> dev lo  up</span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test2 ip link <span class="built_in">set</span> dev lo  up</span><br></pre></td></tr></table></figure><p>现在我们可以看到我们创建的test1和test2这两个网络命名空间上的veth-test1和veth-test2接口分配的IP地址，并且状态为UP </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># test1</span><br><span class="line">$ sudo ip netns exec test1 ip  a</span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">10: veth-test1@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP qlen 1000</span><br><span class="line">    link/ether 5a:ed:e6:53:00:fb brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet 192.168.1.1/24 scope global veth-test1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::58ed:e6ff:fe53:fb/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">  </span><br><span class="line"># test2     </span><br><span class="line">$ sudo ip netns exec test2  ip  a</span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">9: veth-test2@if10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP qlen 1000</span><br><span class="line">    link/ether 9e:44:34:0b:41:39 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 192.168.1.2/24 scope global veth-test2</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::9c44:34ff:fe0b:4139/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><p>到此我们已经成功地完成了通过我们自己创建的test1和test2这两个网络命名空间，他们之间可以通过veth-test1和veth-test2互相访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test1 上 ping test2的ip</span></span><br><span class="line">sudo ip netns <span class="built_in">exec</span> test1  ping 192.168.1.2</span><br><span class="line">PING 192.168.1.2 (192.168.1.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.2: icmp_seq=1 ttl=64 time=0.048 ms</span><br><span class="line">64 bytes from 192.168.1.2: icmp_seq=2 ttl=64 time=0.059 ms</span><br><span class="line">64 bytes from 192.168.1.2: icmp_seq=3 ttl=64 time=0.067 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># test2 上 ping test1的ip</span></span><br><span class="line">$ sudo ip netns <span class="built_in">exec</span> test2  ping 192.168.1.1</span><br><span class="line">PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=1 ttl=64 time=0.048 ms</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=2 ttl=64 time=0.052 ms</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=3 ttl=64 time=0.079 ms</span><br></pre></td></tr></table></figure><blockquote><p>在同一台宿主机上的docker多容器他们分别有各自的网络命名空间，他们之间的通信原理，和我们自己创建的test1和test2这两个网络命名空间他们之间的通信原理类似</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;到现在我们已经了解到Docker的镜像、容器等概念，我们可以在一台宿主机上运行一个或者多个容器，也可以将不同的容器运行在不同的宿主机上，那么这些容器是怎样进行互相通信呢？本文将介绍Linux网络命名空间概念，来帮助读者更好地了解到Docker容器之间的通信。&lt;/p&gt;
&lt;h4 id=&quot;容器之间的通信-同一台宿主机上&quot;&gt;&lt;a href=&quot;#容器之间的通信-同一台宿主机上&quot; class=&quot;headerlink&quot; title=&quot;容器之间的通信(同一台宿主机上)&quot;&gt;&lt;/a&gt;容器之间的通信(同一台宿主机上)&lt;/h4&gt;&lt;p&gt;默认情况下，在同一台宿主机上的多个容器是可以互相访问的，容器的网络命名空间和宿主机的网络命名空间是相互独立隔离的&lt;/p&gt;
&lt;p&gt;查看宿主机的网络命名空间&lt;/p&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 数据持久化</title>
    <link href="http://www.gulj.cn/2018/03/30/docker-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    <id>http://www.gulj.cn/2018/03/30/docker-数据持久化/</id>
    <published>2018-03-30T03:47:38.000Z</published>
    <updated>2019-02-14T07:07:12.864Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>Docker 容器一旦删除，那么我们在容器内的一切操作将不复存在，比如我们在容器内存储的数据等；为了解决这个问题，Docker 提出了数据卷概念，就像我们运行一个mysql容器，我们需要存储我们的数据，日志之类，想要他们不会随着容器的删除而销毁，或者我们需要在各个容器间共享数据，那么这些<strong>数据卷</strong>或者<strong>数据卷容器</strong>都能做到。</p><p>数据卷是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多有用的特性：</p><ul><li>数据卷可以在容器之间共享和重用</li><li>对数据卷的修改会立马生效</li><li>对数据卷的更新，不会影响镜像</li><li>数据卷默认会一直存在，即使容器被删除</li><li>数据卷的生命周期一直持续到没有容器使用它为止</li></ul><blockquote><p>数据卷的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定为挂载点的目录中的文件会隐藏掉，能显示看的是挂载的数据卷</p></blockquote><a id="more"></a><p><strong>Docker提供了两种方式管理数据</strong></p><ul><li>数据卷</li><li>数据卷容器</li></ul><h4 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h4><h5 id="添加数据卷"><a href="#添加数据卷" class="headerlink" title="添加数据卷"></a>添加数据卷</h5><p>在 <strong>docker run</strong> 命令中 使用 <strong>-v</strong> 标识给容器内添加一个或者多个数据卷</p><p>在容器内创建一个新的数据卷 /data/shop</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name my-shop-web -v /data/shop sqgulj/shop-web</span><br></pre></td></tr></table></figure><p>这种方式我们也可以在Dockerfile中使用<strong>VOLUME</strong>指令来给创建的容器添加一个或者多个数据卷，比如官方的 mysql 的 <a href="https://github.com/docker-library/mysql/blob/ad625c64a06e16683e997e5a0147508d115f4989/5.7/Dockerfile" target="_blank" rel="noopener">Dockerfile</a> 中用 <strong>VOLUME</strong> 指定了数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.........</span><br><span class="line"></span><br><span class="line">RUN &#123;</span><br><span class="line">    apt-get update &amp;&amp; apt-get install -y mysql-server=<span class="string">"<span class="variable">$&#123;MYSQL_VERSION&#125;</span>"</span> &amp;&amp; rm -rf /var/lib/apt/lists/* \</span><br><span class="line">&amp;&amp; rm -rf /var/lib/mysql &amp;&amp; mkdir -p /var/lib/mysql /var/run/mysqld \</span><br><span class="line">&amp;&amp; chown -R mysql:mysql /var/lib/mysql /var/run/mysqld \</span><br><span class="line"><span class="comment"># ensure that /var/run/mysqld (used for socket and lock files) is writable regardless of the UID our mysqld instance ends up having at runtime</span></span><br><span class="line">&amp;&amp; chmod 777 /var/run/mysqld \</span><br><span class="line"><span class="comment"># comment out a few problematic configuration values</span></span><br><span class="line">&amp;&amp; find /etc/mysql/ -name <span class="string">'*.cnf'</span> -print0 \</span><br><span class="line">| xargs -0 grep -lZE <span class="string">'^(bind-address|log)'</span> \</span><br><span class="line">| xargs -rt -0 sed -Ei <span class="string">'s/^(bind-address|log)/#&amp;/'</span> \</span><br><span class="line"><span class="comment"># don't reverse lookup hostnames, they are usually another container</span></span><br><span class="line">&amp;&amp; <span class="built_in">echo</span> <span class="string">'[mysqld]\nskip-host-cache\nskip-name-resolve'</span> &gt; /etc/mysql/conf.d/docker.cnf</span><br><span class="line"></span><br><span class="line">VOLUME /var/lib/mysql</span><br><span class="line"></span><br><span class="line">COPY docker-entrypoint.sh /usr/<span class="built_in">local</span>/bin/</span><br><span class="line">RUN ln -s usr/<span class="built_in">local</span>/bin/docker-entrypoint.sh /entrypoint.sh <span class="comment"># backwards compat</span></span><br><span class="line">ENTRYPOINT [<span class="string">"docker-entrypoint.sh"</span>]</span><br><span class="line">............</span><br></pre></td></tr></table></figure><p>其中 <strong>VOLUME /var/lib/mysql</strong>  指定了mysql的数据卷</p><h5 id="将宿主机的一个目录，挂在到容器里"><a href="#将宿主机的一个目录，挂在到容器里" class="headerlink" title="将宿主机的一个目录，挂在到容器里"></a>将宿主机的一个目录，挂在到容器里</h5><p>使用 <strong>-v</strong>，除了可以创建一个数据卷，还可以挂载本地主机目录到容器中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name my-shop-web -v /<span class="built_in">local</span>/data/shop:/data/shop sqgulj/shop-web</span><br></pre></td></tr></table></figure><p>这将会把本地目录/local/data/shop挂载到容器的/data/shop目录，宿主机上的目录必须是绝对路径，如果目录不存在docker会自动创建它。</p><blockquote><p>出于可移植和分享的考虑，在Dockerfile中这种方式不支持</p></blockquote><p>docker默认情况下是对数据卷有读写权限，但是我们通过这样的方式让数据卷只读：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name my-shop-web -v /<span class="built_in">local</span>/data/shop:/data/shop:ro sqgulj/shop-web</span><br></pre></td></tr></table></figure><p>这里我们同样挂载了/local/data/shop目录，只是添加了 <strong>ro</strong> 选项来限制它只读。</p><h5 id="将宿主机上单个文件挂载到容器中"><a href="#将宿主机上单个文件挂载到容器中" class="headerlink" title="将宿主机上单个文件挂载到容器中"></a>将宿主机上单个文件挂载到容器中</h5><p>除了能挂载目录外，<strong>-v</strong> 标识还可以将宿主机的一个特定文件挂载为数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run --rm -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash</span><br></pre></td></tr></table></figure><p>这样就可以记录在容器输入过的命令了</p><blockquote><p>如果直接挂载一个文件，很多文件编辑工具，包括 vi 或者 sed –in-place，可能会造成文件 inode 的改变，从 Docker 1.1.0起，这会导致报错误信息。所以最简单的办法就直接挂载文件的父目录。</p></blockquote><h5 id="查看数据卷"><a href="#查看数据卷" class="headerlink" title="查看数据卷"></a>查看数据卷</h5><ul><li>使用命令 <strong>docker volume</strong> 可以查看我们生成的数据卷</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume ls </span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>               b202765855d3b77e574284fde0079d31fb0258997a7b72eb6f7c8299053f216b</span><br></pre></td></tr></table></figure><p>我们可以看到我们添加的数据卷 /data/shop ，当我们查看的时候并不是我们提供的名称，而是生成一系列的随机串，当我们为多个容器添加数据卷的时候，它也会为其生成一系列的随机串，这样不利于我们辨识哪些数据卷挂在哪个容器中，为了解决这个问题，我们可以在添加数据数据卷的时候，为数据卷起个辨识的名称，比如</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name my-shop-web -v shopwebdata:/data/shop sqgulj/shop-web</span><br></pre></td></tr></table></figure><p>我们发现，这次我们为容器添加一个数据的时候我们在前面加了一个 <strong>shopwebdata</strong> ，注意<strong>shopwebdata</strong>前面没有<strong>斜杠( / )</strong>，如果有斜杠那是把本地的一个目录挂载到容器内的一个目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume ls </span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>               shopwebdata</span><br></pre></td></tr></table></figure><p>这次我们就能看到我们添加的数据卷就是我们起的名称，而不是一些列的随机串</p><ul><li>使用命令 <strong>docker inspect</strong> 查看数据卷</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># my-shop-web 为容器的名称</span></span><br><span class="line">$ docker inspect my-shop-web</span><br><span class="line">............</span><br><span class="line"></span><br><span class="line"><span class="string">"Mounts"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"volume"</span>,</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"b202765855d3b77e574284fde0079d31fb0258997a7b72eb6f7c8299053f216b"</span>,</span><br><span class="line">                <span class="string">"Source"</span>: <span class="string">"/var/lib/docker/volumes/b202765855d3b77e574284fde0079d31fb0258997a7b72eb6f7c8299053f216b/_data"</span>,</span><br><span class="line">                <span class="string">"Destination"</span>: <span class="string">"/data/shop"</span>,</span><br><span class="line">                <span class="string">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">                <span class="string">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">                <span class="string">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        </span><br><span class="line">.............</span><br></pre></td></tr></table></figure><p>这里只列出了其中的 Mounts 属性，从中可以看到Source字段显示了数据卷存放的位置</p><h5 id="删除数据卷"><a href="#删除数据卷" class="headerlink" title="删除数据卷"></a>删除数据卷</h5><p>数据卷是被设计来持久化数据的，因此，删除容器并不会删除数据卷。如果想要在删除容器时同时删除数据卷，可使用如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm -v 容器ID</span><br></pre></td></tr></table></figure><p>这样既可在<strong>删除容器</strong>的同时也将<strong>数据卷删除</strong>。</p><p>我们还可以使用 <strong>docker volume rm</strong> 命令删除数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看数据卷</span></span><br><span class="line">$ docker volume ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定数据卷名称删除</span></span><br><span class="line">$ docker volume rm volume_name volume_name</span><br></pre></td></tr></table></figure><p>删除所有的数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume rm $(docker volume ls -f dangling=<span class="literal">true</span> -q)</span><br></pre></td></tr></table></figure><h4 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h4><p>如果有些数据，需要在多个容器之间进行共享，这时候可以使用数据卷容器<br>创建数据卷容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql-volume -v /data mysql</span><br></pre></td></tr></table></figure><p>其它容器可以使用–volumes-from标识，来使用通过刚刚创建的数据卷容器，来挂载对应的数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --volumes-from mysql-volume --name db1 mysql</span><br><span class="line"></span><br><span class="line">$ docker run -d --volumes-from mysql-volume --name db2 mysql</span><br></pre></td></tr></table></figure><p>这样 db1 和 db2 两个容器都共享 mysql-volume 这个容器中的文件</p><p>挂载相同数据卷的容器，容器的停止和删除，不会对数据卷产生影响</p><p>我们也还可以对一个容器使用多个 –volumes-from 标识，来将多个数据卷桥接到这个容器中</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;Docker 容器一旦删除，那么我们在容器内的一切操作将不复存在，比如我们在容器内存储的数据等；为了解决这个问题，Docker 提出了数据卷概念，就像我们运行一个mysql容器，我们需要存储我们的数据，日志之类，想要他们不会随着容器的删除而销毁，或者我们需要在各个容器间共享数据，那么这些&lt;strong&gt;数据卷&lt;/strong&gt;或者&lt;strong&gt;数据卷容器&lt;/strong&gt;都能做到。&lt;/p&gt;
&lt;p&gt;数据卷是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多有用的特性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;数据卷可以在容器之间共享和重用&lt;/li&gt;
&lt;li&gt;对数据卷的修改会立马生效&lt;/li&gt;
&lt;li&gt;对数据卷的更新，不会影响镜像&lt;/li&gt;
&lt;li&gt;数据卷默认会一直存在，即使容器被删除&lt;/li&gt;
&lt;li&gt;数据卷的生命周期一直持续到没有容器使用它为止&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;数据卷的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定为挂载点的目录中的文件会隐藏掉，能显示看的是挂载的数据卷&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 容器</title>
    <link href="http://www.gulj.cn/2018/03/29/docker-%E5%AE%B9%E5%99%A8/"/>
    <id>http://www.gulj.cn/2018/03/29/docker-容器/</id>
    <published>2018-03-29T06:17:03.000Z</published>
    <updated>2019-02-14T07:07:12.864Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>Docker 容器是用于运行镜像的沙箱环境，它是 Docker 镜像的运行实例；容器都是相互隔离、互不可见的，我们可以理解为：镜像是Docker生命周期的打包和构建阶段，而容器是Docker的启动和执行阶段。</p><p>容器是从镜像创建的应用运行实例，可以将其启动、开始、停止、删除，而这些容器都是相互隔离、互不可见的。</p><p>镜像使用的是分层存储，容器也是如此。每一个容器运行时，是以镜像为基础层，在其上创建一个当前容器的存储层，容器存储层的生存周期和容器一样，容器消亡时，容器存储层也随之消亡。因此，任何保存于容器存储层的信息都会随容器删除而丢失。</p><p>数据卷的生存周期独立于容器，容器消亡，数据卷不会消亡。因此，使用数据卷后，容器删除或者重新运行之后，数据却不会丢失。</p><a id="more"></a><h4 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h4><p>使用 <strong>docker run</strong> 命令来运行一个容器<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run [OPTIONS] IMAGE [COMMAND] [ARG...] [flags]</span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><p>由于 <strong>docker run</strong> 命令 OPTIONS 比较多，这里只选择大家常用的几个选项来说明</p><pre><code>-i, --interactive=false       打开STDIN，用于控制台交互-t, --tty                     分配一个伪终端（pseudo-tty）并绑定到容器的标准输入上-d, --detach=false            指定容器运行于前台还是后台，默认为false-p, --publish list            指定主机的端口和容器端口的映射-P, --publish-all             使用容器内随机一个网络端口映射到我们使用的主机上-v, --volume list             给容器挂载存储卷，挂载到容器的某个目录-m, --memory                  指定容器的内存上限--link list                   指定容器间的关联，使用其他容器的IP、env等信息-e, --env list                设置环境变量--restart string              指定容器的重启策略  </code></pre><p>示例：</p><p>后台运行一个nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --name mynginx -p 8088:80 -v <span class="variable">$PWD</span>/nginx/www:/www -v <span class="variable">$PWD</span>/nginx/logs:/wwwlogs -d  nginx</span><br></pre></td></tr></table></figure><h4 id="查看运行的容器"><a href="#查看运行的容器" class="headerlink" title="查看运行的容器"></a>查看运行的容器</h4><ul><li>查看正在运行的容器</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED                  STATUS              PORTS                  NAMES</span><br><span class="line">76ea0a1383d4        nginx               &quot;nginx -g &apos;daemon of…&quot;   Less than a second ago   Up 3 seconds        0.0.0.0:8088-&gt;80/tcp   mynginx</span><br></pre></td></tr></table></figure><ul><li>查看所有容器（包含正在运行和退出的容器）</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">76ea0a1383d4        nginx               <span class="string">"nginx -g 'daemon of…"</span>   3 minutes ago       Exited (0) 2 seconds ago                       mynginx</span><br></pre></td></tr></table></figure><ul><li>查看容器的详细信息</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dokcer inspect mygnix</span><br></pre></td></tr></table></figure><h4 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h4><p>使用 <strong>docker exec</strong> 命令进入容器<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> [OPTIONS] CONTAINER COMMAND [ARG...]</span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><pre><code>-d, --detach          分离模式: 在后台运行-i, --interactive     即使没有附加也保持STDIN 打开-t, --tty             分配一个伪终端-e, --env list        设置环境变量</code></pre><p>示例：</p><p>以交互模式进入容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it mynginx /bin/bash</span><br><span class="line">root@76ea0a1383d4:/<span class="comment">#</span></span><br></pre></td></tr></table></figure><h4 id="停止和重启容器"><a href="#停止和重启容器" class="headerlink" title="停止和重启容器"></a>停止和重启容器</h4><p>如果是交互式运行的一个容器，可以通过exit命令和Ctrl+d来退出终端，这样容器会立刻终止</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exit 直接退出，容器终止；或者快捷键Ctrl+d </span></span><br><span class="line">$ docer run -it centos /bin/bash</span><br><span class="line">[root@f7b52eb5ab02 /]<span class="comment"># exit</span></span><br></pre></td></tr></table></figure><p>使用 <strong>docker stop</strong> 命令来停止正在运行的容器<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop [OPTIONS] CONTAINER [CONTAINER...]</span><br></pre></td></tr></table></figure><p>示例：</p><p>指定容器名称停止正在运行的多个容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop mynginx myredis</span><br></pre></td></tr></table></figure><p>重新启动容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动终止的容器</span></span><br><span class="line">$ docker start mynginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将一个运行态的容器终止，然后再重新启动它</span></span><br><span class="line">$ docker restart myredis</span><br></pre></td></tr></table></figure><h4 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h4><p>使用 <strong>docker rm</strong> 命令删除一个或多个容器<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm [OPTIONS] CONTAINER [CONTAINER...]</span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><pre><code>-f, --force     强制删除-l, --link      移除容器间的网络连接，而非容器本身-v, --volumes   删除与容器关联的卷</code></pre><p>示例：</p><p>强制删除容器mynginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm -f mynginx</span><br></pre></td></tr></table></figure><p>删除mygninx，并删除容器挂载的数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm -v  mynginx</span><br></pre></td></tr></table></figure><p>强制删除所有的容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm -f $(docker ps -aq)</span><br></pre></td></tr></table></figure><blockquote><p>删除容器使用 <strong>docker rm</strong> 命令 而 删除容器使用 <strong>docker rmi</strong> 命令，注意两者区别</p></blockquote><h4 id="导出容器"><a href="#导出容器" class="headerlink" title="导出容器"></a>导出容器</h4><p>使用命令 docker export 导出本地某个容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看容器列表</span></span><br><span class="line">$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                    PORTS                  NAMES</span><br><span class="line">f7b52eb5ab02        centos              <span class="string">"/bin/bash"</span>              18 hours ago        Exited (0) 18 hours ago                          heuristic_edison</span><br><span class="line">06a6eb00f8bc        centos              <span class="string">"/bin/bash"</span>              18 hours ago        Up 18 hours                                      stupefied_euler</span><br><span class="line">76ea0a1383d4        nginx               <span class="string">"nginx -g 'daemon of…"</span>   19 hours ago        Up 19 hours               0.0.0.0:8088-&gt;80/tcp   mynginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出容器快照,到本地文件</span></span><br><span class="line">$ docker  <span class="built_in">export</span> 76ea0a1383d4 &gt; mynginx.tar.gz</span><br></pre></td></tr></table></figure><h4 id="导入容器"><a href="#导入容器" class="headerlink" title="导入容器"></a>导入容器</h4><p>使用命令 docker import 从快照文件中导入为镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat mynginx.tar.gz | docker import - sqgulj/nginx:2.0</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;Docker 容器是用于运行镜像的沙箱环境，它是 Docker 镜像的运行实例；容器都是相互隔离、互不可见的，我们可以理解为：镜像是Docker生命周期的打包和构建阶段，而容器是Docker的启动和执行阶段。&lt;/p&gt;
&lt;p&gt;容器是从镜像创建的应用运行实例，可以将其启动、开始、停止、删除，而这些容器都是相互隔离、互不可见的。&lt;/p&gt;
&lt;p&gt;镜像使用的是分层存储，容器也是如此。每一个容器运行时，是以镜像为基础层，在其上创建一个当前容器的存储层，容器存储层的生存周期和容器一样，容器消亡时，容器存储层也随之消亡。因此，任何保存于容器存储层的信息都会随容器删除而丢失。&lt;/p&gt;
&lt;p&gt;数据卷的生存周期独立于容器，容器消亡，数据卷不会消亡。因此，使用数据卷后，容器删除或者重新运行之后，数据却不会丢失。&lt;/p&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 镜像发布</title>
    <link href="http://www.gulj.cn/2018/03/28/docker-%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83/"/>
    <id>http://www.gulj.cn/2018/03/28/docker-镜像发布/</id>
    <published>2018-03-28T05:37:58.000Z</published>
    <updated>2019-02-14T07:07:12.865Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>如果我们自己在本地制作一个镜像，想提供给他人使用或者作为自己的日常学习，那么我们可以把我们制作的镜像发布到<a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a>上，这样不管是其它人还是我们自己就可以直接使用 <strong>docker pull</strong> 命令获取到我们发布的镜像，这样我们再也不用担心一不小心把本地镜像删除了；<br>当然发布到<a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a>上的镜像是公开的，每个人都能获取，如果我们希望我们发布的镜像是私有的只有我们自己可以看见，我们可以利用官方提供的<a href="">registry</a>镜像来搭建自己私有的镜像仓库,当然我们也还可以使用<a href="https://github.com/vmware/harbor" target="_blank" rel="noopener">Harbor</a>来搭建企业级私有仓库服务器</p><a id="more"></a><h4 id="镜像发布到-DockerHub"><a href="#镜像发布到-DockerHub" class="headerlink" title="镜像发布到 DockerHub"></a>镜像发布到 <a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a></h4><p>镜像发布到 <a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a>，首先我们需要注册 <a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a> 账号，假设现在大家都有了<a href="https://hub.docker.com/" target="_blank" rel="noopener">DokcerHub</a>的账号，那么接下来我们在本地制作一个自己的镜像</p><p>创建一个getip目录，进入到getip目录，编写Dockerfile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir getip</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> getip </span><br><span class="line"></span><br><span class="line">$ vim Dockerfile</span><br></pre></td></tr></table></figure><p>Dokcerfile文件中内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:16.04</span><br><span class="line"></span><br><span class="line">RUN apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install -y curl \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [<span class="string">"curl"</span>,<span class="string">"-s"</span>,<span class="string">"http://ip.cn"</span>]</span><br></pre></td></tr></table></figure><p>在getip目录执行 <strong>docker build</strong> 命令构建镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建镜像(注意仓库名必须是你注册的 dockerhub 的用户名)</span></span><br><span class="line">docker build -t sqgulj/get-ip:1.0 .</span><br></pre></td></tr></table></figure><p>查看构建的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker images;</span><br><span class="line">REPOSITORY                                                        TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">sqgulj/get-ip                                                     1.0                 e381e0c1b380        3 hours ago         129MB</span><br></pre></td></tr></table></figure><p>在终端使用 <strong>docker login</strong> 命令，输入自己的<a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a>账号信息进行登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker login</span><br><span class="line">Login with your Docker ID to push and pull images from Docker Hub. If you don<span class="string">'t have a Docker ID, head over to https://hub.docker.com to create one.</span></span><br><span class="line"><span class="string">Username (sqgulj):</span></span><br></pre></td></tr></table></figure><p>使用 <strong>docker push</strong> 命令把我刚制作的镜像推送到<a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker push sqgulj/get-ip</span><br><span class="line">The push refers to repository [docker.io/sqgulj/get-ip]</span><br><span class="line">83dc3de4596c: Pushed</span><br><span class="line">db584c622b50: Mounted from library/ubuntu</span><br><span class="line">52a7ea2bb533: Mounted from library/ubuntu</span><br><span class="line">52f389ea437e: Mounted from library/ubuntu</span><br><span class="line">88888b9b1b5b: Mounted from library/ubuntu</span><br><span class="line">a94e0d5a7c40: Mounted from library/ubuntu</span><br><span class="line">1.0: digest: sha256:1a3fa4e93464054c2f8050d6f846cccbe943c5e9f6d67f98f2013a32652f3f0b size: 1568</span><br></pre></td></tr></table></figure><p>浏览器登录到<a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a>查看我们推送的镜像</p><p><img src="http://p6nkwri76.bkt.clouddn.com/15222955810093.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;如果我们自己在本地制作一个镜像，想提供给他人使用或者作为自己的日常学习，那么我们可以把我们制作的镜像发布到&lt;a href=&quot;https://hub.docker.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DockerHub&lt;/a&gt;上，这样不管是其它人还是我们自己就可以直接使用 &lt;strong&gt;docker pull&lt;/strong&gt; 命令获取到我们发布的镜像，这样我们再也不用担心一不小心把本地镜像删除了；&lt;br&gt;当然发布到&lt;a href=&quot;https://hub.docker.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DockerHub&lt;/a&gt;上的镜像是公开的，每个人都能获取，如果我们希望我们发布的镜像是私有的只有我们自己可以看见，我们可以利用官方提供的&lt;a href=&quot;&quot;&gt;registry&lt;/a&gt;镜像来搭建自己私有的镜像仓库,当然我们也还可以使用&lt;a href=&quot;https://github.com/vmware/harbor&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Harbor&lt;/a&gt;来搭建企业级私有仓库服务器&lt;/p&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 镜像加速器</title>
    <link href="http://www.gulj.cn/2018/03/27/docker-%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%99%A8/"/>
    <id>http://www.gulj.cn/2018/03/27/docker-镜像加速器/</id>
    <published>2018-03-27T14:29:18.000Z</published>
    <updated>2019-02-14T07:07:12.864Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>由于国内访问官方（<strong>DockerHub</strong>）的镜像比较慢，可以使用阿里云和DaoCloud为我们提供的镜像</p><ul><li><p><a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="noopener">阿里云镜像加速器地址</a></p></li><li><p><a href="https://www.daocloud.io/mirror#accelerator-doc" target="_blank" rel="noopener">DaoCloud 镜像加速器地址</a></p></li></ul><p>本文笔者会分别介绍MacOs平台和Centos7平台下配置这两种的镜像加速器地址</p><a id="more"></a><h4 id="MacOS-平台"><a href="#MacOS-平台" class="headerlink" title="MacOS 平台"></a>MacOS 平台</h4><h5 id="配置阿里云Docker加速器"><a href="#配置阿里云Docker加速器" class="headerlink" title="配置阿里云Docker加速器"></a>配置阿里云Docker加速器</h5><ul><li>登录阿里云控制台（<a href="https://dev.aliyun.com/search.html" target="_blank" rel="noopener">需要注册阿里云开发者平台账号</a>），访问地址：<a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="noopener">https://cr.console.aliyun.com/#/accelerator</a>  可查看自己专有的镜像库加速器地址</li></ul><p>下图展示的是笔者的阿里云镜像加速器界面</p><p><img src="/images/15221416939253.jpg" alt=""></p><ul><li>右键点击桌面顶栏的 <strong>docker</strong> 图标 Perferences… -&gt; <strong>Daemon</strong> -&gt; <strong>Registry mirrors</strong>，添加代理地址，记得点击 Apply &amp; Restart 按钮使设置生效。</li></ul><p><img src="/images/15221424183672.jpg" alt=""></p><blockquote><p>出现的 “registry-mirrors” : No certs for 6wnqhom.mirror.aliyuncs.com… 警告可以忽略。</p></blockquote><h5 id="配置DaoCloud的Docker加速器"><a href="#配置DaoCloud的Docker加速器" class="headerlink" title="配置DaoCloud的Docker加速器"></a>配置DaoCloud的Docker加速器</h5><ul><li>打开地址：<a href="https://www.daocloud.io/mirror#accelerator-doc" target="_blank" rel="noopener">https://www.daocloud.io/mirror#accelerator-doc</a> 可以使用github账号登录或者微信</li></ul><p><img src="/images/15221435301606.jpg" alt=""></p><ul><li>添加DaoCloud的dokcer镜像代理地址和添加阿里云Docker代理地址方法一样，读者可以参考上面添加的阿里云docker加速器代理地址</li></ul><h4 id="Centos7-平台"><a href="#Centos7-平台" class="headerlink" title="Centos7 平台"></a>Centos7 平台</h4><h5 id="配置阿里云Docker加速器-1"><a href="#配置阿里云Docker加速器-1" class="headerlink" title="配置阿里云Docker加速器"></a>配置阿里云Docker加速器</h5><p>通过上面我们已经知道了如何获取自己的的阿里云docker镜像代理地址</p><ul><li>修改daemon配置文件/etc/docker/daemon.json来使用加速器：</li></ul><p>分别执行以下命令，记得把加速器的地址，改成自己的加速器地址。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://XXXXX.mirror.aliyuncs.com"</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><blockquote><p>针对Docker客户端版本大于1.10.0的用户</p></blockquote><h4 id="检查加速器是否生效"><a href="#检查加速器是否生效" class="headerlink" title="检查加速器是否生效"></a>检查加速器是否生效</h4><ul><li><p>Linux系统下配置完加速器需要检查是否生效，在命令行执行 <strong>ps -ef | grep dockerd</strong>，如果从结果中看到了配置的 –registry-mirror 参数说明配置成功</p></li><li><p>如果Docker版本大于1.13或17.05.0-ce</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker info|grep <span class="string">"Registry Mirrors"</span> -A 1</span><br><span class="line">Registry Mirrors:</span><br><span class="line"> https://16wnqhom.mirror.aliyuncs.com/</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;由于国内访问官方（&lt;strong&gt;DockerHub&lt;/strong&gt;）的镜像比较慢，可以使用阿里云和DaoCloud为我们提供的镜像&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://cr.console.aliyun.com/#/accelerator&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;阿里云镜像加速器地址&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://www.daocloud.io/mirror#accelerator-doc&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DaoCloud 镜像加速器地址&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;本文笔者会分别介绍MacOs平台和Centos7平台下配置这两种的镜像加速器地址&lt;/p&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 镜像</title>
    <link href="http://www.gulj.cn/2018/03/27/docker-%E9%95%9C%E5%83%8F/"/>
    <id>http://www.gulj.cn/2018/03/27/docker-镜像/</id>
    <published>2018-03-27T11:03:41.000Z</published>
    <updated>2019-02-14T07:07:12.864Z</updated>
    
    <content type="html"><![CDATA[<h4 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h4><p>官方的 <a href="https://hub.docker.com/explore/" target="_blank" rel="noopener">DockerHub</a> 上有很多开源的高质量镜像，可以直接供我们使用</p><ul><li>使用docker pull 命令直接从 <a href="https://hub.docker.com/explore/" target="_blank" rel="noopener">DockerHub</a> 上获取</li></ul><p>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull [选项] [docker registry 地址]:&lt;仓库名&gt;:&lt;标签&gt;</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取nginx镜像</span></span><br><span class="line">$ docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">2a72cbf407d6: Pull complete</span><br><span class="line">fefa2faca81f: Pull complete</span><br><span class="line">080aeede8114: Pull complete</span><br><span class="line">Digest: sha256:c4ee0ecb376636258447e1d8effb56c09c75fe7acf756bf7c13efadf38aa0aca</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:latest</span><br></pre></td></tr></table></figure><a id="more"></a><ul><li>使用Dockerfile构建Docker镜像 （<strong>建议使用Dockerfile构建自己的Docker镜像</strong>）</li></ul><p>格式： docker image build [OPTIONS] PATH | URL | - [flags]</p><p>简写： docker build [OPTIONS] PATH | URL | - [flags]</p><p>创建一个nginx目录，编写dockerfile文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个nginx目录</span></span><br><span class="line">$ mkdir nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编写Dockerfile文件 (注意名称必须为:Dockerfile)</span></span><br><span class="line">$ vim Dockerfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dockerfile 文件中内容</span></span><br><span class="line">FROM nginx</span><br><span class="line">RUN  <span class="built_in">echo</span> <span class="string">'&lt;h1&gt;Hello, nginx!&lt;/h1&gt;'</span> &gt; /usr/share/nginx/html/index.html</span><br></pre></td></tr></table></figure><p>在 Dockerfile 文件所在目录执行下面命令，构建名为 gulj/nginx:v1 的docker镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建名为 mynginx:v1 的镜像</span></span><br><span class="line">$ docker build -t gulj/nginx:v1  .</span><br></pre></td></tr></table></figure><ul><li>使用docker commit 命令通过已有的 <strong>容器</strong> 创建镜像（<strong>不建议使用</strong>）</li></ul><p>格式：docker container commit [选项] &lt;容器ID或容器名&gt; [&lt;仓库名&gt;[:&lt;标签&gt;]]</p><p>简写：docker commit [选项] &lt;容器ID或容器名&gt; [&lt;仓库名&gt;[:&lt;标签&gt;]]</p><p>既然通过容器创建镜像，那么首先需要运行一个容器，而运行一个容器需要一个基础镜像，下面将使用官方的centos镜像，通过加工来构建自己的镜像</p><p>大致流程如下：</p><pre><code>① 获取官方的centos镜像② 对获取的centos镜像执行docker run 命令获取一个容器③ 对获取的容器进行安装vim操作，安装结束，退出容器（默认官方的centos镜像没有vim命令）④ 通过docker commit 命令构建镜像，这样我们就能得到了一个带有vim命令的centos镜像</code></pre><p>按照流程操作演示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取centos镜像</span></span><br><span class="line">$ docker pull centos</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">5e35d10a3eba: Pull complete</span><br><span class="line">Digest: sha256:dcbc4e5e7052ea2306eed59563da1fec09196f2ecacbe042acbdcd2b44b05270</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> centos:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以交互式方式获取一个容器,这样我们就会进入容器内，安装vim，安装完之后退出容器</span></span><br><span class="line">$ docker run -it  centos</span><br><span class="line"><span class="comment"># 在容器内安装vim</span></span><br><span class="line">[root@34046cf71732 /] yum install vim -y </span><br><span class="line"><span class="comment"># 退出容器</span></span><br><span class="line">[root@34046cf71732 /] <span class="built_in">exit</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 查看我们刚才运行的容器</span></span><br><span class="line">$ dokcer ps -a </span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS                    NAMES</span><br><span class="line">34046cf71732        centos              <span class="string">"/bin/bash"</span>              10 minutes ago      Exited (0) 15 seconds ago                            cocky_euler</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建安装vim的centos镜像, --author 是指定修改的作者，而 --message 则是记录本次修改的内容，可省略</span></span><br><span class="line">$ docker commit  --author <span class="string">"gulj &lt;sqgulj@gmail.com&gt;"</span> --message <span class="string">"安装了vim"</span>  cocky_euler  gulj/centos-vim:1.0</span><br><span class="line">sha256:1109b8f3ea7826225d1dc1ee2693507fe8402eaeeafc57d24b907018a5cc0951</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看我们构建的镜像</span></span><br><span class="line">$ docker images</span><br><span class="line">REPOSITORY                                                        TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">gulj/centos-vim                                                   1.0                 1109b8f3ea78        15 seconds ago      354MB</span><br><span class="line">centos                                                            latest              2d194b392dd1        3 weeks ago         195MB</span><br></pre></td></tr></table></figure><p>下面我们通过docker history 命令查看镜像内的历史记录，与 centos:latest 的镜像历史记录比较，我们会很明显地发现，gulj/centos-vim:1.0 的镜像历史记录比 centos:latest 的镜像历史记录多了一层，也就是我们提交的一层（sha256:1109b8f3ea7826225d1…）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos:latest 镜像</span></span><br><span class="line">$ docker <span class="built_in">history</span> centos</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">2d194b392dd1        3 weeks ago         /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/bash"]            0B</span></span><br><span class="line">&lt;missing&gt;           3 weeks ago         /bin/sh -c <span class="comment">#(nop)  LABEL name=CentOS Base Im…   0B</span></span><br><span class="line">&lt;missing&gt;           3 weeks ago         /bin/sh -c <span class="comment">#(nop) ADD file:8d83f3e2c14f39e7f…   195MB</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们自己构建的gulj/centos-vim:1.0镜像</span></span><br><span class="line">$ docker <span class="built_in">history</span> gulj/centos-vim:1.0</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">1109b8f3ea78        9 minutes ago       /bin/bash                                       158MB</span><br><span class="line">2d194b392dd1        3 weeks ago         /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/bash"]            0B</span></span><br><span class="line">&lt;missing&gt;           3 weeks ago         /bin/sh -c <span class="comment">#(nop)  LABEL name=CentOS Base Im…   0B</span></span><br><span class="line">&lt;missing&gt;           3 weeks ago         /bin/sh -c <span class="comment">#(nop) ADD file:8d83f3e2c14f39e7f…   195MB</span></span><br></pre></td></tr></table></figure><blockquote><p>docker commit 操作只专注于可读可写层（Read-Write Layer），数据卷 VOLUME 挂载的目录内容，还有类似于 hosts、hostsname 和resolv.conf 等挂载文件，当然还有一些如 /proc 和 /sys 等虚拟文件系统的内容都将不会出现在打包后的镜像中</p></blockquote><h4 id="镜像常用命令"><a href="#镜像常用命令" class="headerlink" title="镜像常用命令"></a>镜像常用命令</h4><h5 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h5><p>使用 <strong>docker search</strong> 命令从<a href="https://hub.docker.com/explore/" target="_blank" rel="noopener">DockerHub</a>中搜索<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search [OPTIONS] TERM</span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><pre><code>-f, --filter filter  根据指定条件过滤结果--format string      通过Go语言模板文件展示镜像--limit int          限制显示的个数--no-trunc           显示完整的镜像描述</code></pre><p>示例：</p><p>从Docker Hub查找所有镜像名包含nginx，并且收藏数大于500的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker search -f=stars=500  nginx</span><br><span class="line">NAME                      DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">nginx                     Official build of Nginx.                        8227                [OK]</span><br><span class="line">jwilder/nginx-proxy       Automated Nginx reverse proxy <span class="keyword">for</span> docker con…   1300                                    [OK]</span><br><span class="line">richarvey/nginx-php-fpm   Container running Nginx + PHP-FPM capable of…   538                                     [OK]</span><br></pre></td></tr></table></figure><h5 id="列出镜像"><a href="#列出镜像" class="headerlink" title="列出镜像"></a>列出镜像</h5><p>使用 <strong>docker images</strong> 命令列出本地镜像<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images [OPTIONS] [REPOSITORY[:TAG]]</span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><pre><code>-a, --all             显示所有的镜像 (默认隐藏中间层镜像)--digests             显示摘要-f, --filter filter   显示满足条件的镜像--format string       通过Go语言模板文件展示镜像--no-trunc            显示完整的镜像信息-q, --quiet           只显示镜像ID</code></pre><p>示例：</p><p>查看本地镜像列表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker images 或者 docker images ls</span><br><span class="line">gulj/centos-vim                                                   1.0                 1109b8f3ea78        4 hours ago         354MB</span><br><span class="line">nginx                                                             latest              7f70b30f2cc6        6 days ago          109MB</span><br><span class="line">centos                                                            latest              2d194b392dd1        3 weeks ago         195MB</span><br><span class="line">postgres                                                          latest              6152297591eb        3 weeks ago         289MB</span><br><span class="line">busybox                                                           latest              f6e427c148a7        3 weeks ago         1.15MB</span><br></pre></td></tr></table></figure><p>其它使用方式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker image ls</span><br><span class="line"></span><br><span class="line">docker images -q                                   <span class="comment"># 只展示镜像的ID</span></span><br><span class="line"></span><br><span class="line">docker images mysql</span><br><span class="line"></span><br><span class="line">docker images mysql:5.7</span><br><span class="line"></span><br><span class="line">docker images --digests mysql:5.7                 </span><br><span class="line"></span><br><span class="line">docker images -f since=mysql:5.7                   <span class="comment"># 展示 mysql:5.7 之后建立的镜像</span></span><br><span class="line"></span><br><span class="line">docker images --format <span class="string">"&#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Repository&#125;&#125;"</span>  <span class="comment"># 只展示镜像ID和仓库</span></span><br><span class="line"></span><br><span class="line">docker images -f <span class="string">"dangling=true"</span>                   <span class="comment"># 展示虚悬镜像</span></span><br></pre></td></tr></table></figure><h5 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h5><p>使用 <strong>docker rmi</strong> 命令删除本地一个或多个镜像<br>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi [OPTIONS] IMAGE [IMAGE...] [flags]</span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><pre><code>-f, --force     强制删除--no-prune      不移除该镜像的过程镜像，默认移除</code></pre><p>示例：</p><p>强制删除本地指定名称的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images rmi -f gitlab/gitlab-ce</span><br></pre></td></tr></table></figure><p>其它使用方式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f 2aa1fe2f052b                       <span class="comment"># 根据镜像ID删除指定镜像</span></span><br><span class="line"></span><br><span class="line">docker rmi gulj/centos-vim nginx busybox         <span class="comment"># 删除多个镜像</span></span><br><span class="line"></span><br><span class="line">docker rmi $(docker images -q redis)             <span class="comment"># 删除所有仓库名为reids的镜像</span></span><br><span class="line"></span><br><span class="line">docker rmi $(docker images -q -f dangling=<span class="literal">true</span>)  <span class="comment"># 删除所有的虚悬镜像</span></span><br><span class="line"></span><br><span class="line">docker rmi $(docker images -aq)                  <span class="comment"># 删除所有的镜像</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;获取镜像&quot;&gt;&lt;a href=&quot;#获取镜像&quot; class=&quot;headerlink&quot; title=&quot;获取镜像&quot;&gt;&lt;/a&gt;获取镜像&lt;/h4&gt;&lt;p&gt;官方的 &lt;a href=&quot;https://hub.docker.com/explore/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DockerHub&lt;/a&gt; 上有很多开源的高质量镜像，可以直接供我们使用&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用docker pull 命令直接从 &lt;a href=&quot;https://hub.docker.com/explore/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DockerHub&lt;/a&gt; 上获取&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;格式：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker pull [选项] [docker registry 地址]:&amp;lt;仓库名&amp;gt;:&amp;lt;标签&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;示例：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 获取nginx镜像&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ docker pull nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Using default tag: latest&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;latest: Pulling from library/nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2a72cbf407d6: Pull complete&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fefa2faca81f: Pull complete&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;080aeede8114: Pull complete&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Digest: sha256:c4ee0ecb376636258447e1d8effb56c09c75fe7acf756bf7c13efadf38aa0aca&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Status: Downloaded newer image &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; nginx:latest&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 初识</title>
    <link href="http://www.gulj.cn/2018/03/27/docker-%E5%88%9D%E8%AF%86/"/>
    <id>http://www.gulj.cn/2018/03/27/docker-初识/</id>
    <published>2018-03-27T01:44:09.000Z</published>
    <updated>2019-02-14T07:07:12.863Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>Docker 采用的是 Client/Server 架构。客户端向服务器发送请求，服务器负责构建、运行和分发容器。客户端和服务器可以运行在同一个 Host 上，客户端也可以通过 socket 或 REST API 与远程的服务器通信。</p><h4 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h4><p><img src="http://p6nkwri76.bkt.clouddn.com/15221198968275.jpg" alt=""></p><a id="more"></a><h4 id="核心技术"><a href="#核心技术" class="headerlink" title="核心技术"></a>核心技术</h4><ul><li><p>Namespaces <strong>(namespace)</strong></p><p>  Namespace是Linux提供的一种内核级别环境隔离的方法,提供了对UTS、IPC、mount、PID、network、User等的隔离机制。</p></li><li><p>Control groups <strong>(CGroup)</strong></p><p>  用来限制，控制与分离一个进程组群的资源（如CPU、内存、磁盘输入输出等）<br>  可​​以让​​​您​​​为​​​系​​​统​​​中​​​所​​​运​​​行​​​任​​​务​​​（进​​​程​​​）的​​​用​​​户​​​定​​​义​​​组​​​群​​​分​​​配​​​资​​​源​​​ — 比​​​如​​​ CPU 时​​​间​​​、​​​系​​​统​​​内​​​存​​​、​​​网​​​络​​​带​​​宽​​​或​​​者​​​这​​​些​​​资​​​源​​​的​​​组​​​合。<br>  主要提供了一下功能</p><ul><li>Resource limitation: 限制资源使用，比如内存使用上限以及文件系统的缓存限制。</li><li>Prioritization: 优先级控制，比如：CPU利用和磁盘IO吞吐。</li><li>Accounting: 一些审计或一些统计，主要目的是为了计费。</li><li>Control: 挂起进程，恢复执行进程</li></ul></li><li><p>Union file systems <strong>(AUFS)</strong></p><p>  AUFS是一个能透明覆盖一或多个现有文件系统的层状文件系统。 支持将不同目录挂载到同一个虚拟文件系统下，可以把不同的目录联合在一起，组成一个单一的目录。这种是一种虚拟的文件系统，文件系统不用格式化，直接挂载即可</p><p>  当一个进程需要修改一个文件时，AuFS创建该文件的一个副本。AuFS可以把多层合并成文件系统的单层表示。这个过程称为写入复制copy on write</p></li><li><p>….等</p></li></ul><h4 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h4><ul><li><p>客户端  <strong>Client</strong></p><p>  Docker client 是给用户和 Docker daemon 建立通信的客户端，安装了 docker 之后，二进制文件 docker 就是 Docker client，与 Docker daemon 交互， 通过客户端 docker 命令，我们可以方便地实现对 Docker image 和 container 的管理请求。</p><p>  Docker client 与 docker daemon 建立请求的方式有三种，分别是：</p><ul><li><p>tcp://host:port</p></li><li><p>unix://path/to/socket</p></li><li><p>fd://socketfd</p></li></ul></li><li><p>常驻后台的系统进程  <strong>Docker daemon</strong></p><p>  Docker daemon 是一个常驻后台的系统进程，所谓“运行 docker”，指的就是运行 Docker daemon，其作用主要有以下两点：</p><ul><li><p>接受并处理 Docker Client 发送的请求</p></li><li><p>管理所有的 Docker containers 和 Docker images</p><p>Docker daemon 的架构大致可以分为三部分：Docker Server、Engine 和 Job。</p><p>docker daemon 监听来自 remote api 的请求的方式有三种：unix、tcp 和 fd</p><p>默认配置下，Docker daemon 只能响应来自本地 Host 的客户端请求。如果要允许远程客户端请求，可以使用dockerd命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dockerd -H 0.0.0.0</span><br></pre></td></tr></table></figure></li></ul></li><li><p>镜像    &nbsp;<strong>Image</strong></p><p>  镜像是一个<strong>只读</strong>的层（layer），由文件系统叠加构成，就相当于是一个 root 文件系统，通过它可以创建 Docker 容器（Container）。</p><p>  <strong>分层存储</strong>，每一层都可以添加改变和删除文件，形成一个新的镜像</p><p>  镜像构建时，会一层层构建，前一层是后一层的基础。每一层构建完就不会再发生改变，后一层上的任何改变只发生在自己这一层</p><p>  不同的镜像可以共享相同的层</p><p>  <img src="http://p6nkwri76.bkt.clouddn.com/15221323476589.jpg" alt=""></p></li></ul><ul><li>容器   &nbsp;<strong>Container</strong></li></ul><p>Docker 容器是用于运行镜像的沙箱环境，它是 Docker 镜像的运行实例；容器都是相互隔离、互不可见的，我们可以理解为：镜像是Docker生命周期的打包和构建阶段，而容器是Docker的启动和执行阶段。</p><p>镜像使用的是分层存储，容器也是如此。每一个容器运行时，是以镜像为基础层，在其上创建一个当前容器的存储层，我们可以称这个为容器运行时读写而准备的存储层为容器存储层。</p><p><strong>容器存储层的生存周期和容器一样，容器消亡时，容器存储层也随之消亡。因此，任何保存于容器存储层的信息都会随容器删除而丢失</strong></p><p>数据卷的生存周期独立于容器，容器消亡，数据卷不会消亡。因此，使用数据卷后，容器删除或者重新运行之后，数据却不会丢失。</p><p>在Image Layer之上建立一个 Container Layer（<strong>读写层</strong>），镜像（image）负责app的存储和分发，容器（Container）负责运行app</p><p><img src="http://p6nkwri76.bkt.clouddn.com/15221344845542.jpg" alt=""></p><ul><li>仓库   &nbsp;<strong>Registry</strong></li></ul><p>Registry 是集中的存储、分发镜像的文件仓库</p><p>仓库分为公有仓库和私有仓库，常用的公有仓库是官方的 <a href="https://hub.docker.com/" target="_blank" rel="noopener">Docker Hub</a>，默认的 docker pull 命令就是从官方的公有仓库中拉取镜像；个人可以根据Docker 官方提供了<a href="https://hub.docker.com/_/registry/" target="_blank" rel="noopener"> Docker Registry</a> 镜像，可以直接使用做为私有 Registry 服务</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;Docker 采用的是 Client/Server 架构。客户端向服务器发送请求，服务器负责构建、运行和分发容器。客户端和服务器可以运行在同一个 Host 上，客户端也可以通过 socket 或 REST API 与远程的服务器通信。&lt;/p&gt;
&lt;h4 id=&quot;系统架构&quot;&gt;&lt;a href=&quot;#系统架构&quot; class=&quot;headerlink&quot; title=&quot;系统架构&quot;&gt;&lt;/a&gt;系统架构&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;http://p6nkwri76.bkt.clouddn.com/15221198968275.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>【Docker教程】Docker 安装</title>
    <link href="http://www.gulj.cn/2018/03/26/Docker-%E5%AE%89%E8%A3%85/"/>
    <id>http://www.gulj.cn/2018/03/26/Docker-安装/</id>
    <published>2018-03-26T09:23:17.000Z</published>
    <updated>2019-02-14T07:07:12.859Z</updated>
    
    <content type="html"><![CDATA[<h4 id="导读"><a href="#导读" class="headerlink" title="导读"></a>导读</h4><p>本系列的docker学习笔者均采用Vagrant和VirtualBox进行，下面我会给出这两款工具的简单介绍。</p><h4 id="Vagrant"><a href="#Vagrant" class="headerlink" title="Vagrant"></a>Vagrant</h4><h5 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a><strong>介绍</strong></h5><p>Vagrant是hashicorp这家公司的产品，是一个让你可以方便设置你想要的虚拟机的便携式工具，它底层支持VirtualBox、VMware甚至AWS作为虚拟机系统。</p><p>我们可以通过Vagrant提供的命令行工具vagrant，可以快速启动根据我们事先定义好的Vagrantfile文件，来创建一个或者多个虚拟机。</p><p>Vagrantfile是用来定义vagrant project的，使用ruby语法。</p><a id="more"></a><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a><strong>安装</strong></h5><p>Vagrant支持Mac、Window,Centos 等各种平台，下图展示支持的各种平台列表<br><img src="/images/docker-version-list.jpg" alt=""></p><p>下载地址：<a href="https://www.vagrantup.com/downloads.html" target="_blank" rel="noopener">https://www.vagrantup.com/downloads.html</a></p><ul><li>查看是否安装成功</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看vagrant版本信息</span></span><br><span class="line">$ vagrant version</span><br></pre></td></tr></table></figure><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a><strong>使用</strong></h5><ul><li><p><strong>添加一个box</strong></p><p><strong>格式</strong>：vagrant box add  远端的box地址或者本地的box文件名</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加 centos/7 的box</span></span><br><span class="line">$ vagrant box add centos/7</span><br></pre></td></tr></table></figure><blockquote><p>通过这个步骤，vagrant会去box列表中找centos/7这个镜像，如果没有就去官方下载</p><p>box的名称我们通过官方提供的地址:<a href="https://app.vagrantup.com/boxes/search?page=1" target="_blank" rel="noopener">https://app.vagrantup.com/boxes/search?page=1</a> 去search</p></blockquote><ul><li><p><strong>初始化</strong></p><p><strong>格式</strong>： vagrant init  box列表中box的名称</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建一个目录，为centos7</span></span><br><span class="line">$ mkdir centos7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入centos7目录，初始化box,这里的（centos/7）就是我们第一步添加的box名称</span></span><br><span class="line">$ vagrant init centos/7</span><br></pre></td></tr></table></figure><blockquote><p>这样就会在当前目录(centos7)生成一个Vagrantfile的文件,注意每个目录只能存放一个Vagrantfile文件，所以我们要事先定义好我们需要创建系统的目录</p></blockquote><ul><li><p><strong>启动虚拟机</strong></p><p>我们已经通过vagrant init centos/7 命令，得到了vagrantfile文件，下面我们可以通过vagrant up 命令来启动vagrantfile中定义的虚拟机</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant up</span><br></pre></td></tr></table></figure><blockquote><p>这样我们就在在Virtualbox中创建了一个虚拟机</p></blockquote><ul><li><strong>连接虚拟机</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant ssh</span><br></pre></td></tr></table></figure><h5 id="Vagrant-的其它基本命令"><a href="#Vagrant-的其它基本命令" class="headerlink" title="Vagrant 的其它基本命令"></a>Vagrant 的其它基本命令</h5><ul><li>查看命令帮助</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><ul><li>查看虚拟机的状态</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant status</span><br></pre></td></tr></table></figure><ul><li>查看box列表</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant box list</span><br></pre></td></tr></table></figure><ul><li>停止虚拟机</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant halt</span><br></pre></td></tr></table></figure><ul><li>销毁虚拟机</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant destory</span><br></pre></td></tr></table></figure><hr><h5 id="通过自定义Vagrantfile来创建虚拟机"><a href="#通过自定义Vagrantfile来创建虚拟机" class="headerlink" title="通过自定义Vagrantfile来创建虚拟机"></a>通过自定义Vagrantfile来创建虚拟机</h5><ul><li><strong>编写Vagrantfile,灵活的设置虚拟机的参数</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- mode: ruby -*-</span></span><br><span class="line"><span class="comment"># vi: set ft=ruby :</span></span><br><span class="line">    </span><br><span class="line">Vagrant.require_version <span class="string">"&gt;= 1.6.0"</span></span><br><span class="line">    </span><br><span class="line">boxes = [</span><br><span class="line">    &#123;</span><br><span class="line">        :name =&gt; <span class="string">"docker-node-test1"</span>,</span><br><span class="line">        :eth1 =&gt; <span class="string">"192.168.215.10"</span>,</span><br><span class="line">        :mem =&gt; <span class="string">"2048"</span>,</span><br><span class="line">        :cpu =&gt; <span class="string">"2"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">    </span><br><span class="line">Vagrant.configure(2) <span class="keyword">do</span> |config|</span><br><span class="line">    </span><br><span class="line">  config.vm.box = <span class="string">"centos/7"</span></span><br><span class="line">    </span><br><span class="line">  boxes.each <span class="keyword">do</span> |opts|</span><br><span class="line">      config.vm.define opts[:name] <span class="keyword">do</span> |config|</span><br><span class="line">        config.vm.hostname = opts[:name]</span><br><span class="line">        config.vm.provider <span class="string">"vmware_fusion"</span> <span class="keyword">do</span> |v|</span><br><span class="line">          v.vmx[<span class="string">"memsize"</span>] = opts[:mem]</span><br><span class="line">          v.vmx[<span class="string">"numvcpus"</span>] = opts[:cpu]</span><br><span class="line">        end</span><br><span class="line">    </span><br><span class="line">        config.vm.provider <span class="string">"virtualbox"</span> <span class="keyword">do</span> |v|</span><br><span class="line">          v.customize [<span class="string">"modifyvm"</span>, :id, <span class="string">"--memory"</span>, opts[:mem]]</span><br><span class="line">          v.customize [<span class="string">"modifyvm"</span>, :id, <span class="string">"--cpus"</span>, opts[:cpu]]</span><br><span class="line">        end</span><br><span class="line">    </span><br><span class="line">        config.vm.network :private_network, ip: opts[:eth1]</span><br><span class="line">      end</span><br><span class="line">  end</span><br><span class="line">    </span><br><span class="line">  <span class="comment">#config.vm.synced_folder "./labs", "/home/vagrant/labs"</span></span><br><span class="line">  <span class="comment">#config.vm.provision "bash", privileged: true, path: "./setup.sh"</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure><blockquote><p>Vagrantfile下载地址： xxxx</p></blockquote><ul><li><strong>创建虚拟机</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant up</span><br></pre></td></tr></table></figure><h5 id="Docker-安装"><a href="#Docker-安装" class="headerlink" title="Docker 安装"></a>Docker 安装</h5><p> 在 Mac 平台上安装</p><blockquote><p>下载地址：<a href="https://www.docker.com/community-edition" target="_blank" rel="noopener">https://www.docker.com/community-edition</a></p></blockquote><p> 在 <strong>centos7</strong> 平台上安装步骤</p><blockquote><p>官网地址：<a href="https://docs.docker.com/install/linux/docker-ce/centos/#install-from-a-package" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/centos/#install-from-a-package</a></p></blockquote><ul><li>卸载老的版本</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum remove docker \</span><br><span class="line">                    docker-client \</span><br><span class="line">                    docker-client-latest \</span><br><span class="line">                    docker-common \</span><br><span class="line">                    docker-latest \</span><br><span class="line">                    docker-latest-logrotate \</span><br><span class="line">                    docker-logrotate \</span><br><span class="line">                    docker-selinux \</span><br><span class="line">                    docker-engine-selinux \</span><br><span class="line">                    docker-engine</span><br></pre></td></tr></table></figure><ul><li><p>安装docker ce (注意docker 有docker ce 和 docker ee 两个版本，我们学习使用docker ce版本)</p><p>①、安装依赖包</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install -y yum-utils \</span><br><span class="line">    device-mapper-persistent-data \</span><br><span class="line">    lvm2</span><br></pre></td></tr></table></figure><p> ②、设置稳定仓库地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum-config-manager \</span><br><span class="line">--add-repo \</span><br><span class="line">https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><p> ③、【可选】启用 edge 和 test 仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用  --enable</span></span><br><span class="line">$ sudo yum-config-manager --<span class="built_in">enable</span> docker-ce-edge</span><br><span class="line"></span><br><span class="line">$ sudo yum-config-manager --<span class="built_in">enable</span> docker-ce-test</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用  --disable</span></span><br><span class="line">$ sudo yum-config-manager --<span class="built_in">disable</span> docker-ce-edge</span><br></pre></td></tr></table></figure><p>④、安装稳定版本的docker ce</p><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install docker-ce</span><br></pre></td></tr></table></figure></code></pre><p>⑤、【可选】查看具体的docker ce 版本，这样我们可以在生产环境安装具体的docker ce 版本</p><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看docker ce 版本列表</span></span><br><span class="line">$ yum list docker-ce --showduplicates | sort -r</span><br><span class="line"></span><br><span class="line">docker-ce.x86_64            18.03.ce-1.el7.centos             docker-ce-stable</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用命令安装具体的docker ce 版本</span></span><br><span class="line">$ sudo yum install &lt;FULLY-QUALIFIED-PACKAGE-NAME&gt;</span><br></pre></td></tr></table></figure></code></pre><p>⑥、启动docker</p><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure></code></pre><p>⑦、验证docker是否正确安装，可以通过运行 helloworld 镜像</p><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure></code></pre><h4 id="docker-machine-创建docker主机"><a href="#docker-machine-创建docker主机" class="headerlink" title="docker-machine 创建docker主机"></a>docker-machine 创建docker主机</h4><p>如果我们已经在mac平台安装过docker，默认会自带docker-machine；到现在我们已经知道了，可以通过virtualbox这个虚拟机软件直接创建虚拟机，安装docker，得到一台docker主机、也可以通过编写vagrantfile创建虚拟机，安装docker，也能得到一台docker主机、现在我们还可以通过docker-machine命令，来创建一台带有docker的主机</p><ul><li>查看版本信息</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine -v</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"> </span><br><span class="line">$ docker-machine create -d virtualbox demo</span><br></pre></td></tr></table></figure><ul><li>创建docker虚拟机 (使用 virtualbox 类型的驱动)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine create demo</span><br></pre></td></tr></table></figure><blockquote><p>你也可以在创建时加上如下参数，来配置主机或者主机上的 Docker。</p></blockquote><blockquote><p>–engine-opt dns=114.114.114.114 配置 Docker 的默认 DNS</p></blockquote><blockquote><p>–engine-registry-mirror <a href="https://registry.docker-cn.com" target="_blank" rel="noopener">https://registry.docker-cn.com</a> 配置 Docker 的仓库镜像</p></blockquote><blockquote><p>–virtualbox-memory 2048 配置主机内存</p></blockquote><blockquote><p>–virtualbox-cpu-count 2 配置主机 CPU</p></blockquote><ul><li>查看虚拟机列表</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine ls</span><br></pre></td></tr></table></figure><ul><li>进入虚拟机</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine ssh demo</span><br></pre></td></tr></table></figure><ul><li>停止虚拟机</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine stop demo</span><br></pre></td></tr></table></figure><p>现在我们已经在mac(宿主机)上安装了docker，又通过 docker-machine 方式创建，得到了一台docker主机；那么现在我们有这样一种需求，如何让宿主机上的docker client端连接，通过docker-machine创建的docker  server端。</p><p><strong>步骤</strong></p><ul><li>查看docker-machine创建虚拟机的环境变量</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 mac（宿主机上） 执行 查看docker-machine</span></span><br><span class="line">$ docker-machine env demo</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> DOCKER_TLS_VERIFY=<span class="string">"1"</span></span><br><span class="line"><span class="built_in">export</span> DOCKER_HOST=<span class="string">"tcp://192.168.99.100:2376"</span></span><br><span class="line"><span class="built_in">export</span> DOCKER_CERT_PATH=<span class="string">"/Users/gulj/.docker/machine/machines/demo"</span></span><br><span class="line"><span class="built_in">export</span> DOCKER_MACHINE_NAME=<span class="string">"demo"</span></span><br><span class="line"><span class="comment"># Run this command to configure your shell:</span></span><br><span class="line"><span class="comment"># eval $(docker-machine env demo)</span></span><br></pre></td></tr></table></figure><ul><li>设置宿主机的docker环境变量为docker-machine创建的docker主机环境变量</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ eval $(docker-machine env demo)</span><br></pre></td></tr></table></figure><ul><li>查看是否修改成功</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:17.12.0-ce</span><br><span class="line"> API version:1.35</span><br><span class="line"> Go version:go1.9.2</span><br><span class="line"> Git commit:c97c6d6</span><br><span class="line"> Built:Wed Dec 27 20:03:51 2017</span><br><span class="line"> OS/Arch:darwin/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:18.03.0-ce</span><br><span class="line">  API version:1.37 (minimum version 1.12)</span><br><span class="line">  Go version:go1.9.4</span><br><span class="line">  Git commit:0520e24</span><br><span class="line">  Built:Wed Mar 21 23:14:54 2018</span><br><span class="line">  OS/Arch:linux/amd64</span><br><span class="line">  Experimental:<span class="literal">false</span></span><br></pre></td></tr></table></figure><blockquote><p>这样宿主机的docker client端就已经连接到通过docker-machine创建的docker主机server端，那么我们在本地操作的docker任何命令，直接作用于 docker-machine 创建的docker主机</p></blockquote><h4 id="Docker-在线实验室-，无需安装，直接使用"><a href="#Docker-在线实验室-，无需安装，直接使用" class="headerlink" title="Docker 在线实验室 ，无需安装，直接使用"></a>Docker 在线实验室 ，无需安装，直接使用</h4><h5 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h5><p>  <a href="https://labs.play-with-docker.com/" target="_blank" rel="noopener">https://labs.play-with-docker.com/</a></p><h5 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h5><p>Play With Docker ( Docker 在线实验室) 是一个运行在浏览器中的 Docker Playground，无需安装任何环境，就可以在线体验 Docker</p><h5 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h5><p><img src="/images/docker-play-groud.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;导读&quot;&gt;&lt;a href=&quot;#导读&quot; class=&quot;headerlink&quot; title=&quot;导读&quot;&gt;&lt;/a&gt;导读&lt;/h4&gt;&lt;p&gt;本系列的docker学习笔者均采用Vagrant和VirtualBox进行，下面我会给出这两款工具的简单介绍。&lt;/p&gt;
&lt;h4 id=&quot;Vagrant&quot;&gt;&lt;a href=&quot;#Vagrant&quot; class=&quot;headerlink&quot; title=&quot;Vagrant&quot;&gt;&lt;/a&gt;Vagrant&lt;/h4&gt;&lt;h5 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;&lt;strong&gt;介绍&lt;/strong&gt;&lt;/h5&gt;&lt;p&gt;Vagrant是hashicorp这家公司的产品，是一个让你可以方便设置你想要的虚拟机的便携式工具，它底层支持VirtualBox、VMware甚至AWS作为虚拟机系统。&lt;/p&gt;
&lt;p&gt;我们可以通过Vagrant提供的命令行工具vagrant，可以快速启动根据我们事先定义好的Vagrantfile文件，来创建一个或者多个虚拟机。&lt;/p&gt;
&lt;p&gt;Vagrantfile是用来定义vagrant project的，使用ruby语法。&lt;/p&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="docker" scheme="http://www.gulj.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Charles进行HTTPS抓包</title>
    <link href="http://www.gulj.cn/2017/12/27/Charles%E8%BF%9B%E8%A1%8CHTTPS%E6%8A%93%E5%8C%85/"/>
    <id>http://www.gulj.cn/2017/12/27/Charles进行HTTPS抓包/</id>
    <published>2017-12-27T07:28:29.000Z</published>
    <updated>2019-02-14T07:07:12.859Z</updated>
    
    <content type="html"><![CDATA[<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>Charles其实是一款代理服务器，通过成为电脑或者浏览器的代理，然后截取请求和请求结果达到分析抓包的目的。charles有Window版本和Mac OS版本，也同时支持ios和Android手机系统</p><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p><strong>百度云</strong>：<a href="">Charles 4.2.1 Mac破解版</a></p><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul><li>Charles 4.2.1</li><li>Iphone 7P ios 11.0.1</li></ul><a id="more"></a><h3 id="使用前提"><a href="#使用前提" class="headerlink" title="使用前提"></a>使用前提</h3><ul><li>保证iOS设备iphone或ipad与运行Charles的mac电脑处于同一个wifi环境下</li></ul><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><ul><li><strong>①、配置HTTP代理，这步与抓取HTTP请求是一样的</strong></li></ul><p>打开: <strong>charles</strong> 的 <strong>Proxy</strong> 选项选择 <strong>Proxy Settings</strong></p><p>按照下图配置:</p><p><img src="/images/15143553748838.jpg" alt="">x<br><strong>备注</strong>：选择在8888端口上监听，然后确定。够选了SOCKS proxy，还能截获到浏览器的http访问请求。</p><ul><li>②、<strong>配置SSL代理</strong></li></ul><p>打开： <strong>charles</strong> 的 <strong>Proxy</strong> 选项选择 <strong>SSL Proxy Settings</strong><br>在 SSL Proxying 的Tab项中 点击 Add 按钮，按下图填写</p><p><img src="/images/15143559937031.jpg" alt=""></p><p>添加好之后，如下图展示：</p><p><img src="/images/15143557791068.jpg" alt=""></p><h3 id="手机端设置代理和安装Charles根证书"><a href="#手机端设置代理和安装Charles根证书" class="headerlink" title="手机端设置代理和安装Charles根证书"></a>手机端设置代理和安装Charles根证书</h3><h5 id="1、手机端安装Charles根证书"><a href="#1、手机端安装Charles根证书" class="headerlink" title="1、手机端安装Charles根证书"></a>1、手机端安装Charles根证书</h5><p>在Safri上地址栏粘贴 <strong>chls.pro/ss</strong> 点击立即前往，自动下载根证书<br><img src="/images/15143566512500.jpg" alt=""></p><p>而在ios10.3之后，安装新的自定义证书默认是不受信任的，如果要信任已安装的自定义证书,需要手动打开开关以信任证书。</p><p><strong>开始信任证书步骤：</strong><br>设置-&gt;通用-&gt;关于本机-&gt;证书信任设置-&gt; 找到charles proxy custom root certificate然后信任该证书即可.</p><p><img src="/images/15143569471035.jpg" alt=""></p><h5 id="2、手机端手机设置代理"><a href="#2、手机端手机设置代理" class="headerlink" title="2、手机端手机设置代理"></a><strong>2、手机端手机设置代理</strong></h5><p>打开： <strong>charles</strong> 的 <strong>Help</strong> 选项选择 <strong> Install Charles Root Certificate On a Mobile Device Or a Remote Browser </strong></p><p><img src="/images/15143577308764.jpg" alt=""></p><p>点击 ok 按钮</p><p><img src="/images/15143578310275.jpg" alt=""></p><p>首先在Mac上，查看IP地址：<br>方法一：系统偏好设置-&gt;网络-&gt;wifi-&gt;高级-&gt;TCP/IP<br>方法二：ifcofnig 命令 （在终端或者Iterm上）<br>本机Ip：192.168.6.174<br><img src="/images/15143541586385.jpg" alt=""></p><p>打开手机：</p><p><strong>设置</strong>界面，选择无线局域网</p><p><img src="/images/15143587906158.jpg" alt=""></p><p>进入<strong>无线局域网</strong>界面，点击所连的无线网旁边的 i 图标</p><p><img src="/images/15143590599615.jpg" alt=""></p><p>进入<strong>配置代理</strong>界面，点击底部的配置代理，改为手动模式</p><p><img src="/images/15143591666648.jpg" alt=""></p><p>配置代理<br>服务器地址：填写本机Mac的Ip地址，<br>端口：填写 charles 的 代理端口，默认是：8888；也可以自定义修改</p><p><img src="/images/15143579689140.jpg" alt=""></p><p>配置好之后，Mac上会弹出以下提示框，表示Charles软件检测到可供检测的设备。两个按钮选项：Allow 允许 ， Deny拒绝。我们要选择允许</p><p><img src="/images/15143585596777.jpg" alt=""></p><h3 id="电脑端-Mac-安装Charles根证书"><a href="#电脑端-Mac-安装Charles根证书" class="headerlink" title="电脑端(Mac)安装Charles根证书"></a>电脑端(Mac)安装Charles根证书</h3><p>直接在Charles的Help菜单中安装；安装完成后去系统的钥匙串访问中信任它</p><p><img src="/images/15143609984817.jpg" alt=""></p><p>在本机的系统的钥匙串访问中，找到Charles证书，默认是不被信任的，双击，该证书，修改为始终信任</p><p><img src="/images/15143611054154.jpg" alt=""></p><h3 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h3><p><img src="/images/15143619290731.jpg" alt=""></p><p>__</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h3&gt;&lt;p&gt;Charles其实是一款代理服务器，通过成为电脑或者浏览器的代理，然后截取请求和请求结果达到分析抓包的目的。charles有Window版本和Mac OS版本，也同时支持ios和Android手机系统&lt;/p&gt;
&lt;h3 id=&quot;下载&quot;&gt;&lt;a href=&quot;#下载&quot; class=&quot;headerlink&quot; title=&quot;下载&quot;&gt;&lt;/a&gt;下载&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;百度云&lt;/strong&gt;：&lt;a href=&quot;&quot;&gt;Charles 4.2.1 Mac破解版&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Charles 4.2.1&lt;/li&gt;
&lt;li&gt;Iphone 7P ios 11.0.1&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.gulj.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="charles" scheme="http://www.gulj.cn/tags/charles/"/>
    
  </entry>
  
</feed>
